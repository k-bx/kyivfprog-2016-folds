<!doctype html>
<html>
<head>
<meta charset='UTF-8'><meta name='viewport' content='width=device-width initial-scale=1'>
<title>folds_typora.md</title><link href='http://fonts.googleapis.com/css?family=Open+Sans:400italic,700italic,700,400&subset=latin,latin-ext' rel='stylesheet' type='text/css'><style type='text/css'>html, body {overflow-x: initial !important;}.CodeMirror { height: auto; }
.CodeMirror-scroll { overflow-y: hidden; overflow-x: auto; }
.CodeMirror-lines { padding: 4px 0px; }
.CodeMirror pre { }
.CodeMirror-scrollbar-filler, .CodeMirror-gutter-filler { background-color: white; }
.CodeMirror-gutters { border-right-width: 1px; border-right-style: solid; border-right-color: rgb(221, 221, 221); background-color: rgb(247, 247, 247); white-space: nowrap; }
.CodeMirror-linenumbers { }
.CodeMirror-linenumber { padding: 0px 3px 0px 5px; text-align: right; color: rgb(153, 153, 153); }
.CodeMirror div.CodeMirror-cursor { border-left-width: 1px; border-left-style: solid; border-left-color: black; z-index: 3; }
.CodeMirror div.CodeMirror-secondarycursor { border-left-width: 1px; border-left-style: solid; border-left-color: silver; }
.CodeMirror.cm-keymap-fat-cursor div.CodeMirror-cursor { width: auto; border: 0px; background-color: rgb(119, 238, 119); z-index: 1; background-position: initial initial; background-repeat: initial initial; }
.CodeMirror div.CodeMirror-cursor.CodeMirror-overwrite { }
.cm-tab { display: inline-block; }
.cm-s-typora-default .cm-header, .cm-s-typora-default .cm-property { color: rgb(217, 79, 138); }
.cm-s-typora-default pre.cm-header1:not(.cm-atom) :not(.cm-overlay) { font-size: 2rem; line-height: 2rem; }
.cm-s-typora-default pre.cm-header2:not(.cm-atom) :not(.cm-overlay) { font-size: 1.4rem; line-height: 1.4rem; }
.cm-s-typora-default .cm-atom, .cm-s-typora-default .cm-number { color: rgb(149, 132, 134); }
.cm-s-typora-default .cm-table-row, .cm-s-typora-default .cm-block-start { font-family: monospace; }
.cm-s-typora-default .cm-comment, .cm-s-typora-default .cm-code { color: rgb(74, 90, 159); font-family: monospace; }
.cm-s-typora-default .cm-tag { color: rgb(169, 68, 66); }
.cm-s-typora-default .cm-string { color: rgb(126, 134, 169); }
.cm-s-typora-default .cm-link { color: rgb(196, 122, 15); text-decoration: underline; }
.cm-s-typora-default .cm-variable-2, .cm-s-typora-default .cm-variable-1 { color: inherit; }
.cm-s-typora-default .cm-overlay { font-size: 1rem; font-family: monospace; }
.CodeMirror.cm-s-typora-default div.CodeMirror-cursor { border-left-width: 3px; border-left-style: solid; border-left-color: rgb(228, 98, 154); }
.cm-s-typora-default .CodeMirror-activeline-background { left: -60px; right: -30px; background-color: rgba(204, 204, 204, 0.2); background-position: initial initial; background-repeat: initial initial; }
.cm-s-typora-default .CodeMirror-gutters { border-right-style: none; background-color: inherit; }
.cm-s-typora-default .cm-trailing-space-new-line::after, .cm-startspace::after, .cm-starttab .cm-tab::after { content: '•'; position: absolute; left: 0px; opacity: 0; font-family: LetterGothicStd, monospace; }
.os-windows .cm-startspace::after, .os-windows .cm-starttab .cm-tab::after { left: -0.1em; }
.cm-starttab .cm-tab::after { content: ' '; }
.cm-startspace, .cm-tab, .cm-starttab, .cm-trailing-space-a, .cm-trailing-space-b, .cm-trailing-space-new-line { font-family: monospace; position: relative; }
.cm-s-typora-default .cm-trailing-space-new-line::after { content: '↓'; opacity: 0.3; }
.cm-s-inner .cm-keyword { color: rgb(119, 0, 136); }
.cm-s-inner .cm-atom, .cm-s-inner.cm-atom { color: rgb(34, 17, 153); }
.cm-s-inner .cm-number { color: rgb(17, 102, 68); }
.cm-s-inner .cm-def { color: rgb(0, 0, 255); }
.cm-s-inner .cm-variable { color: black; }
.cm-s-inner .cm-variable-2 { color: rgb(0, 85, 170); }
.cm-s-inner .cm-variable-3 { color: rgb(0, 136, 85); }
.cm-s-inner .cm-property { color: black; }
.cm-s-inner .cm-operator { color: rgb(152, 26, 26); }
.cm-s-inner .cm-comment, .cm-s-inner.cm-comment { color: rgb(170, 85, 0); }
.cm-s-inner .cm-string { color: rgb(170, 17, 17); }
.cm-s-inner .cm-string-2 { color: rgb(255, 85, 0); }
.cm-s-inner .cm-meta { color: rgb(85, 85, 85); }
.cm-s-inner .cm-qualifier { color: rgb(85, 85, 85); }
.cm-s-inner .cm-builtin { color: rgb(51, 0, 170); }
.cm-s-inner .cm-bracket { color: rgb(153, 153, 119); }
.cm-s-inner .cm-tag { color: rgb(17, 119, 0); }
.cm-s-inner .cm-attribute { color: rgb(0, 0, 204); }
.cm-s-inner .cm-header, .cm-s-inner.cm-header { color: blue; }
.cm-s-inner .cm-quote, .cm-s-inner.cm-quote { color: rgb(0, 153, 0); }
.cm-s-inner .cm-hr, .cm-s-inner.cm-hr { color: rgb(153, 153, 153); }
.cm-s-inner .cm-link, .cm-s-inner.cm-link { color: rgb(0, 0, 204); }
.cm-negative { color: rgb(221, 68, 68); }
.cm-positive { color: rgb(34, 153, 34); }
.cm-header, .cm-strong { font-weight: bold; }
.cm-del { text-decoration: line-through; }
.cm-em { font-style: italic; }
.cm-link { text-decoration: underline; }
.cm-error { color: rgb(255, 0, 0); }
.cm-invalidchar { color: rgb(255, 0, 0); }
.cm-constant { color: rgb(38, 139, 210); }
.cm-defined { color: rgb(181, 137, 0); }
div.CodeMirror span.CodeMirror-matchingbracket { color: rgb(0, 255, 0); }
div.CodeMirror span.CodeMirror-nonmatchingbracket { color: rgb(255, 34, 34); }
.cm-s-inner .CodeMirror-activeline-background { background-image: inherit; background-size: inherit; background-attachment: inherit; background-origin: inherit; background-clip: inherit; background-color: inherit; background-position: inherit inherit; background-repeat: inherit inherit; }
.CodeMirror { position: relative; overflow: hidden; }
.CodeMirror-scroll { margin-bottom: -30px; margin-right: -30px; padding-bottom: 30px; padding-right: 30px; height: 100%; outline: none; position: relative; box-sizing: content-box; }
.CodeMirror-sizer { position: relative; }
.CodeMirror-vscrollbar, .CodeMirror-hscrollbar, .CodeMirror-scrollbar-filler, .CodeMirror-gutter-filler { position: absolute; z-index: 6; display: none; }
.CodeMirror-vscrollbar { right: 0px; top: 0px; overflow-x: hidden; overflow-y: scroll; }
.CodeMirror-hscrollbar { bottom: 0px; left: 0px; overflow-y: hidden; overflow-x: scroll; }
.CodeMirror-scrollbar-filler { right: 0px; bottom: 0px; }
.CodeMirror-gutter-filler { left: 0px; bottom: 0px; }
.CodeMirror-gutters { position: absolute; left: 0px; top: 0px; padding-bottom: 30px; z-index: 3; }
.CodeMirror-gutter { white-space: normal; height: 100%; box-sizing: content-box; padding-bottom: 30px; margin-bottom: -32px; display: inline-block; }
.CodeMirror-gutter-elt { position: absolute; cursor: default; z-index: 4; }
.CodeMirror-lines { cursor: text; }
.CodeMirror pre { border-top-left-radius: 0px; border-top-right-radius: 0px; border-bottom-right-radius: 0px; border-bottom-left-radius: 0px; border-width: 0px; background-color: transparent; font-family: inherit; font-size: inherit; margin: 0px; white-space: pre; word-wrap: normal; color: inherit; z-index: 2; position: relative; overflow: visible; background-position: initial initial; background-repeat: initial initial; }
.CodeMirror-wrap pre { word-wrap: break-word; white-space: pre-wrap; word-break: normal; }
.CodeMirror-code pre { border-right-width: 30px; border-right-style: solid; border-right-color: transparent; width: -webkit-fit-content; }
.CodeMirror-wrap .CodeMirror-code pre { border-right-style: none; width: auto; }
.CodeMirror-linebackground { position: absolute; left: 0px; right: 0px; top: 0px; bottom: 0px; z-index: 0; }
.CodeMirror-linewidget { position: relative; z-index: 2; overflow: auto; }
.CodeMirror-widget { }
.CodeMirror-wrap .CodeMirror-scroll { overflow-x: hidden; }
.CodeMirror-measure { position: absolute; width: 100%; height: 0px; overflow: hidden; visibility: hidden; }
.CodeMirror-measure pre { position: static; }
.CodeMirror div.CodeMirror-cursor { position: absolute; visibility: hidden; border-right-style: none; width: 0px; }
.CodeMirror div.CodeMirror-cursor { visibility: hidden; }
.CodeMirror-focused div.CodeMirror-cursor { visibility: inherit; }
.CodeMirror-selected { background-color: rgb(217, 217, 217); background-position: initial initial; background-repeat: initial initial; }
.CodeMirror-focused .CodeMirror-selected { background-color: rgb(215, 212, 240); background-position: initial initial; background-repeat: initial initial; }
.cm-searching { background-color: rgba(255, 255, 0, 0.4); background-position: initial initial; background-repeat: initial initial; }
.CodeMirror span { }
@media print { 
  .CodeMirror div.CodeMirror-cursor { visibility: hidden; }
}
.CodeMirror-lint-markers { width: 16px; }
.CodeMirror-lint-tooltip { background-color: infobackground; border: 1px solid black; border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-right-radius: 4px; border-bottom-left-radius: 4px; color: infotext; font-family: monospace; overflow: hidden; padding: 2px 5px; position: fixed; white-space: pre-wrap; z-index: 10000; max-width: 600px; opacity: 0; -webkit-transition: opacity 0.4s; transition: opacity 0.4s; font-size: 0.8em; }
.CodeMirror-lint-mark-error, .CodeMirror-lint-mark-warning { background-position: 0% 100%; background-repeat: repeat no-repeat; }
.CodeMirror-lint-mark-error { background-image: url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAQAAAADCAYAAAC09K7GAAAAAXNSR0IArs4c6QAAAAZiS0dEAP8A/wD/oL2nkwAAAAlwSFlzAAALEwAACxMBAJqcGAAAAAd0SU1FB9sJDw4cOCW1/KIAAAAZdEVYdENvbW1lbnQAQ3JlYXRlZCB3aXRoIEdJTVBXgQ4XAAAAHElEQVQI12NggIL/DAz/GdA5/xkY/qPKMDAwAADLZwf5rvm+LQAAAABJRU5ErkJggg==); }
.CodeMirror-lint-marker-error, .CodeMirror-lint-marker-warning { cursor: pointer; display: inline-block; height: 16px; width: 16px; vertical-align: middle; position: relative; background-position: 50% 50%; background-repeat: no-repeat no-repeat; }
.CodeMirror-lint-message-error, .CodeMirror-lint-message-warning { padding-left: 18px; background-position: 0% 0%; background-repeat: no-repeat no-repeat; }
.CodeMirror-lint-marker-error, .CodeMirror-lint-message-error { background-image: url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAMAAAAoLQ9TAAAAHlBMVEW7AAC7AACxAAC7AAC7AAAAAAC4AAC5AAD///+7AAAUdclpAAAABnRSTlMXnORSiwCK0ZKSAAAATUlEQVR42mWPOQ7AQAgDuQLx/z8csYRmPRIFIwRGnosRrpamvkKi0FTIiMASR3hhKW+hAN6/tIWhu9PDWiTGNEkTtIOucA5Oyr9ckPgAWm0GPBog6v4AAAAASUVORK5CYII=); }
.CodeMirror-lint-marker-warning, .CodeMirror-lint-message-warning { background-image: url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAMAAAAoLQ9TAAAANlBMVEX/uwDvrwD/uwD/uwD/uwD/uwD/uwD/uwD/uwD6twD/uwAAAADurwD2tQD7uAD+ugAAAAD/uwDhmeTRAAAADHRSTlMJ8mN1EYcbmiixgACm7WbuAAAAVklEQVR42n3PUQqAIBBFUU1LLc3u/jdbOJoW1P08DA9Gba8+YWJ6gNJoNYIBzAA2chBth5kLmG9YUoG0NHAUwFXwO9LuBQL1giCQb8gC9Oro2vp5rncCIY8L8uEx5ZkAAAAASUVORK5CYII=); }
.CodeMirror-lint-marker-multiple { background-image: url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAcAAAAHCAMAAADzjKfhAAAACVBMVEUAAAAAAAC/v7914kyHAAAAAXRSTlMAQObYZgAAACNJREFUeNo1ioEJAAAIwmz/H90iFFSGJgFMe3gaLZ0od+9/AQZ0ADosbYraAAAAAElFTkSuQmCC); width: 100%; height: 100%; background-position: 100% 100%; background-repeat: no-repeat no-repeat; }


html { font-size: 14px; background-color: rgb(255, 255, 255); color: rgb(51, 51, 51); }
body { margin: 0px; padding: 0px; height: auto; bottom: 0px; top: 0px; left: 0px; right: 0px; font-family: 'Helvetica Neue', Helvetica, Arial, sans-serif; font-size: 1rem; line-height: 1.42857143; overflow-x: hidden; background-image: inherit; background-size: inherit; background-attachment: inherit; background-origin: inherit; background-clip: inherit; background-color: inherit; background-position: inherit inherit; background-repeat: inherit inherit; }
a:active, a:hover { outline: 0px; }
.in-text-selection, ::selection { background-color: rgb(181, 214, 252); text-shadow: none; background-position: initial initial; background-repeat: initial initial; }
#write { margin: 0px auto; height: auto; width: inherit; word-break: normal; word-wrap: break-word; position: relative; padding-bottom: 70px; white-space: pre-wrap; overflow-x: auto; }
.for-image #write { padding-left: 8px; padding-right: 8px; }
body.typora-export { padding-left: 30px; padding-right: 30px; }
@media screen and (max-width: 500px) { 
  body.typora-export { padding-left: 0px; padding-right: 0px; }
  .CodeMirror-sizer { margin-left: 0px !important; }
  .CodeMirror-gutters { display: none !important; }
}
.typora-export #write { margin: 0px auto; }
#write > p:first-child, #write > ul:first-child, #write > ol:first-child, #write > pre:first-child, #write > blockquote:first-child, #write > div:first-child, #write > table:first-child { margin-top: 30px; }
#write li > table:first-child { margin-top: -20px; }
img { max-width: 100%; vertical-align: middle; }
input, button, select, textarea { color: inherit; font-family: inherit; font-size: inherit; font-style: inherit; font-variant-caps: inherit; font-weight: inherit; line-height: inherit; }
input[type="checkbox"], input[type="radio"] { line-height: normal; padding: 0px; }
::before, ::after, * { box-sizing: border-box; }
#write p, #write h1, #write h2, #write h3, #write h4, #write h5, #write h6, #write div, #write pre { width: inherit; }
#write p, #write h1, #write h2, #write h3, #write h4, #write h5, #write h6 { position: relative; }
h1 { font-size: 2rem; }
h2 { font-size: 1.8rem; }
h3 { font-size: 1.6rem; }
h4 { font-size: 1.4rem; }
h5 { font-size: 1.2rem; }
h6 { font-size: 1rem; }
p { -webkit-margin-before: 1rem; -webkit-margin-after: 1rem; -webkit-margin-start: 0px; -webkit-margin-end: 0px; }
.mathjax-block { margin-top: 0px; margin-bottom: 0px; -webkit-margin-before: 0rem; -webkit-margin-after: 0rem; }
.hidden { display: none; }
.md-blockmeta { color: rgb(204, 204, 204); font-weight: bold; font-style: italic; }
a { cursor: pointer; }
#write input[type="checkbox"] { cursor: pointer; width: inherit; height: inherit; margin: 4px 0px 0px; }
tr { page-break-inside: avoid; page-break-after: auto; }
thead { display: table-header-group; }
table { border-collapse: collapse; border-spacing: 0px; width: 100%; overflow: auto; page-break-inside: auto; text-align: left; }
table.md-table td { min-width: 80px; }
.CodeMirror-gutters { border-right-width: 0px; background-color: inherit; }
.CodeMirror { text-align: left; }
.CodeMirror-placeholder { opacity: 0.3; }
.CodeMirror pre { padding: 0px 4px; }
.CodeMirror-lines { padding: 0px; }
div.hr:focus { cursor: none; }
pre { white-space: pre-wrap; }
.CodeMirror-gutters { margin-right: 4px; }
.md-fences { font-size: 0.9rem; display: block; page-break-inside: avoid; text-align: left; overflow: visible; white-space: pre; background-image: inherit; background-size: inherit; background-attachment: inherit; background-origin: inherit; background-clip: inherit; background-color: inherit; position: relative !important; background-position: inherit inherit; background-repeat: inherit inherit; }
.md-diagram-panel { width: 100%; margin-top: 10px; text-align: center; padding-top: 0px; padding-bottom: 8px; overflow-x: auto; }
.md-fences .CodeMirror.CodeMirror-wrap { top: -1.6em; margin-bottom: -1.6em; }
.md-fences.mock-cm { white-space: pre-wrap; }
.show-fences-line-number .md-fences { padding-left: 0px; }
.show-fences-line-number .md-fences.mock-cm { padding-left: 40px; }
.footnotes { opacity: 0.8; font-size: 0.9rem; padding-top: 1em; padding-bottom: 1em; }
.footnotes + .footnotes { margin-top: -1em; }
.md-reset { margin: 0px; padding: 0px; border: 0px; outline: 0px; vertical-align: top; background-color: transparent; text-decoration: none; text-shadow: none; float: none; position: static; width: auto; height: auto; white-space: nowrap; cursor: inherit; line-height: normal; font-weight: normal; text-align: left; box-sizing: content-box; direction: ltr; background-position: initial initial; background-repeat: initial initial; }
li div { padding-top: 0px; }
blockquote { margin: 1rem 0px; }
li p, li .mathjax-block { margin: 0.5rem 0px; }
li { margin: 0px; position: relative; }
blockquote > :last-child { margin-bottom: 0px; }
blockquote > :first-child { margin-top: 0px; }
.footnotes-area { color: rgb(136, 136, 136); margin-top: 0.714rem; padding-bottom: 0.143rem; }
@media print { 
  html, body { height: 100%; }
  .typora-export * { -webkit-print-color-adjust: exact; }
  h1, h2, h3, h4, h5, h6 { page-break-after: avoid; orphans: 2; }
  p { orphans: 4; }
  html.blink-to-pdf { font-size: 13px; }
  .typora-export #write { padding-left: 1cm; padding-right: 1cm; }
  .typora-export #write::after { height: 0px; }
  @page { margin: 20mm 0mm; }
}
.footnote-line { margin-top: 0.714em; font-size: 0.7em; }
a img, img a { cursor: pointer; }
pre.md-meta-block { font-size: 0.8rem; min-height: 2.86rem; white-space: pre-wrap; background-color: rgb(204, 204, 204); display: block; overflow-x: hidden; background-position: initial initial; background-repeat: initial initial; }
p .md-image:only-child { display: inline-block; width: 100%; text-align: center; }
#write .MathJax_Display { margin: 0.8em 0px 0px; }
.mathjax-block { white-space: pre; overflow: hidden; width: 100%; }
p + .mathjax-block { margin-top: -1.143rem; }
.mathjax-block:not(:empty)::after { display: none; }
[contenteditable="true"]:active, [contenteditable="true"]:focus { outline: none; box-shadow: none; }
.task-list { list-style-type: none; }
.task-list-item { position: relative; padding-left: 1em; }
.task-list-item input { position: absolute; top: 0px; left: 0px; }
.math { font-size: 1rem; }
.md-toc { min-height: 3.58rem; position: relative; font-size: 0.9rem; border-top-left-radius: 10px; border-top-right-radius: 10px; border-bottom-right-radius: 10px; border-bottom-left-radius: 10px; }
.md-toc-content { position: relative; margin-left: 0px; }
.md-toc::after, .md-toc-content::after { display: none; }
.md-toc-item { display: block; color: rgb(65, 131, 196); text-decoration: none; }
.md-toc-inner:hover { }
.md-toc-inner { display: inline-block; cursor: pointer; }
.md-toc-h1 .md-toc-inner { margin-left: 0px; font-weight: bold; }
.md-toc-h2 .md-toc-inner { margin-left: 2em; }
.md-toc-h3 .md-toc-inner { margin-left: 4em; }
.md-toc-h4 .md-toc-inner { margin-left: 6em; }
.md-toc-h5 .md-toc-inner { margin-left: 8em; }
.md-toc-h6 .md-toc-inner { margin-left: 10em; }
@media screen and (max-width: 48em) { 
  .md-toc-h3 .md-toc-inner { margin-left: 3.5em; }
  .md-toc-h4 .md-toc-inner { margin-left: 5em; }
  .md-toc-h5 .md-toc-inner { margin-left: 6.5em; }
  .md-toc-h6 .md-toc-inner { margin-left: 8em; }
}
a.md-toc-inner { font-size: inherit; font-style: inherit; font-weight: inherit; line-height: inherit; }
.footnote-line a:not(.reversefootnote) { color: inherit; }
.md-attr { display: none; }
.md-fn-count::after { content: '.'; }
.md-tag { opacity: 0.5; }
.md-comment { color: rgb(162, 127, 3); opacity: 0.8; font-family: monospace; }
code { text-align: left; }
h1 .md-tag, h2 .md-tag, h3 .md-tag, h4 .md-tag, h5 .md-tag, h6 .md-tag { font-weight: initial; opacity: 0.35; }
a.md-print-anchor { border: none !important; display: inline-block !important; position: absolute !important; width: 1px !important; right: 0px !important; outline: none !important; background-color: transparent !important; text-shadow: initial !important; background-position: initial initial !important; background-repeat: initial initial !important; }
.md-inline-math .MathJax_SVG .noError { display: none !important; }
.mathjax-block .MathJax_SVG_Display { text-align: center; margin: 1em 0em; position: relative; text-indent: 0px; max-width: none; max-height: none; min-height: 0px; min-width: 100%; width: auto; display: block !important; }
.MathJax_SVG_Display, .md-inline-math .MathJax_SVG_Display { width: auto; margin: inherit; display: inline-block !important; }
.MathJax_SVG .MJX-monospace { font-family: monospace; }
.MathJax_SVG .MJX-sans-serif { font-family: sans-serif; }
.MathJax_SVG { display: inline; font-style: normal; font-weight: normal; line-height: normal; zoom: 90%; text-indent: 0px; text-align: left; text-transform: none; letter-spacing: normal; word-spacing: normal; word-wrap: normal; white-space: nowrap; float: none; direction: ltr; max-width: none; max-height: none; min-width: 0px; min-height: 0px; border: 0px; padding: 0px; margin: 0px; }
.MathJax_SVG * { -webkit-transition: none; transition: none; }


@include-when-export url(http://fonts.googleapis.com/css?family=Open+Sans:400italic,700italic,700,400&subset=latin,latin-ext);

/**
 * css forked from https://github.com/GitbookIO/gitbook 
 * www.gitbook.com
 * Apache License
 * https://github.com/GitbookIO/gitbook/blob/master/LICENSE
 **/

@font-face {
    font-family: 'Open Sans';
    font-style: normal;
    font-weight: normal;
    src: local('Open Sans Regular'),url('file:///Users/kb/Library/Application%20Support/abnerworks.Typora/themes/github/400.woff') format('woff')
}

@font-face {
    font-family: 'Open Sans';
    font-style: italic;
    font-weight: normal;
    src: local('Open Sans Italic'),url('file:///Users/kb/Library/Application%20Support/abnerworks.Typora/themes/github/400i.woff') format('woff')
}

@font-face {
    font-family: 'Open Sans';
    font-style: normal;
    font-weight: bold;
    src: local('Open Sans Bold'),url('file:///Users/kb/Library/Application%20Support/abnerworks.Typora/themes/github/700.woff') format('woff')
}

@font-face {
    font-family: 'Open Sans';
    font-style: italic;
    font-weight: bold;
    src: local('Open Sans Bold Italic'),url('file:///Users/kb/Library/Application%20Support/abnerworks.Typora/themes/github/700i.woff') format('woff')
}

html {
    font-size: 16px;
}

body {
    font-family: "Open Sans","Clear Sans","Helvetica Neue",Helvetica,Arial,sans-serif;
    color: rgb(51, 51, 51);
    line-height: 1.6;
}

#write{
    max-width: 860px;
  	margin: 0 auto;
  	padding: 20px 30px 40px 30px;
	padding-top: 20px;
    padding-bottom: 100px;
}
#write > ul:first-child,
#write > ol:first-child{
    margin-top: 30px;
}

body > *:first-child {
    margin-top: 0 !important;
}
body > *:last-child {
    margin-bottom: 0 !important;
}
a {
    color: #4183C4;
}
h1,
h2,
h3,
h4,
h5,
h6 {
    position: relative;
    margin-top: 1rem;
    margin-bottom: 1rem;
    font-weight: bold;
    line-height: 1.4;
    cursor: text;
}
h1:hover a.anchor,
h2:hover a.anchor,
h3:hover a.anchor,
h4:hover a.anchor,
h5:hover a.anchor,
h6:hover a.anchor {
    /*background: url("file:///Users/kb/Library/Application%20Support/images/modules/styleguide/para.png") no-repeat 10px center;*/
    text-decoration: none;
}
h1 tt,
h1 code {
    font-size: inherit;
}
h2 tt,
h2 code {
    font-size: inherit;
}
h3 tt,
h3 code {
    font-size: inherit;
}
h4 tt,
h4 code {
    font-size: inherit;
}
h5 tt,
h5 code {
    font-size: inherit;
}
h6 tt,
h6 code {
    font-size: inherit;
}
h1 {
    padding-bottom: .3em;
    font-size: 2.25em;
    line-height: 1.2;
    border-bottom: 1px solid #eee;
}
h2 {
   padding-bottom: .3em;
    font-size: 1.75em;
    line-height: 1.225;
    border-bottom: 1px solid #eee;
}
h3 {
    font-size: 1.5em;
    line-height: 1.43;
}
h4 {
    font-size: 1.25em;
}
h5 {
    font-size: 1em;
}
h6 {
   font-size: 1em;
    color: #777;
}
p,
blockquote,
ul,
ol,
dl,
table{
    margin: 0.8em 0;
}
li>ol,
li>ul {
    margin: 0 0;
}
hr {
    height: 4px;
    padding: 0;
    margin: 16px 0;
    background-color: #e7e7e7;
    border: 0 none;
    overflow: hidden;
    box-sizing: content-box;
    border-bottom: 1px solid #ddd;
}

body > h2:first-child {
    margin-top: 0;
    padding-top: 0;
}
body > h1:first-child {
    margin-top: 0;
    padding-top: 0;
}
body > h1:first-child + h2 {
    margin-top: 0;
    padding-top: 0;
}
body > h3:first-child,
body > h4:first-child,
body > h5:first-child,
body > h6:first-child {
    margin-top: 0;
    padding-top: 0;
}
a:first-child h1,
a:first-child h2,
a:first-child h3,
a:first-child h4,
a:first-child h5,
a:first-child h6 {
    margin-top: 0;
    padding-top: 0;
}
h1 p,
h2 p,
h3 p,
h4 p,
h5 p,
h6 p {
    margin-top: 0;
}
li p.first {
    display: inline-block;
}
ul,
ol {
    padding-left: 30px;
}
ul:first-child,
ol:first-child {
    margin-top: 0;
}
ul:last-child,
ol:last-child {
    margin-bottom: 0;
}
blockquote {
    border-left: 4px solid #dddddd;
    padding: 0 15px;
    color: #777777;
}
blockquote blockquote {
    padding-right: 0;
}
table {
    padding: 0;
    word-break: initial;
}
#write {
    overflow-x: auto;
}
table tr {
    border-top: 1px solid #cccccc;
    background-color: white;
    margin: 0;
    padding: 0;
}
table tr:nth-child(2n) {
    background-color: #f8f8f8;
}
table tr th {
    font-weight: bold;
    border: 1px solid #cccccc;
    text-align: left;
    margin: 0;
    padding: 6px 13px;
}
table tr td {
    border: 1px solid #cccccc;
    text-align: left;
    margin: 0;
    padding: 6px 13px;
}
table tr th:first-child,
table tr td:first-child {
    margin-top: 0;
}
table tr th:last-child,
table tr td:last-child {
    margin-bottom: 0;
}

.CodeMirror-gutters {
    border-right: 1px solid #ddd;
}

.md-fences,
code,
tt {
    border: 1px solid #ddd;
    background-color: #f8f8f8;
    border-radius: 3px;
    padding: 0;
    font-family: Consolas, "Liberation Mono", Courier, monospace;
    padding: 2px 4px 0px 4px;
    font-size: 0.9em;
}

.md-fences {
    margin-bottom: 15px;
    margin-top: 15px;
    padding: 0.2em 1em;
    padding-top: 8px;
    padding-bottom: 6px;
}
.task-list{
	padding-left: 0;
}

.task-list-item {
	padding-left:32px;
}

.task-list-item input {
  top: 3px;
  left: 8px;
}

@media screen and (min-width: 914px) {
    /*body {
        width: 854px;
        margin: 0 auto;
    }*/
}
@media print {
    html {
        font-size: 13px;
    }
    table,
    pre {
        page-break-inside: avoid;
    }
    pre {
        word-wrap: break-word;
    }
}

.md-fences {
	background-color: #f8f8f8;
}
#write pre.md-meta-block {
	padding: 1rem;
    font-size: 85%;
    line-height: 1.45;
    background-color: #f7f7f7;
    border: 0;
    border-radius: 3px;
    color: #777777;
    margin-top: 0 !important;
}

.mathjax-block>.code-tooltip {
	bottom: .375rem;
}

#write>h3.md-focus:before{
	left: -1.5625rem;
	top: .375rem;
}
#write>h4.md-focus:before{
	left: -1.5625rem;
	top: .285714286rem;
}
#write>h5.md-focus:before{
	left: -1.5625rem;
	top: .285714286rem;
}
#write>h6.md-focus:before{
	left: -1.5625rem;
	top: .285714286rem;
}
.md-image>.md-meta {
    border: 1px solid #ddd;
    background-color: #f8f8f8;
    border-radius: 3px;
    font-family: Consolas, "Liberation Mono", Courier, monospace;
    padding: 2px 4px 0px 4px;
    font-size: 0.9em;
    color: inherit;
}

.md-tag{
	color: inherit;
}

.md-toc { 
    margin-top:20px;
    padding-bottom:20px;
}

#typora-quick-open {
    border: 1px solid #ddd;
    background-color: #f8f8f8;
}

#typora-quick-open-item {
    background-color: #FAFAFA;
    border-color: #FEFEFE #e5e5e5 #e5e5e5 #eee;
    border-style: solid;
    border-width: 1px;
}

#md-notification:before {
    top: 10px;
}

/** focus mode */
.on-focus-mode blockquote {
    border-left-color: rgba(85, 85, 85, 0.12);
}

header, .context-menu, .megamenu-content, footer{
    font-family: "Segoe UI", "Arial", sans-serif;
}


</style>
</head>
<body class='typora-export' >
<div  id='write'  class = 'is-mac'><h1><a name='header-c413' class='md-header-anchor '></a>Аналізуємо події за допомогою Riak, Pipes та Foldl</h1><p></p><h1><a name='header-c417' class='md-header-anchor '></a>Огляд проблеми, яку вирішуємо</h1><ul><li>Порахувати від 1 до 1000 не так-то й просто</li><li>Система записує складні структуровані дані у великій кількості</li><li>Їх потрібно аналізувати, генеруючи деякий результат, візуалізацію</li></ul><h1><a name='header-c429' class='md-header-anchor '></a>Мотивація, більшість існуючих систем</h1><ul><li>Слабка або відсутність типізації</li><li>Не на Хаскелі</li><li>Важко писати та підтримувати map/reduce</li><li>Важко тестувати</li><li>Відсутність композиції</li></ul><h1><a name='header-c447' class='md-header-anchor '></a>&quot;Beautiful folds&quot; (Красиві згортачі?)</h1><ul><li><a href='http://squing.blogspot.com/2008/11/beautiful-folding.html'>Beautiful folding (Max Rabkin, 2008)</a></li><li><a href='http://www.haskellforall.com/2013/08/composable-streaming-folds.html'>Composable streaming folds (Gabriel Gonzalez, 2013)</a></li><li><a href='http://www.haskellforall.com/2013/08/foldl-100-composable-streaming-and.html'>foldl-1.0.0: Composable, streaming, and efficient left folds (Gabriel Gonzalez, 2013)</a></li><li>Популяризовано Scala-бібліотекою <code>algebird</code> , див <a href='https://www.youtube.com/watch?v=6a5Ti0r8Q2s'>MuniHac 2016: Beautiful folds are practical, too</a></li></ul><h1><a name='header-c462' class='md-header-anchor '></a>Beautiful folds – проблема</h1><pre class="md-fences md-end-block" lang="haskell"> <div class="CodeMirror cm-s-inner CodeMirror-wrap"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 4px;"></div><div class="CodeMirror-hscrollbar" style="left: 0px;"><div style="height: 100%; min-height: 1px; width: 0px;"></div></div><div class="CodeMirror-vscrollbar"><div style="min-width: 1px; height: 0px;"></div></div><div class="CodeMirror-scrollbar-filler"></div><div class="CodeMirror-gutter-filler"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; min-height: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines"><div style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><pre class=""><span style="padding-right: 0.1px;"><span class="cm-error">λ</span> <span class="cm-keyword">:</span>{</span></pre></div><pre class=""><span style="padding-right: 0.1px;"><span class="cm-variable-2">Prelude</span> <span class="cm-qualifier">Data.</span><span class="cm-variable-2">List</span> <span class="cm-qualifier">Data.</span><span class="cm-variable-2">List</span><span class="cm-variable">|</span> <span class="cm-builtin">sum</span> <span class="cm-keyword">::</span> (<span class="cm-builtin">Num</span> <span class="cm-variable">a</span>) <span class="cm-keyword">=&gt;</span> [<span class="cm-variable">a</span>] <span class="cm-keyword">-&gt;</span> <span class="cm-variable">a</span></span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-variable-2">Prelude</span> <span class="cm-qualifier">Data.</span><span class="cm-variable-2">List</span> <span class="cm-qualifier">Data.</span><span class="cm-variable-2">List</span><span class="cm-variable">|</span> <span class="cm-builtin">sum</span> <span class="cm-keyword">=</span> <span class="cm-variable">foldl'</span> (<span class="cm-builtin">+</span>) <span class="cm-number">0</span></span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-variable-2">Prelude</span> <span class="cm-qualifier">Data.</span><span class="cm-variable-2">List</span> <span class="cm-qualifier">Data.</span><span class="cm-variable-2">List</span><span class="cm-variable">|</span> <span class="cm-keyword">:</span>}</span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-variable">&gt;&gt;&gt;</span> <span class="cm-variable">genericLength</span> [<span class="cm-number">1.</span><span class="cm-builtin">.</span><span class="cm-number">100000000</span>]</span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-number">100000000</span></span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-variable">&gt;&gt;&gt;</span> <span class="cm-builtin">sum</span> [<span class="cm-number">1.</span><span class="cm-builtin">.</span><span class="cm-number">100000000</span>]</span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-number">5000000050000000</span></span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-variable">&gt;&gt;&gt;</span> <span class="cm-keyword">let</span> <span class="cm-variable">average</span> <span class="cm-variable">xs</span> <span class="cm-keyword">=</span> <span class="cm-builtin">sum</span> <span class="cm-variable">xs</span> <span class="cm-builtin">/</span> <span class="cm-variable">genericLength</span> <span class="cm-variable">xs</span></span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-variable">&gt;&gt;&gt;</span> <span class="cm-variable">average</span> [<span class="cm-number">1.</span><span class="cm-builtin">.</span><span class="cm-number">100000000</span>]</span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-builtin">&lt;</span><span class="cm-variable-2">Huge</span> <span class="cm-variable">space</span> <span class="cm-variable">leak</span><span class="cm-builtin">&gt;</span></span></pre></div></div></div></div></div><div style="position: absolute; height: 30px; width: 1px; top: 0px;"></div><div class="CodeMirror-gutters" style="display: none; height: 242px;"></div></div></div></pre><p></p><h1><a name='header-c466' class='md-header-anchor '></a>Beautiful folds – наївне вирішення</h1><pre class="md-fences md-end-block" lang="haskell"> <div class="CodeMirror cm-s-inner CodeMirror-wrap"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 4px;"></div><div class="CodeMirror-hscrollbar" style="left: 0px;"><div style="height: 100%; min-height: 1px; width: 0px;"></div></div><div class="CodeMirror-vscrollbar"><div style="min-width: 1px; height: 0px;"></div></div><div class="CodeMirror-scrollbar-filler"></div><div class="CodeMirror-gutter-filler"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; min-height: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines"><div style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><pre class=""><span style="padding-right: 0.1px;"><span class="cm-variable">mean</span> <span class="cm-keyword">::</span> [<span class="cm-builtin">Double</span>] <span class="cm-keyword">-&gt;</span> <span class="cm-builtin">Double</span></span></pre></div><pre class=""><span style="padding-right: 0.1px;"><span class="cm-variable">mean</span> <span class="cm-keyword">=</span> <span class="cm-variable">go</span> <span class="cm-number">0</span> <span class="cm-number">0</span></span></pre><pre class=""><span style="padding-right: 0.1px;">  <span class="cm-keyword">where</span></span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  <span class="cm-variable">go</span> <span class="cm-variable">s</span> <span class="cm-variable">l</span> [] &nbsp; &nbsp; <span class="cm-keyword">=</span> <span class="cm-variable">s</span> <span class="cm-builtin">/</span> <span class="cm-builtin">fromIntegral</span> <span class="cm-variable">l</span></span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  <span class="cm-variable">go</span> <span class="cm-variable">s</span> <span class="cm-variable">l</span> (<span class="cm-variable">x</span><span class="cm-keyword">:</span><span class="cm-variable">xs</span>) <span class="cm-keyword">=</span> <span class="cm-variable">s</span> `<span class="cm-builtin">seq</span>` <span class="cm-variable">l</span> `<span class="cm-builtin">seq</span>`</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  <span class="cm-variable">go</span> (<span class="cm-variable">s</span><span class="cm-builtin">+</span><span class="cm-variable">x</span>) (<span class="cm-variable">l</span><span class="cm-builtin">+</span><span class="cm-number">1</span>) <span class="cm-variable">xs</span></span></pre></div></div></div></div></div><div style="position: absolute; height: 30px; width: 1px; top: 0px;"></div><div class="CodeMirror-gutters" style="display: none; height: 132px;"></div></div></div></pre><p></p><h1><a name='header-c470' class='md-header-anchor '></a>Еволюція</h1><pre class="md-fences md-end-block" lang="haskell"> <div class="CodeMirror cm-s-inner CodeMirror-wrap"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 4px;"></div><div class="CodeMirror-hscrollbar" style="left: 0px;"><div style="height: 100%; min-height: 1px; width: 0px;"></div></div><div class="CodeMirror-vscrollbar"><div style="min-width: 1px; height: 0px;"></div></div><div class="CodeMirror-scrollbar-filler"></div><div class="CodeMirror-gutter-filler"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; min-height: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines"><div style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><pre class=""><span style="padding-right: 0.1px;"><span class="cm-variable">foldl'</span> <span class="cm-keyword">::</span> (<span class="cm-variable">a</span> <span class="cm-keyword">-&gt;</span> <span class="cm-variable">b</span> <span class="cm-keyword">-&gt;</span> <span class="cm-variable">a</span>) <span class="cm-keyword">-&gt;</span> <span class="cm-variable">a</span> <span class="cm-keyword">-&gt;</span> [<span class="cm-variable">b</span>] <span class="cm-keyword">-&gt;</span> <span class="cm-variable">a</span></span></pre></div><pre class=""><span style="padding-right: 0.1px;"><span>​</span></span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-keyword">data</span> <span class="cm-variable-2">Fold</span> <span class="cm-variable">b</span> <span class="cm-variable">c</span> <span class="cm-keyword">=</span> <span class="cm-variable">forall</span> <span class="cm-variable">a</span><span class="cm-builtin">.</span> <span class="cm-variable-2">F</span> (<span class="cm-variable">a</span> <span class="cm-keyword">-&gt;</span> <span class="cm-variable">b</span> <span class="cm-keyword">-&gt;</span> <span class="cm-variable">a</span>) <span class="cm-variable">a</span> (<span class="cm-variable">a</span> <span class="cm-keyword">-&gt;</span> <span class="cm-variable">c</span>)</span></pre><pre class=""><span style="padding-right: 0.1px;"><span>​</span></span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-keyword">data</span> <span class="cm-variable-2">Fold</span> <span class="cm-variable">b</span> <span class="cm-variable">a</span> <span class="cm-keyword">=</span> <span class="cm-variable-2">F</span> (<span class="cm-variable">a</span> <span class="cm-keyword">-&gt;</span> <span class="cm-variable">b</span> <span class="cm-keyword">-&gt;</span> <span class="cm-variable">a</span>) <span class="cm-variable">a</span></span></pre><pre class=""><span style="padding-right: 0.1px;"><span>​</span></span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-keyword">data</span> <span class="cm-variable-2">Fold</span> <span class="cm-variable">i</span> <span class="cm-variable">o</span> <span class="cm-keyword">=</span> <span class="cm-variable">forall</span> <span class="cm-variable">m</span> <span class="cm-builtin">.</span> <span class="cm-variable-2">Monoid</span> <span class="cm-variable">m</span> <span class="cm-keyword">=&gt;</span> <span class="cm-variable-2">Fold</span> (<span class="cm-variable">i</span> <span class="cm-keyword">-&gt;</span> <span class="cm-variable">m</span>) (<span class="cm-variable">m</span> <span class="cm-keyword">-&gt;</span> <span class="cm-variable">o</span>)</span></pre></div></div></div></div></div><div style="position: absolute; height: 30px; width: 1px; top: 0px;"></div><div class="CodeMirror-gutters" style="display: none; height: 154px;"></div></div></div></pre><p></p><h1><a name='header-c474' class='md-header-anchor '></a>Beautiful folds в один слайд</h1><p>Імплементація в 14 строк Хаскеля:</p><pre class="md-fences md-end-block" lang="haskell"> <div class="CodeMirror cm-s-inner CodeMirror-wrap"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 4px;"></div><div class="CodeMirror-hscrollbar" style="left: 0px;"><div style="height: 100%; min-height: 1px; width: 0px;"></div></div><div class="CodeMirror-vscrollbar"><div style="min-width: 1px; height: 0px;"></div></div><div class="CodeMirror-scrollbar-filler"></div><div class="CodeMirror-gutter-filler"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; min-height: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines"><div style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><pre class=""><span style="padding-right: 0.1px;"><span class="cm-meta">{-# LANGUAGE ExistentialQuantification #-}</span></span></pre></div><pre class=""><span style="padding-right: 0.1px;"><span class="cm-meta">{-# LANGUAGE RankNTypes &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  #-}</span></span></pre><pre class=""><span style="padding-right: 0.1px;"><span>​</span></span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-keyword">import</span> <span class="cm-qualifier">Control.</span><span class="cm-variable-2">Lens</span> (<span class="cm-variable-2">Getting</span>, <span class="cm-variable">foldMapOf</span>)</span></pre><pre class=""><span style="padding-right: 0.1px;"><span>​</span></span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-keyword">data</span> <span class="cm-variable-2">Fold</span> <span class="cm-variable">i</span> <span class="cm-variable">o</span> <span class="cm-keyword">=</span> <span class="cm-variable">forall</span> <span class="cm-variable">m</span> <span class="cm-builtin">.</span> <span class="cm-variable-2">Monoid</span> <span class="cm-variable">m</span> <span class="cm-keyword">=&gt;</span> <span class="cm-variable-2">Fold</span> (<span class="cm-variable">i</span> <span class="cm-keyword">-&gt;</span> <span class="cm-variable">m</span>) (<span class="cm-variable">m</span> <span class="cm-keyword">-&gt;</span> <span class="cm-variable">o</span>)</span></pre><pre class=""><span style="padding-right: 0.1px;"><span>​</span></span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-keyword">instance</span> <span class="cm-builtin">Functor</span> (<span class="cm-variable-2">Fold</span> <span class="cm-variable">i</span>) <span class="cm-keyword">where</span></span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  <span class="cm-builtin">fmap</span> <span class="cm-variable">k</span> (<span class="cm-variable-2">Fold</span> <span class="cm-variable">tally</span> <span class="cm-variable">summarize</span>) <span class="cm-keyword">=</span> <span class="cm-variable-2">Fold</span> <span class="cm-variable">tally</span> (<span class="cm-variable">k</span> <span class="cm-builtin">.</span> <span class="cm-variable">summarize</span>)</span></pre><pre class=""><span style="padding-right: 0.1px;"><span>​</span></span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-keyword">instance</span> <span class="cm-variable-2">Applicative</span> (<span class="cm-variable-2">Fold</span> <span class="cm-variable">i</span>) <span class="cm-keyword">where</span></span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  <span class="cm-variable">pure</span> <span class="cm-variable">o</span> <span class="cm-keyword">=</span> <span class="cm-variable-2">Fold</span> (<span class="cm-keyword">\_</span> <span class="cm-keyword">-&gt;</span> ()) (<span class="cm-keyword">\_</span> <span class="cm-keyword">-&gt;</span> <span class="cm-variable">o</span>)</span></pre><pre class=""><span style="padding-right: 0.1px;"><span>​</span></span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  <span class="cm-variable-2">Fold</span> <span class="cm-variable">tallyF</span> <span class="cm-variable">summarizeF</span> <span class="cm-variable">&lt;*&gt;</span> <span class="cm-variable-2">Fold</span> <span class="cm-variable">tallyX</span> <span class="cm-variable">summarizeX</span> <span class="cm-keyword">=</span> <span class="cm-variable-2">Fold</span> <span class="cm-variable">tally</span> <span class="cm-variable">summarize</span></span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp;  <span class="cm-keyword">where</span></span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  <span class="cm-variable">tally</span> <span class="cm-variable">i</span> <span class="cm-keyword">=</span> (<span class="cm-variable">tallyF</span> <span class="cm-variable">i</span>, <span class="cm-variable">tallyX</span> <span class="cm-variable">i</span>)</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  <span class="cm-variable">summarize</span> (<span class="cm-variable">mF</span>, <span class="cm-variable">mX</span>) <span class="cm-keyword">=</span> <span class="cm-variable">summarizeF</span> <span class="cm-variable">mF</span> (<span class="cm-variable">summarizeX</span> <span class="cm-variable">mX</span>)</span></pre><pre class=""><span style="padding-right: 0.1px;"><span>​</span></span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-variable">focus</span> <span class="cm-keyword">::</span> (<span class="cm-variable">forall</span> <span class="cm-variable">m</span> <span class="cm-builtin">.</span> <span class="cm-variable-2">Monoid</span> <span class="cm-variable">m</span> <span class="cm-keyword">=&gt;</span> <span class="cm-variable-2">Getting</span> <span class="cm-variable">m</span> <span class="cm-variable">b</span> <span class="cm-variable">a</span>) <span class="cm-keyword">-&gt;</span> <span class="cm-variable-2">Fold</span> <span class="cm-variable">a</span> <span class="cm-variable">o</span> <span class="cm-keyword">-&gt;</span> <span class="cm-variable-2">Fold</span> <span class="cm-variable">b</span> <span class="cm-variable">o</span></span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-variable">focus</span> <span class="cm-variable">lens</span> (<span class="cm-variable-2">Fold</span> <span class="cm-variable">tally</span> <span class="cm-variable">summarize</span>) <span class="cm-keyword">=</span> <span class="cm-variable-2">Fold</span> (<span class="cm-variable">foldMapOf</span> <span class="cm-variable">lens</span> <span class="cm-variable">tally</span>) <span class="cm-variable">summarize</span></span></pre></div></div></div></div></div><div style="position: absolute; height: 30px; width: 1px; top: 0px;"></div><div class="CodeMirror-gutters" style="display: none; height: 440px;"></div></div></div></pre><p></p><h1><a name='header-c480' class='md-header-anchor '></a>Простий приклад</h1><pre class="md-fences md-end-block" lang="haskell"> <div class="CodeMirror cm-s-inner CodeMirror-wrap"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 4px;"></div><div class="CodeMirror-hscrollbar" style="left: 0px;"><div style="height: 100%; min-height: 1px; width: 0px;"></div></div><div class="CodeMirror-vscrollbar"><div style="min-width: 1px; height: 0px;"></div></div><div class="CodeMirror-scrollbar-filler"></div><div class="CodeMirror-gutter-filler"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; min-height: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines"><div style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><pre class=""><span style="padding-right: 0.1px;"><span class="cm-meta">{-# LANGUAGE ExistentialQuantification #-}</span></span></pre></div><pre class=""><span style="padding-right: 0.1px;"><span>​</span></span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-keyword">import</span> <span class="cm-qualifier">Data.</span><span class="cm-variable-2">Monoid</span></span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-keyword">import</span> <span class="cm-variable-2">Prelude</span> <span class="cm-variable">hiding</span> (<span class="cm-builtin">sum</span>)</span></pre><pre class=""><span style="padding-right: 0.1px;"><span>​</span></span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-keyword">import</span> <span class="cm-variable">qualified</span> <span class="cm-qualifier">Data.</span><span class="cm-variable-2">Foldable</span></span></pre><pre class=""><span style="padding-right: 0.1px;"><span>​</span></span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-keyword">data</span> <span class="cm-variable-2">Fold</span> <span class="cm-variable">i</span> <span class="cm-variable">o</span> <span class="cm-keyword">=</span> <span class="cm-variable">forall</span> <span class="cm-variable">m</span> <span class="cm-builtin">.</span> <span class="cm-variable-2">Monoid</span> <span class="cm-variable">m</span> <span class="cm-keyword">=&gt;</span> <span class="cm-variable-2">Fold</span> (<span class="cm-variable">i</span> <span class="cm-keyword">-&gt;</span> <span class="cm-variable">m</span>) (<span class="cm-variable">m</span> <span class="cm-keyword">-&gt;</span> <span class="cm-variable">o</span>)</span></pre><pre class=""><span style="padding-right: 0.1px;"><span>​</span></span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-variable">fold</span> <span class="cm-keyword">::</span> <span class="cm-variable-2">Fold</span> <span class="cm-variable">i</span> <span class="cm-variable">o</span> <span class="cm-keyword">-&gt;</span> [<span class="cm-variable">i</span>] <span class="cm-keyword">-&gt;</span> <span class="cm-variable">o</span></span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-variable">fold</span> (<span class="cm-variable-2">Fold</span> <span class="cm-variable">tally</span> <span class="cm-variable">summarize</span>) <span class="cm-variable">is</span> <span class="cm-keyword">=</span> <span class="cm-variable">summarize</span> (<span class="cm-variable">reduce</span> (<span class="cm-builtin">map</span> <span class="cm-variable">tally</span> <span class="cm-variable">is</span>))</span></pre><pre class=""><span style="padding-right: 0.1px;">  <span class="cm-keyword">where</span></span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  <span class="cm-variable">reduce</span> <span class="cm-keyword">=</span> <span class="cm-qualifier">Data.Foldable.</span><span class="cm-variable">foldl'</span> (<span class="cm-variable">&lt;&gt;</span>) <span class="cm-variable">mempty</span></span></pre><pre class=""><span style="padding-right: 0.1px;"><span>​</span></span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-builtin">sum</span> <span class="cm-keyword">::</span> <span class="cm-builtin">Num</span> <span class="cm-variable">n</span> <span class="cm-keyword">=&gt;</span> <span class="cm-variable-2">Fold</span> <span class="cm-variable">n</span> <span class="cm-variable">n</span></span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-builtin">sum</span> <span class="cm-keyword">=</span> <span class="cm-variable-2">Fold</span> <span class="cm-variable-2">Sum</span> <span class="cm-variable">getSum</span></span></pre></div></div></div></div></div><div style="position: absolute; height: 30px; width: 1px; top: 0px;"></div><div class="CodeMirror-gutters" style="display: none; height: 352px;"></div></div></div></pre><p></p><h1><a name='header-c484' class='md-header-anchor '></a>Простий приклад</h1><pre class="md-fences md-end-block" lang="haskell"> <div class="CodeMirror cm-s-inner CodeMirror-wrap"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 4px;"></div><div class="CodeMirror-hscrollbar" style="left: 0px;"><div style="height: 100%; min-height: 1px; width: 0px;"></div></div><div class="CodeMirror-vscrollbar"><div style="min-width: 1px; height: 0px;"></div></div><div class="CodeMirror-scrollbar-filler"></div><div class="CodeMirror-gutter-filler"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; min-height: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines"><div style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><pre class=""><span style="padding-right: 0.1px;"><span class="cm-variable">&gt;&gt;&gt;</span> <span class="cm-variable">fold</span> <span class="cm-builtin">sum</span> [<span class="cm-number">1.</span><span class="cm-builtin">.</span><span class="cm-number">10</span>]</span></pre></div><pre class=""><span style="padding-right: 0.1px;"><span class="cm-number">55</span></span></pre></div></div></div></div></div><div style="position: absolute; height: 30px; width: 1px; top: 0px;"></div><div class="CodeMirror-gutters" style="display: none; height: 44px;"></div></div></div></pre><pre class='md-fences mock-cm' style='display:block;position:relative'>main :: IO ()
main = print (fold sum [(1::Int)..1000000000])</pre><pre class="md-fences md-end-block" lang="bash"> <div class="CodeMirror cm-s-inner CodeMirror-wrap"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 4px;"></div><div class="CodeMirror-hscrollbar" style="left: 0px;"><div style="height: 100%; min-height: 1px; width: 0px;"></div></div><div class="CodeMirror-vscrollbar"><div style="min-width: 1px; height: 0px;"></div></div><div class="CodeMirror-scrollbar-filler"></div><div class="CodeMirror-gutter-filler"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; min-height: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines"><div style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><pre class=""><span style="padding-right: 0.1px;"><span class="cm-def">$ time</span> ./example  <span class="cm-comment"># 0.3 ns / elem</span></span></pre></div><pre class=""><span style="padding-right: 0.1px;">500000000500000000</span></pre><pre class=""><span style="padding-right: 0.1px;"><span>​</span></span></pre><pre class=""><span style="padding-right: 0.1px;">real &nbsp;  0m0.322s</span></pre><pre class=""><span style="padding-right: 0.1px;">user &nbsp;  0m0.316s</span></pre><pre class=""><span style="padding-right: 0.1px;">sys &nbsp; &nbsp; 0m0.003s</span></pre></div></div></div></div></div><div style="position: absolute; height: 30px; width: 1px; top: 0px;"></div><div class="CodeMirror-gutters" style="display: none; height: 132px;"></div></div></div></pre><p></p><h1><a name='header-c490' class='md-header-anchor '></a>Як це працює?</h1><pre class="md-fences md-end-block" lang="haskell"> <div class="CodeMirror cm-s-inner CodeMirror-wrap"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 4px;"></div><div class="CodeMirror-hscrollbar" style="left: 0px;"><div style="height: 100%; min-height: 1px; width: 0px;"></div></div><div class="CodeMirror-vscrollbar"><div style="min-width: 1px; height: 0px;"></div></div><div class="CodeMirror-scrollbar-filler"></div><div class="CodeMirror-gutter-filler"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; min-height: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines"><div style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><pre class=""><span style="padding-right: 0.1px;"><span class="cm-builtin">print</span> (<span class="cm-variable">fold</span> <span class="cm-builtin">sum</span> [<span class="cm-number">1</span>, <span class="cm-number">2</span>, <span class="cm-number">3</span>, <span class="cm-number">4</span>])</span></pre></div><pre class=""><span style="padding-right: 0.1px;"><span>​</span></span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-comment">-- sum = Fold Sum getSum</span></span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-keyword">=</span> <span class="cm-builtin">print</span> (<span class="cm-variable">fold</span> (<span class="cm-variable-2">Fold</span> <span class="cm-variable-2">Sum</span> <span class="cm-variable">getSum</span>) [<span class="cm-number">1</span>, <span class="cm-number">2</span>, <span class="cm-number">3</span>, <span class="cm-number">4</span>])</span></pre><pre class=""><span style="padding-right: 0.1px;"><span>​</span></span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-comment">-- fold (Fold tally summarize) is = summarize (reduce (map tally is))</span></span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-keyword">=</span> <span class="cm-builtin">print</span> (<span class="cm-variable">getSum</span> (<span class="cm-variable">reduce</span> (<span class="cm-builtin">map</span> <span class="cm-variable-2">Sum</span> [<span class="cm-number">1</span>, <span class="cm-number">2</span>, <span class="cm-number">3</span>, <span class="cm-number">4</span>])))</span></pre><pre class=""><span style="padding-right: 0.1px;"><span>​</span></span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-comment">-- reduce = foldl' (&lt;&gt;) mempty</span></span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-keyword">=</span> <span class="cm-builtin">print</span> (<span class="cm-variable">getSum</span> (<span class="cm-variable">foldl'</span> (<span class="cm-variable">&lt;&gt;</span>) <span class="cm-variable">mempty</span> (<span class="cm-builtin">map</span> <span class="cm-variable-2">Sum</span> [<span class="cm-number">1</span>, <span class="cm-number">2</span>, <span class="cm-number">3</span>, <span class="cm-number">4</span>])))</span></pre><pre class=""><span style="padding-right: 0.1px;"><span>​</span></span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-comment">-- Definition of `map` (skipping a few steps)</span></span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-keyword">=</span> <span class="cm-builtin">print</span> (<span class="cm-variable">getSum</span> (<span class="cm-variable">foldl'</span> (<span class="cm-variable">&lt;&gt;</span>) <span class="cm-variable">mempty</span> [<span class="cm-variable-2">Sum</span> <span class="cm-number">1</span>, <span class="cm-variable-2">Sum</span> <span class="cm-number">2</span>, <span class="cm-variable-2">Sum</span> <span class="cm-number">3</span>, <span class="cm-variable-2">Sum</span> <span class="cm-number">4</span>]))</span></pre><pre class=""><span style="padding-right: 0.1px;"><span>​</span></span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-comment">-- `foldl' (&lt;&gt;) mempty` (skipping a few steps)</span></span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-keyword">=</span> <span class="cm-builtin">print</span> (<span class="cm-variable">getSum</span> (<span class="cm-variable">mempty</span> <span class="cm-variable">&lt;&gt;</span> <span class="cm-variable-2">Sum</span> <span class="cm-number">1</span> <span class="cm-variable">&lt;&gt;</span> <span class="cm-variable-2">Sum</span> <span class="cm-number">2</span> <span class="cm-variable">&lt;&gt;</span> <span class="cm-variable-2">Sum</span> <span class="cm-number">3</span> <span class="cm-variable">&lt;&gt;</span> <span class="cm-variable-2">Sum</span> <span class="cm-number">4</span>))</span></pre><pre class=""><span style="padding-right: 0.1px;"><span>​</span></span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-comment">-- mempty = Sum 0</span></span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-keyword">=</span> <span class="cm-builtin">print</span> (<span class="cm-variable">getSum</span> (<span class="cm-variable-2">Sum</span> <span class="cm-number">0</span> <span class="cm-variable">&lt;&gt;</span> <span class="cm-variable-2">Sum</span> <span class="cm-number">1</span> <span class="cm-variable">&lt;&gt;</span> <span class="cm-variable-2">Sum</span> <span class="cm-number">2</span> <span class="cm-variable">&lt;&gt;</span> <span class="cm-variable-2">Sum</span> <span class="cm-number">3</span> <span class="cm-variable">&lt;&gt;</span> <span class="cm-variable-2">Sum</span> <span class="cm-number">4</span>))</span></pre><pre class=""><span style="padding-right: 0.1px;"><span>​</span></span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-comment">-- Sum x &lt;&gt; Sum y = Sum (x + y)</span></span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-keyword">=</span> <span class="cm-builtin">print</span> (<span class="cm-variable">getSum</span> (<span class="cm-variable-2">Sum</span> <span class="cm-number">10</span>))</span></pre><pre class=""><span style="padding-right: 0.1px;"><span>​</span></span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-comment">-- getSum (Sum x) = x</span></span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-keyword">=</span> <span class="cm-builtin">print</span> <span class="cm-number">10</span></span></pre></div></div></div></div></div><div style="position: absolute; height: 30px; width: 1px; top: 0px;"></div><div class="CodeMirror-gutters" style="display: none; height: 550px;"></div></div></div></pre><p></p><h1><a name='header-c494' class='md-header-anchor '></a>Більш цікавий приклад</h1><pre class="md-fences md-end-block" lang="haskell"> <div class="CodeMirror cm-s-inner CodeMirror-wrap"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 4px;"></div><div class="CodeMirror-hscrollbar" style="left: 0px;"><div style="height: 100%; min-height: 1px; width: 0px;"></div></div><div class="CodeMirror-vscrollbar"><div style="min-width: 1px; height: 0px;"></div></div><div class="CodeMirror-scrollbar-filler"></div><div class="CodeMirror-gutter-filler"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; min-height: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines"><div style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><pre class=""><span style="padding-right: 0.1px;"><span class="cm-meta">{-# LANGUAGE BangPatterns #-}</span></span></pre></div><pre class=""><span style="padding-right: 0.1px;"><span>​</span></span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-keyword">data</span> <span class="cm-variable-2">Average</span> <span class="cm-variable">a</span> <span class="cm-keyword">=</span> <span class="cm-variable-2">Average</span> { <span class="cm-variable">numerator</span> <span class="cm-keyword">::</span> <span class="cm-variable">!a</span>, <span class="cm-variable">denominator</span> <span class="cm-keyword">::</span> <span class="cm-variable">!</span><span class="cm-builtin">Int</span> }</span></pre><pre class=""><span style="padding-right: 0.1px;"><span>​</span></span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-keyword">instance</span> <span class="cm-builtin">Num</span> <span class="cm-variable">a</span> <span class="cm-keyword">=&gt;</span> <span class="cm-variable-2">Monoid</span> (<span class="cm-variable-2">Average</span> <span class="cm-variable">a</span>) <span class="cm-keyword">where</span></span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  <span class="cm-variable">mempty</span> <span class="cm-keyword">=</span> <span class="cm-variable-2">Average</span> <span class="cm-number">0</span> <span class="cm-number">0</span></span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  <span class="cm-variable">mappend</span> (<span class="cm-variable-2">Average</span> <span class="cm-variable">xL</span> <span class="cm-variable">nL</span>) (<span class="cm-variable-2">Average</span> <span class="cm-variable">xR</span> <span class="cm-variable">nR</span>) <span class="cm-keyword">=</span> <span class="cm-variable-2">Average</span> (<span class="cm-variable">xL</span> <span class="cm-builtin">+</span> <span class="cm-variable">xR</span>) (<span class="cm-variable">nL</span> <span class="cm-builtin">+</span> <span class="cm-variable">nR</span>)</span></pre><pre class=""><span style="padding-right: 0.1px;"><span>​</span></span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-comment">-- Not a numerically stable average, but humor me</span></span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-variable">average</span> <span class="cm-keyword">::</span> <span class="cm-builtin">Fractional</span> <span class="cm-variable">a</span> <span class="cm-keyword">=&gt;</span> <span class="cm-variable-2">Fold</span> <span class="cm-variable">a</span> <span class="cm-variable">a</span></span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-variable">average</span> <span class="cm-keyword">=</span> <span class="cm-variable-2">Fold</span> <span class="cm-variable">tally</span> <span class="cm-variable">summarize</span></span></pre><pre class=""><span style="padding-right: 0.1px;">  <span class="cm-keyword">where</span></span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  <span class="cm-variable">tally</span> <span class="cm-variable">x</span> <span class="cm-keyword">=</span> <span class="cm-variable-2">Average</span> <span class="cm-variable">x</span> <span class="cm-number">1</span></span></pre><pre class=""><span style="padding-right: 0.1px;"><span>​</span></span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  <span class="cm-variable">summarize</span> (<span class="cm-variable-2">Average</span> <span class="cm-variable">numerator</span> <span class="cm-variable">denominator</span>) <span class="cm-keyword">=</span></span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  <span class="cm-variable">numerator</span> <span class="cm-builtin">/</span> <span class="cm-builtin">fromIntegral</span> <span class="cm-variable">denominator</span></span></pre></div></div></div></div></div><div style="position: absolute; height: 30px; width: 1px; top: 0px;"></div><div class="CodeMirror-gutters" style="display: none; height: 352px;"></div></div></div></pre><p></p><h1><a name='header-c498' class='md-header-anchor '></a>Приклад</h1><pre class="md-fences md-end-block" lang="haskell"> <div class="CodeMirror cm-s-inner CodeMirror-wrap"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 4px;"></div><div class="CodeMirror-hscrollbar" style="left: 0px;"><div style="height: 100%; min-height: 1px; width: 0px;"></div></div><div class="CodeMirror-vscrollbar"><div style="min-width: 1px; height: 0px;"></div></div><div class="CodeMirror-scrollbar-filler"></div><div class="CodeMirror-gutter-filler"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; min-height: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines"><div style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><pre class=""><span style="padding-right: 0.1px;"><span class="cm-variable">&gt;&gt;&gt;</span> <span class="cm-variable">fold</span> <span class="cm-variable">average</span> [<span class="cm-number">1.</span><span class="cm-builtin">.</span><span class="cm-number">10</span>]</span></pre></div><pre class=""><span style="padding-right: 0.1px;"><span class="cm-number">5.5</span></span></pre></div></div></div></div></div><div style="position: absolute; height: 30px; width: 1px; top: 0px;"></div><div class="CodeMirror-gutters" style="display: none; height: 44px;"></div></div></div></pre><pre class="md-fences md-end-block" lang="haskell"> <div class="CodeMirror cm-s-inner CodeMirror-wrap"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 4px;"></div><div class="CodeMirror-hscrollbar" style="left: 0px;"><div style="height: 100%; min-height: 1px; width: 0px;"></div></div><div class="CodeMirror-vscrollbar"><div style="min-width: 1px; height: 0px;"></div></div><div class="CodeMirror-scrollbar-filler"></div><div class="CodeMirror-gutter-filler"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; min-height: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines"><div style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><pre class=""><span style="padding-right: 0.1px;"><span class="cm-variable">main</span> <span class="cm-keyword">::</span> <span class="cm-builtin">IO</span> ()</span></pre></div><pre class=""><span style="padding-right: 0.1px;"><span class="cm-variable">main</span> <span class="cm-keyword">=</span> <span class="cm-builtin">print</span> (<span class="cm-variable">fold</span> <span class="cm-variable">average</span> (<span class="cm-builtin">map</span> <span class="cm-builtin">fromIntegral</span> [(<span class="cm-number">1</span><span class="cm-keyword">::</span><span class="cm-builtin">Int</span>)<span class="cm-keyword">..</span><span class="cm-number">1000000000</span>]))</span></pre></div></div></div></div></div><div style="position: absolute; height: 30px; width: 1px; top: 0px;"></div><div class="CodeMirror-gutters" style="display: none; height: 44px;"></div></div></div></pre><pre class="md-fences md-end-block" lang="bash"> <div class="CodeMirror cm-s-inner CodeMirror-wrap"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 4px;"></div><div class="CodeMirror-hscrollbar" style="left: 0px;"><div style="height: 100%; min-height: 1px; width: 0px;"></div></div><div class="CodeMirror-vscrollbar"><div style="min-width: 1px; height: 0px;"></div></div><div class="CodeMirror-scrollbar-filler"></div><div class="CodeMirror-gutter-filler"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; min-height: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines"><div style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><pre class=""><span style="padding-right: 0.1px;"><span class="cm-def">$ time</span> ./example  <span class="cm-comment"># 1.3 ns / elem</span></span></pre></div><pre class=""><span style="padding-right: 0.1px;"><span class="cm-number">5</span>.00000000067109e8</span></pre><pre class=""><span style="padding-right: 0.1px;"><span>​</span></span></pre><pre class=""><span style="padding-right: 0.1px;">real &nbsp;  0m1.251s</span></pre><pre class=""><span style="padding-right: 0.1px;">user &nbsp;  0m1.237s</span></pre><pre class=""><span style="padding-right: 0.1px;">sys &nbsp; &nbsp; 0m0.005s</span></pre></div></div></div></div></div><div style="position: absolute; height: 30px; width: 1px; top: 0px;"></div><div class="CodeMirror-gutters" style="display: none; height: 132px;"></div></div></div></pre><p></p><h1><a name='header-c504' class='md-header-anchor '></a>Немає витоку простору!</h1><p>Наша <code>average</code> працює за константну пам’ять:</p><p><img src='space.png' alt='' /></p><p></p><h1><a name='header-c511' class='md-header-anchor '></a>Як це працює?</h1><pre class="md-fences md-end-block" lang="haskell"> <div class="CodeMirror cm-s-inner CodeMirror-wrap"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 4px;"></div><div class="CodeMirror-hscrollbar" style="left: 0px;"><div style="height: 100%; min-height: 1px; width: 0px;"></div></div><div class="CodeMirror-vscrollbar"><div style="min-width: 1px; height: 0px;"></div></div><div class="CodeMirror-scrollbar-filler"></div><div class="CodeMirror-gutter-filler"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; min-height: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines"><div style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><pre class=""><span style="padding-right: 0.1px;"><span class="cm-builtin">print</span> (<span class="cm-variable">fold</span> <span class="cm-variable">average</span> [<span class="cm-number">1</span>, <span class="cm-number">2</span>, <span class="cm-number">3</span>])</span></pre></div><pre class=""><span style="padding-right: 0.1px;"><span>​</span></span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-comment">-- average = Fold tally summarize</span></span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-keyword">=</span> <span class="cm-builtin">print</span> (<span class="cm-variable">fold</span> (<span class="cm-variable-2">Fold</span> <span class="cm-variable">tally</span> <span class="cm-variable">summarize</span> ) [<span class="cm-number">1</span>, <span class="cm-number">2</span>, <span class="cm-number">3</span>])</span></pre><pre class=""><span style="padding-right: 0.1px;"><span>​</span></span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-comment">-- fold (Fold tally summarize) is = summarize (reduce (map tally is))</span></span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-keyword">=</span> <span class="cm-builtin">print</span> (<span class="cm-variable">summarize</span> (<span class="cm-variable">reduce</span> (<span class="cm-builtin">map</span> <span class="cm-variable">tally</span> [<span class="cm-number">1</span>, <span class="cm-number">2</span>, <span class="cm-number">3</span>])))</span></pre><pre class=""><span style="padding-right: 0.1px;"><span>​</span></span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-comment">-- reduce = foldl' (&lt;&gt;) mempty</span></span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-keyword">=</span> <span class="cm-builtin">print</span> (<span class="cm-variable">summarize</span> (<span class="cm-variable">foldl'</span> (<span class="cm-variable">&lt;&gt;</span>) <span class="cm-variable">mempty</span> (<span class="cm-builtin">map</span> <span class="cm-variable">tally</span> [<span class="cm-number">1</span>, <span class="cm-number">2</span>, <span class="cm-number">3</span>])))</span></pre><pre class=""><span style="padding-right: 0.1px;"><span>​</span></span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-comment">-- Definition of `map` (skipping a few steps)</span></span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-keyword">=</span> <span class="cm-builtin">print</span> (<span class="cm-variable">summarize</span> (<span class="cm-variable">foldl'</span> (<span class="cm-variable">&lt;&gt;</span>) <span class="cm-variable">mempty</span> [<span class="cm-variable">tally</span> <span class="cm-number">1</span>, <span class="cm-variable">tally</span> <span class="cm-number">2</span>, <span class="cm-variable">tally</span> <span class="cm-number">3</span>]))</span></pre><pre class=""><span style="padding-right: 0.1px;"><span>​</span></span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-comment">-- tally x = Average x 1</span></span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-keyword">=</span> <span class="cm-builtin">print</span> (<span class="cm-variable">summarize</span> (<span class="cm-variable">mconcat</span> [<span class="cm-variable-2">Average</span> <span class="cm-number">1</span> <span class="cm-number">1</span>, <span class="cm-variable-2">Average</span> <span class="cm-number">2</span> <span class="cm-number">1</span>, <span class="cm-variable-2">Average</span> <span class="cm-number">3</span> <span class="cm-number">1</span>]))</span></pre><pre class=""><span style="padding-right: 0.1px;"><span>​</span></span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-comment">-- `foldl' (&lt;&gt;) mempty` (skipping a few steps)</span></span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-keyword">=</span> <span class="cm-builtin">print</span> (<span class="cm-variable">summarize</span> (<span class="cm-variable">mempty</span> <span class="cm-variable">&lt;&gt;</span> <span class="cm-variable-2">Average</span> <span class="cm-number">1</span> <span class="cm-number">1</span> <span class="cm-variable">&lt;&gt;</span> <span class="cm-variable-2">Average</span> <span class="cm-number">2</span> <span class="cm-number">1</span> <span class="cm-variable">&lt;&gt;</span> <span class="cm-variable-2">Average</span> <span class="cm-number">3</span> <span class="cm-number">1</span>))</span></pre><pre class=""><span style="padding-right: 0.1px;"><span>​</span></span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-comment">-- mempty = Average 0 0</span></span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-keyword">=</span> <span class="cm-builtin">print</span> (<span class="cm-variable">summarize</span> (<span class="cm-variable-2">Average</span> <span class="cm-number">0</span> <span class="cm-number">0</span> <span class="cm-variable">&lt;&gt;</span> <span class="cm-variable-2">Average</span> <span class="cm-number">1</span> <span class="cm-number">1</span> <span class="cm-variable">&lt;&gt;</span> <span class="cm-variable-2">Average</span> <span class="cm-number">2</span> <span class="cm-number">1</span> <span class="cm-variable">&lt;&gt;</span> <span class="cm-variable-2">Average</span> <span class="cm-number">3</span> <span class="cm-number">1</span>))</span></pre><pre class=""><span style="padding-right: 0.1px;"><span>​</span></span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-comment">-- Average xL nL &lt;&gt; Average xR nR = Average (xL + xR) (nL + nR)</span></span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-keyword">=</span> <span class="cm-builtin">print</span> (<span class="cm-variable">summarize</span> (<span class="cm-variable-2">Average</span> <span class="cm-number">6</span> <span class="cm-number">3</span>))</span></pre><pre class=""><span style="padding-right: 0.1px;"><span>​</span></span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-comment">-- summarize (Average numerator denominator) = numerator / fromIntegral denominator</span></span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-keyword">=</span> <span class="cm-builtin">print</span> (<span class="cm-number">6</span> <span class="cm-builtin">/</span> <span class="cm-builtin">fromIntegral</span> <span class="cm-number">3</span>)</span></pre></div></div></div></div></div><div style="position: absolute; height: 30px; width: 1px; top: 0px;"></div><div class="CodeMirror-gutters" style="display: none; height: 616px;"></div></div></div></pre><p></p><h1><a name='header-c515' class='md-header-anchor '></a>Прості <code>Fold</code>и</h1><p>Все в <code>Data.Monoid</code> можна загорнути в <code>Fold</code></p><pre class="md-fences md-end-block" lang="haskell"> <div class="CodeMirror cm-s-inner CodeMirror-wrap"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 4px;"></div><div class="CodeMirror-hscrollbar" style="left: 0px;"><div style="height: 100%; min-height: 1px; width: 0px;"></div></div><div class="CodeMirror-vscrollbar"><div style="min-width: 1px; height: 0px;"></div></div><div class="CodeMirror-scrollbar-filler"></div><div class="CodeMirror-gutter-filler"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; min-height: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines"><div style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><pre class=""><span style="padding-right: 0.1px;"><span class="cm-keyword">import</span> <span class="cm-variable-2">Prelude</span> <span class="cm-variable">hiding</span> (<span class="cm-builtin">head</span>, <span class="cm-builtin">last</span>, <span class="cm-builtin">all</span>, <span class="cm-builtin">any</span>, <span class="cm-builtin">sum</span>, <span class="cm-builtin">product</span>, <span class="cm-builtin">length</span>)</span></pre></div><pre class=""><span style="padding-right: 0.1px;"><span>​</span></span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-builtin">head</span> <span class="cm-keyword">::</span> <span class="cm-variable-2">Fold</span> <span class="cm-variable">a</span> (<span class="cm-builtin">Maybe</span> <span class="cm-variable">a</span>)</span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-builtin">head</span> <span class="cm-keyword">=</span> <span class="cm-variable-2">Fold</span> (<span class="cm-variable-2">First</span> <span class="cm-builtin">.</span> <span class="cm-builtin">Just</span>) <span class="cm-variable">getFirst</span></span></pre><pre class=""><span style="padding-right: 0.1px;"><span>​</span></span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-builtin">last</span> <span class="cm-keyword">::</span> <span class="cm-variable-2">Fold</span> <span class="cm-variable">a</span> (<span class="cm-builtin">Maybe</span> <span class="cm-variable">a</span>)</span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-builtin">last</span> <span class="cm-keyword">=</span> <span class="cm-variable-2">Fold</span> (<span class="cm-variable-2">Last</span> <span class="cm-builtin">.</span> <span class="cm-builtin">Just</span>) <span class="cm-variable">getLast</span></span></pre><pre class=""><span style="padding-right: 0.1px;"><span>​</span></span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-builtin">all</span> <span class="cm-keyword">::</span> (<span class="cm-variable">a</span> <span class="cm-keyword">-&gt;</span> <span class="cm-builtin">Bool</span>) <span class="cm-keyword">-&gt;</span> <span class="cm-variable-2">Fold</span> <span class="cm-variable">a</span> <span class="cm-builtin">Bool</span></span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-builtin">all</span> <span class="cm-variable">predicate</span> <span class="cm-keyword">=</span> <span class="cm-variable-2">Fold</span> (<span class="cm-variable-2">All</span> <span class="cm-builtin">.</span> <span class="cm-variable">predicate</span>) <span class="cm-variable">getAll</span></span></pre><pre class=""><span style="padding-right: 0.1px;"><span>​</span></span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-builtin">any</span> <span class="cm-keyword">::</span> (<span class="cm-variable">a</span> <span class="cm-keyword">-&gt;</span> <span class="cm-builtin">Bool</span>) <span class="cm-keyword">-&gt;</span> <span class="cm-variable-2">Fold</span> <span class="cm-variable">a</span> <span class="cm-builtin">Bool</span></span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-builtin">any</span> <span class="cm-variable">predicate</span> <span class="cm-keyword">=</span> <span class="cm-variable-2">Fold</span> (<span class="cm-variable-2">Any</span> <span class="cm-builtin">.</span> <span class="cm-variable">predicate</span>) <span class="cm-variable">getAny</span></span></pre><pre class=""><span style="padding-right: 0.1px;"><span>​</span></span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-builtin">sum</span> <span class="cm-keyword">::</span> <span class="cm-builtin">Num</span> <span class="cm-variable">n</span> <span class="cm-keyword">=&gt;</span> <span class="cm-variable-2">Fold</span> <span class="cm-variable">n</span> <span class="cm-variable">n</span></span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-builtin">sum</span> <span class="cm-keyword">=</span> <span class="cm-variable-2">Fold</span> <span class="cm-variable-2">Sum</span> <span class="cm-variable">getSum</span></span></pre><pre class=""><span style="padding-right: 0.1px;"><span>​</span></span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-builtin">product</span> <span class="cm-keyword">::</span> <span class="cm-builtin">Num</span> <span class="cm-variable">n</span> <span class="cm-keyword">=&gt;</span> <span class="cm-variable-2">Fold</span> <span class="cm-variable">n</span> <span class="cm-variable">n</span></span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-builtin">product</span> <span class="cm-keyword">=</span> <span class="cm-variable-2">Fold</span> <span class="cm-variable-2">Product</span> <span class="cm-variable">getProduct</span></span></pre><pre class=""><span style="padding-right: 0.1px;"><span>​</span></span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-builtin">length</span> <span class="cm-keyword">::</span> <span class="cm-builtin">Num</span> <span class="cm-variable">n</span> <span class="cm-keyword">=&gt;</span> <span class="cm-variable-2">Fold</span> <span class="cm-variable">i</span> <span class="cm-variable">n</span></span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-builtin">length</span> <span class="cm-keyword">=</span> <span class="cm-variable-2">Fold</span> (<span class="cm-keyword">\_</span> <span class="cm-keyword">-&gt;</span> <span class="cm-variable-2">Sum</span> <span class="cm-number">1</span>) <span class="cm-variable">getSum</span></span></pre></div></div></div></div></div><div style="position: absolute; height: 30px; width: 1px; top: 0px;"></div><div class="CodeMirror-gutters" style="display: none; height: 484px;"></div></div></div></pre><p></p><h1><a name='header-c521' class='md-header-anchor '></a>Приклади</h1><pre class="md-fences md-end-block" lang="haskell"> <div class="CodeMirror cm-s-inner CodeMirror-wrap"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 4px;"></div><div class="CodeMirror-hscrollbar" style="left: 0px;"><div style="height: 100%; min-height: 1px; width: 0px;"></div></div><div class="CodeMirror-vscrollbar"><div style="min-width: 1px; height: 0px;"></div></div><div class="CodeMirror-scrollbar-filler"></div><div class="CodeMirror-gutter-filler"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; min-height: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines"><div style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><pre class=""><span style="padding-right: 0.1px;"><span class="cm-variable">&gt;&gt;&gt;</span> <span class="cm-variable">fold</span> <span class="cm-builtin">head</span> [<span class="cm-number">1.</span><span class="cm-builtin">.</span><span class="cm-number">10</span>]</span></pre></div><pre class=""><span style="padding-right: 0.1px;"><span class="cm-builtin">Just</span> <span class="cm-number">1</span></span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-variable">&gt;&gt;&gt;</span> <span class="cm-variable">fold</span> <span class="cm-builtin">last</span> [<span class="cm-number">1.</span><span class="cm-builtin">.</span><span class="cm-number">10</span>]</span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-builtin">Just</span> <span class="cm-number">10</span></span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-variable">&gt;&gt;&gt;</span> <span class="cm-variable">fold</span> (<span class="cm-builtin">all</span> <span class="cm-builtin">even</span>) [<span class="cm-number">1.</span><span class="cm-builtin">.</span><span class="cm-number">10</span>]</span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-builtin">False</span></span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-variable">&gt;&gt;&gt;</span> <span class="cm-variable">fold</span> (<span class="cm-builtin">any</span> <span class="cm-builtin">even</span>) [<span class="cm-number">1.</span><span class="cm-builtin">.</span><span class="cm-number">10</span>]</span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-builtin">True</span></span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-variable">&gt;&gt;&gt;</span> <span class="cm-variable">fold</span> <span class="cm-builtin">sum</span> [<span class="cm-number">1.</span><span class="cm-builtin">.</span><span class="cm-number">10</span>]</span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-number">55</span></span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-variable">&gt;&gt;&gt;</span> <span class="cm-variable">fold</span> <span class="cm-builtin">product</span> [<span class="cm-number">1.</span><span class="cm-builtin">.</span><span class="cm-number">10</span>]</span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-number">3628800</span></span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-variable">&gt;&gt;&gt;</span> <span class="cm-variable">fold</span> <span class="cm-builtin">length</span> [<span class="cm-number">1.</span><span class="cm-builtin">.</span><span class="cm-number">10</span>]</span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-number">10</span></span></pre></div></div></div></div></div><div style="position: absolute; height: 30px; width: 1px; top: 0px;"></div><div class="CodeMirror-gutters" style="display: none; height: 308px;"></div></div></div></pre><p></p><h1><a name='header-c525' class='md-header-anchor '></a>Експоненційне ковзне середнє</h1><p>Експоненційне ковзне середнє у вигляді <code>Fold</code>у:</p><pre class="md-fences md-end-block" lang="haskell"> <div class="CodeMirror cm-s-inner CodeMirror-wrap"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 4px;"></div><div class="CodeMirror-hscrollbar" style="left: 0px;"><div style="height: 100%; min-height: 1px; width: 0px;"></div></div><div class="CodeMirror-vscrollbar"><div style="min-width: 1px; height: 0px;"></div></div><div class="CodeMirror-scrollbar-filler"></div><div class="CodeMirror-gutter-filler"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; min-height: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines"><div style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><pre class=""><span style="padding-right: 0.1px;"><span class="cm-keyword">data</span> <span class="cm-variable-2">EMA</span> <span class="cm-variable">a</span> <span class="cm-keyword">=</span> <span class="cm-variable-2">EMA</span> { <span class="cm-variable">samples</span> <span class="cm-keyword">::</span> <span class="cm-variable">!</span><span class="cm-builtin">Int</span>, <span class="cm-variable">value</span> <span class="cm-keyword">::</span> <span class="cm-variable">!a</span> }</span></pre></div><pre class=""><span style="padding-right: 0.1px;"><span>​</span></span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-keyword">instance</span> <span class="cm-builtin">Fractional</span> <span class="cm-variable">a</span> <span class="cm-keyword">=&gt;</span> <span class="cm-variable-2">Monoid</span> (<span class="cm-variable-2">EMA</span> <span class="cm-variable">a</span>) <span class="cm-keyword">where</span></span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  <span class="cm-variable">mempty</span> <span class="cm-keyword">=</span> <span class="cm-variable-2">EMA</span> <span class="cm-number">0</span> <span class="cm-number">0</span></span></pre><pre class=""><span style="padding-right: 0.1px;"><span>​</span></span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  <span class="cm-variable">mappend</span> (<span class="cm-variable-2">EMA</span> <span class="cm-variable">nL</span> <span class="cm-variable">xL</span>) (<span class="cm-variable-2">EMA</span> <span class="cm-number">1</span> <span class="cm-variable">xR</span>) <span class="cm-keyword">=</span> <span class="cm-variable-2">EMA</span> <span class="cm-variable">n</span> <span class="cm-variable">x</span>  <span class="cm-comment">-- Optimize common case</span></span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp;  <span class="cm-keyword">where</span></span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  <span class="cm-variable">n</span> <span class="cm-keyword">=</span> <span class="cm-variable">nL</span> <span class="cm-builtin">+</span> <span class="cm-number">1</span></span></pre><pre class=""><span style="padding-right: 0.1px;"><span>​</span></span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  <span class="cm-variable">x</span> <span class="cm-keyword">=</span> <span class="cm-variable">xL</span> <span class="cm-builtin">*</span> <span class="cm-number">0.7</span> <span class="cm-builtin">+</span> <span class="cm-variable">xR</span></span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  <span class="cm-variable">mappend</span> (<span class="cm-variable-2">EMA</span> <span class="cm-variable">nL</span> <span class="cm-variable">xL</span>) (<span class="cm-variable-2">EMA</span> <span class="cm-variable">nR</span> <span class="cm-variable">xR</span>) <span class="cm-keyword">=</span> <span class="cm-variable-2">EMA</span> <span class="cm-variable">n</span> <span class="cm-variable">x</span></span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp;  <span class="cm-keyword">where</span></span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  <span class="cm-variable">n</span> <span class="cm-keyword">=</span> <span class="cm-variable">nL</span> <span class="cm-builtin">+</span> <span class="cm-variable">nR</span></span></pre><pre class=""><span style="padding-right: 0.1px;"><span>​</span></span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  <span class="cm-variable">x</span> <span class="cm-keyword">=</span> <span class="cm-variable">xL</span> <span class="cm-builtin">*</span> (<span class="cm-number">0.7</span> <span class="cm-builtin">^</span> <span class="cm-variable">nR</span>) <span class="cm-builtin">+</span> <span class="cm-variable">xR</span></span></pre><pre class=""><span style="padding-right: 0.1px;"><span>​</span></span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-variable">ema</span> <span class="cm-keyword">::</span> <span class="cm-builtin">Fractional</span> <span class="cm-variable">a</span> <span class="cm-keyword">=&gt;</span> <span class="cm-variable-2">Fold</span> <span class="cm-variable">a</span> <span class="cm-variable">a</span></span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-variable">ema</span> <span class="cm-keyword">=</span> <span class="cm-variable-2">Fold</span> <span class="cm-variable">tally</span> <span class="cm-variable">summarize</span></span></pre><pre class=""><span style="padding-right: 0.1px;">  <span class="cm-keyword">where</span></span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  <span class="cm-variable">tally</span> <span class="cm-variable">x</span> <span class="cm-keyword">=</span> <span class="cm-variable-2">EMA</span> <span class="cm-number">1</span> <span class="cm-variable">x</span></span></pre><pre class=""><span style="padding-right: 0.1px;"><span>​</span></span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  <span class="cm-variable">summarize</span> (<span class="cm-variable-2">EMA</span> <span class="cm-keyword">_</span> <span class="cm-variable">x</span>) <span class="cm-keyword">=</span> <span class="cm-variable">x</span> <span class="cm-builtin">*</span> <span class="cm-number">0.3</span></span></pre></div></div></div></div></div><div style="position: absolute; height: 30px; width: 1px; top: 0px;"></div><div class="CodeMirror-gutters" style="display: none; height: 484px;"></div></div></div></pre><p></p><h1><a name='header-c531' class='md-header-anchor '></a>Приклад</h1><pre class="md-fences md-end-block" lang="haskell"> <div class="CodeMirror cm-s-inner CodeMirror-wrap"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 4px;"></div><div class="CodeMirror-hscrollbar" style="left: 0px;"><div style="height: 100%; min-height: 1px; width: 0px;"></div></div><div class="CodeMirror-vscrollbar"><div style="min-width: 1px; height: 0px;"></div></div><div class="CodeMirror-scrollbar-filler"></div><div class="CodeMirror-gutter-filler"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; min-height: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines"><div style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><pre class=""><span style="padding-right: 0.1px;"><span class="cm-variable">&gt;&gt;&gt;</span> <span class="cm-variable">fold</span> <span class="cm-variable">ema</span> [<span class="cm-number">1.</span><span class="cm-builtin">.</span><span class="cm-number">10</span>]</span></pre></div><pre class=""><span style="padding-right: 0.1px;"><span class="cm-number">7.732577558099999</span></span></pre></div></div></div></div></div><div style="position: absolute; height: 30px; width: 1px; top: 0px;"></div><div class="CodeMirror-gutters" style="display: none; height: 44px;"></div></div></div></pre><pre class="md-fences md-end-block" lang="haskell"> <div class="CodeMirror cm-s-inner CodeMirror-wrap"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 4px;"></div><div class="CodeMirror-hscrollbar" style="left: 0px;"><div style="height: 100%; min-height: 1px; width: 0px;"></div></div><div class="CodeMirror-vscrollbar"><div style="min-width: 1px; height: 0px;"></div></div><div class="CodeMirror-scrollbar-filler"></div><div class="CodeMirror-gutter-filler"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; min-height: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines"><div style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><pre class=""><span style="padding-right: 0.1px;"><span class="cm-variable">main</span> <span class="cm-keyword">::</span> <span class="cm-builtin">IO</span> ()</span></pre></div><pre class=""><span style="padding-right: 0.1px;"><span class="cm-variable">main</span> <span class="cm-keyword">=</span> <span class="cm-builtin">print</span> (<span class="cm-variable">fold</span> <span class="cm-variable">ema</span> (<span class="cm-builtin">map</span> <span class="cm-builtin">fromIntegral</span> [(<span class="cm-number">1</span><span class="cm-keyword">::</span><span class="cm-builtin">Int</span>)<span class="cm-keyword">..</span><span class="cm-number">1000000000</span>]))</span></pre></div></div></div></div></div><div style="position: absolute; height: 30px; width: 1px; top: 0px;"></div><div class="CodeMirror-gutters" style="display: none; height: 44px;"></div></div></div></pre><pre class="md-fences md-end-block" lang="bash"> <div class="CodeMirror cm-s-inner CodeMirror-wrap"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 4px;"></div><div class="CodeMirror-hscrollbar" style="left: 0px;"><div style="height: 100%; min-height: 1px; width: 0px;"></div></div><div class="CodeMirror-vscrollbar"><div style="min-width: 1px; height: 0px;"></div></div><div class="CodeMirror-scrollbar-filler"></div><div class="CodeMirror-gutter-filler"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; min-height: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines"><div style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><pre class=""><span style="padding-right: 0.1px;"><span class="cm-def">$ time</span> ./example  <span class="cm-comment"># 2.6 ns / elem</span></span></pre></div><pre class=""><span style="padding-right: 0.1px;"><span class="cm-number">9</span>.999999976666665e8</span></pre><pre class=""><span style="padding-right: 0.1px;"><span>​</span></span></pre><pre class=""><span style="padding-right: 0.1px;">real &nbsp;  0m2.577s</span></pre><pre class=""><span style="padding-right: 0.1px;">user &nbsp;  0m2.562s</span></pre><pre class=""><span style="padding-right: 0.1px;">sys &nbsp; &nbsp; 0m0.009s</span></pre></div></div></div></div></div><div style="position: absolute; height: 30px; width: 1px; top: 0px;"></div><div class="CodeMirror-gutters" style="display: none; height: 132px;"></div></div></div></pre><p></p><h1><a name='header-c537' class='md-header-anchor '></a>Оцінка кардинальності</h1><p>Типове питання, що виникає — &quot;оцінити кількість унікальних відвідувачів&quot;</p><p>Наївне рішення:</p><pre class="md-fences md-end-block" lang="haskell"> <div class="CodeMirror cm-s-inner CodeMirror-wrap"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 4px;"></div><div class="CodeMirror-hscrollbar" style="left: 0px;"><div style="height: 100%; min-height: 1px; width: 0px;"></div></div><div class="CodeMirror-vscrollbar"><div style="min-width: 1px; height: 0px;"></div></div><div class="CodeMirror-scrollbar-filler"></div><div class="CodeMirror-gutter-filler"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; min-height: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines"><div style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><pre class=""><span style="padding-right: 0.1px;"><span class="cm-keyword">import</span> <span class="cm-qualifier">Data.</span><span class="cm-variable-2">Set</span> (<span class="cm-variable-2">Set</span>)</span></pre></div><pre class=""><span style="padding-right: 0.1px;"><span>​</span></span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-keyword">import</span> <span class="cm-variable">qualified</span> <span class="cm-qualifier">Data.</span><span class="cm-variable-2">Set</span></span></pre><pre class=""><span style="padding-right: 0.1px;"><span>​</span></span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-variable">uniques</span> <span class="cm-keyword">::</span> <span class="cm-builtin">Ord</span> <span class="cm-variable">i</span> <span class="cm-keyword">=&gt;</span> <span class="cm-variable-2">Fold</span> <span class="cm-variable">i</span> <span class="cm-builtin">Int</span></span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-variable">uniques</span> <span class="cm-keyword">=</span> <span class="cm-variable-2">Fold</span> <span class="cm-qualifier">Data.Set.</span><span class="cm-variable">singleton</span> <span class="cm-qualifier">Data.Set.</span><span class="cm-variable">size</span></span></pre></div></div></div></div></div><div style="position: absolute; height: 30px; width: 1px; top: 0px;"></div><div class="CodeMirror-gutters" style="display: none; height: 132px;"></div></div></div></pre><p>... потребує багато пам’яті</p><p>... погано для великих даних</p><p></p><h1><a name='header-c549' class='md-header-anchor '></a>Приблизна оцінка кардинальності</h1><p>Алгоритм HyperLogLog дає приблизну оцінку кардинальності</p><p>Спрощене пояснення на Хаскелі:</p><pre class="md-fences md-end-block" lang="haskell"> <div class="CodeMirror cm-s-inner CodeMirror-wrap"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 4px;"></div><div class="CodeMirror-hscrollbar" style="left: 0px;"><div style="height: 100%; min-height: 1px; width: 0px;"></div></div><div class="CodeMirror-vscrollbar"><div style="min-width: 1px; height: 0px;"></div></div><div class="CodeMirror-scrollbar-filler"></div><div class="CodeMirror-gutter-filler"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; min-height: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines"><div style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><pre class=""><span style="padding-right: 0.1px;"><span class="cm-keyword">import</span> <span class="cm-qualifier">Data.</span><span class="cm-variable-2">Word</span> (<span class="cm-variable-2">Word64</span>)</span></pre></div><pre class=""><span style="padding-right: 0.1px;"><span>​</span></span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-keyword">import</span> <span class="cm-variable">qualified</span> <span class="cm-qualifier">Data.</span><span class="cm-variable-2">Bits</span></span></pre><pre class=""><span style="padding-right: 0.1px;"><span>​</span></span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-keyword">newtype</span> <span class="cm-variable-2">Max</span> <span class="cm-variable">a</span> <span class="cm-keyword">=</span> <span class="cm-variable-2">Max</span> { <span class="cm-variable">getMax</span> <span class="cm-keyword">::</span> <span class="cm-variable">a</span> }</span></pre><pre class=""><span style="padding-right: 0.1px;"><span>​</span></span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-keyword">instance</span> (<span class="cm-builtin">Bounded</span> <span class="cm-variable">a</span>, <span class="cm-builtin">Ord</span> <span class="cm-variable">a</span>) <span class="cm-keyword">=&gt;</span> <span class="cm-variable-2">Monoid</span> (<span class="cm-variable-2">Max</span> <span class="cm-variable">a</span>) <span class="cm-keyword">where</span></span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  <span class="cm-variable">mempty</span> <span class="cm-keyword">=</span> <span class="cm-variable-2">Max</span> <span class="cm-builtin">minBound</span></span></pre><pre class=""><span style="padding-right: 0.1px;"><span>​</span></span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  <span class="cm-variable">mappend</span> (<span class="cm-variable-2">Max</span> <span class="cm-variable">x</span>) (<span class="cm-variable-2">Max</span> <span class="cm-variable">y</span>) <span class="cm-keyword">=</span> <span class="cm-variable-2">Max</span> (<span class="cm-builtin">max</span> <span class="cm-variable">x</span> <span class="cm-variable">y</span>)</span></pre><pre class=""><span style="padding-right: 0.1px;"><span>​</span></span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-variable">uniques</span> <span class="cm-keyword">::</span> (<span class="cm-variable">i</span> <span class="cm-keyword">-&gt;</span> <span class="cm-variable-2">Word64</span>) <span class="cm-keyword">-&gt;</span> <span class="cm-variable-2">Fold</span> <span class="cm-variable">i</span> <span class="cm-builtin">Int</span></span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-variable">uniques</span> <span class="cm-variable">hash</span> <span class="cm-keyword">=</span> <span class="cm-variable-2">Fold</span> <span class="cm-variable">tally</span> <span class="cm-variable">summarize</span></span></pre><pre class=""><span style="padding-right: 0.1px;">  <span class="cm-keyword">where</span></span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  <span class="cm-variable">tally</span> <span class="cm-variable">x</span> <span class="cm-keyword">=</span> <span class="cm-variable-2">Max</span> (<span class="cm-builtin">fromIntegral</span> (<span class="cm-qualifier">Data.Bits.</span><span class="cm-variable">countLeadingZeros</span> (<span class="cm-variable">hash</span> <span class="cm-variable">x</span>)) <span class="cm-keyword">::</span> <span class="cm-variable-2">Word64</span>)</span></pre><pre class=""><span style="padding-right: 0.1px;"><span>​</span></span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  <span class="cm-variable">summarize</span> (<span class="cm-variable-2">Max</span> <span class="cm-variable">n</span>) <span class="cm-keyword">=</span> <span class="cm-builtin">fromIntegral</span> (<span class="cm-number">2</span> <span class="cm-builtin">^</span> <span class="cm-variable">n</span>)</span></pre></div></div></div></div></div><div style="position: absolute; height: 30px; width: 1px; top: 0px;"></div><div class="CodeMirror-gutters" style="display: none; height: 374px;"></div></div></div></pre><p>Справжня версія набагато більш &quot;дужа&quot; (Див <code>hyperloglog</code> від E. Kmett)</p><p></p><h1><a name='header-c559' class='md-header-anchor '></a>Приклад</h1><pre class="md-fences md-end-block" lang="haskell"> <div class="CodeMirror cm-s-inner CodeMirror-wrap"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 4px;"></div><div class="CodeMirror-hscrollbar" style="left: 0px;"><div style="height: 100%; min-height: 1px; width: 0px;"></div></div><div class="CodeMirror-vscrollbar"><div style="min-width: 1px; height: 0px;"></div></div><div class="CodeMirror-scrollbar-filler"></div><div class="CodeMirror-gutter-filler"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; min-height: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines"><div style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><pre class=""><span style="padding-right: 0.1px;"><span class="cm-variable">main</span> <span class="cm-keyword">::</span> <span class="cm-builtin">IO</span> ()</span></pre></div><pre class=""><span style="padding-right: 0.1px;"><span class="cm-variable">main</span> <span class="cm-keyword">=</span> <span class="cm-builtin">print</span> (<span class="cm-variable">fold</span> (<span class="cm-variable">uniques</span> <span class="cm-builtin">id</span>) (<span class="cm-builtin">take</span> <span class="cm-number">1000000000</span> (<span class="cm-builtin">cycle</span> <span class="cm-variable">randomWord64s</span>)))</span></pre><pre class=""><span style="padding-right: 0.1px;"><span>​</span></span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-variable">randomWord64s</span> <span class="cm-keyword">::</span> [<span class="cm-variable-2">Word64</span>]</span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-variable">randomWord64s</span> <span class="cm-keyword">=</span> [<span class="cm-number">11244654998801660968</span>,<span class="cm-number">16946641599420530603</span>,<span class="cm-number">652086428930367189</span>,<span class="cm-number">5128055280221172986</span>,<span class="cm-number">16587432539185930121</span>,<span class="cm-number">2228570544497248004</span>,<span class="cm-number">1689089568130731485</span>,<span class="cm-number">1818807721542935601</span>,<span class="cm-number">2077177117099267269</span>,<span class="cm-number">8187447654250279125</span>]</span></pre></div></div></div></div></div><div style="position: absolute; height: 30px; width: 1px; top: 0px;"></div><div class="CodeMirror-gutters" style="display: none; height: 176px;"></div></div></div></pre><pre class="md-fences md-end-block" lang="bash"> <div class="CodeMirror cm-s-inner CodeMirror-wrap"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 4px;"></div><div class="CodeMirror-hscrollbar" style="left: 0px;"><div style="height: 100%; min-height: 1px; width: 0px;"></div></div><div class="CodeMirror-vscrollbar"><div style="min-width: 1px; height: 0px;"></div></div><div class="CodeMirror-scrollbar-filler"></div><div class="CodeMirror-gutter-filler"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; min-height: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines"><div style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><pre class=""><span style="padding-right: 0.1px;"><span class="cm-def">$ time</span> ./example  <span class="cm-comment"># 5.5 ns / elem</span></span></pre></div><pre class=""><span style="padding-right: 0.1px;">16</span></pre><pre class=""><span style="padding-right: 0.1px;"><span>​</span></span></pre><pre class=""><span style="padding-right: 0.1px;">real &nbsp;  0m5.543s</span></pre><pre class=""><span style="padding-right: 0.1px;">user &nbsp;  0m5.526s</span></pre><pre class=""><span style="padding-right: 0.1px;">sys &nbsp; &nbsp; 0m0.007s</span></pre></div></div></div></div></div><div style="position: absolute; height: 30px; width: 1px; top: 0px;"></div><div class="CodeMirror-gutters" style="display: none; height: 132px;"></div></div></div></pre><p></p><h1><a name='header-c564' class='md-header-anchor '></a>Код, що варто вкрасти</h1><p>Деякі ідеї, що вкрадено зі Скала-бібліотеки <code>algebird</code></p><ul><li><p>Quantile digests (for medians, percentiles, histograms)</p><ul><li><code>algebird</code> calls these <code>QTree</code>s</li></ul></li><li><p>Count-min sketch (for top N most frequently occurring items)</p><ul><li><code>algebird</code> generalizes this as <code>SketchMap</code>s</li></ul></li><li><p>Stochastic gradient descent (for linear regression)</p><ul><li><code>algebird</code> calls this <code>SGD</code></li></ul></li><li><p>Bloom filters (for approximate membership testing)</p><ul><li><code>algebird</code> calls this <code>BF</code></li></ul></li></ul><p><code>algebird</code>&#39;s version of <code>Fold</code> is called <code>Aggregator</code></p><p></p><h1><a name='header-c600' class='md-header-anchor '></a>Комбінуємо <code>Fold</code>и</h1><p>Уявімо, що ми хочемо зкомбінувати два <code>Fold</code>и в один</p><p>Ми би зробили щось типу:</p><pre class="md-fences md-end-block" lang="haskell"> <div class="CodeMirror cm-s-inner CodeMirror-wrap"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 4px;"></div><div class="CodeMirror-hscrollbar" style="left: 0px;"><div style="height: 100%; min-height: 1px; width: 0px;"></div></div><div class="CodeMirror-vscrollbar"><div style="min-width: 1px; height: 0px;"></div></div><div class="CodeMirror-scrollbar-filler"></div><div class="CodeMirror-gutter-filler"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; min-height: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines"><div style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><pre class=""><span style="padding-right: 0.1px;"><span class="cm-variable">combine</span> <span class="cm-keyword">::</span> <span class="cm-variable-2">Fold</span> <span class="cm-variable">i</span> <span class="cm-variable">a</span> <span class="cm-keyword">-&gt;</span> <span class="cm-variable-2">Fold</span> <span class="cm-variable">i</span> <span class="cm-variable">b</span> <span class="cm-keyword">-&gt;</span> <span class="cm-variable-2">Fold</span> <span class="cm-variable">i</span> (<span class="cm-variable">a</span>, <span class="cm-variable">b</span>)</span></pre></div><pre class=""><span style="padding-right: 0.1px;"><span class="cm-variable">combine</span> (<span class="cm-variable-2">Fold</span> <span class="cm-variable">tallyL</span> <span class="cm-variable">summarizeL</span>) (<span class="cm-variable-2">Fold</span> <span class="cm-variable">tallyR</span> <span class="cm-variable">summarizeR</span>) <span class="cm-keyword">=</span> <span class="cm-variable-2">Fold</span> <span class="cm-variable">tally</span> <span class="cm-variable">summarize</span></span></pre><pre class=""><span style="padding-right: 0.1px;">  <span class="cm-keyword">where</span></span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  <span class="cm-variable">tally</span> <span class="cm-variable">x</span> <span class="cm-keyword">=</span> (<span class="cm-variable">tallyL</span> <span class="cm-variable">x</span>, <span class="cm-variable">tallyR</span> <span class="cm-variable">x</span>)</span></pre><pre class=""><span style="padding-right: 0.1px;"><span>​</span></span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  <span class="cm-variable">summarize</span> (<span class="cm-variable">sL</span>, <span class="cm-variable">sR</span>) <span class="cm-keyword">=</span> (<span class="cm-variable">summarizeL</span> <span class="cm-variable">sL</span>, <span class="cm-variable">summarizeR</span> <span class="cm-variable">sR</span>)</span></pre></div></div></div></div></div><div style="position: absolute; height: 30px; width: 1px; top: 0px;"></div><div class="CodeMirror-gutters" style="display: none; height: 132px;"></div></div></div></pre><p></p><h1><a name='header-c608' class='md-header-anchor '></a>Приклад</h1><pre class="md-fences md-end-block" lang="haskell"> <div class="CodeMirror cm-s-inner CodeMirror-wrap"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 4px;"></div><div class="CodeMirror-hscrollbar" style="left: 0px;"><div style="height: 100%; min-height: 1px; width: 0px;"></div></div><div class="CodeMirror-vscrollbar"><div style="min-width: 1px; height: 0px;"></div></div><div class="CodeMirror-scrollbar-filler"></div><div class="CodeMirror-gutter-filler"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; min-height: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines"><div style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><pre class=""><span style="padding-right: 0.1px;"><span class="cm-variable">&gt;&gt;&gt;</span> <span class="cm-variable">fold</span> (<span class="cm-variable">combine</span> <span class="cm-builtin">sum</span> <span class="cm-builtin">product</span>) [<span class="cm-number">1.</span><span class="cm-builtin">.</span><span class="cm-number">10</span>]</span></pre></div><pre class=""><span style="padding-right: 0.1px;">(<span class="cm-number">55</span>,<span class="cm-number">3628800</span>)</span></pre></div></div></div></div></div><div style="position: absolute; height: 30px; width: 1px; top: 0px;"></div><div class="CodeMirror-gutters" style="display: none; height: 44px;"></div></div></div></pre><p></p><h1><a name='header-c612' class='md-header-anchor '></a><code>Applicative</code></h1><p>Можемо узагальнити <code>combine</code> написавши інстанс <code>Fold</code> для <code>Applicative</code></p><pre class="md-fences md-end-block" lang="haskell"> <div class="CodeMirror cm-s-inner CodeMirror-wrap"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 4px;"></div><div class="CodeMirror-hscrollbar" style="left: 0px;"><div style="height: 100%; min-height: 1px; width: 0px;"></div></div><div class="CodeMirror-vscrollbar"><div style="min-width: 1px; height: 0px;"></div></div><div class="CodeMirror-scrollbar-filler"></div><div class="CodeMirror-gutter-filler"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; min-height: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines"><div style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><pre class=""><span style="padding-right: 0.1px;"><span class="cm-keyword">instance</span> <span class="cm-builtin">Functor</span> (<span class="cm-variable-2">Fold</span> <span class="cm-variable">i</span>) <span class="cm-keyword">where</span></span></pre></div><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  <span class="cm-builtin">fmap</span> <span class="cm-variable">k</span> (<span class="cm-variable-2">Fold</span> <span class="cm-variable">tally</span> <span class="cm-variable">summarize</span>) <span class="cm-keyword">=</span> <span class="cm-variable-2">Fold</span> <span class="cm-variable">tally</span> (<span class="cm-variable">k</span> <span class="cm-builtin">.</span> <span class="cm-variable">summarize</span>)</span></pre><pre class=""><span style="padding-right: 0.1px;"><span>​</span></span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-keyword">instance</span> <span class="cm-variable-2">Applicative</span> (<span class="cm-variable-2">Fold</span> <span class="cm-variable">i</span>) <span class="cm-keyword">where</span></span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  <span class="cm-variable">pure</span> <span class="cm-variable">o</span> <span class="cm-keyword">=</span> <span class="cm-variable-2">Fold</span> (<span class="cm-keyword">\_</span> <span class="cm-keyword">-&gt;</span> ()) (<span class="cm-keyword">\_</span> <span class="cm-keyword">-&gt;</span> <span class="cm-variable">o</span>)</span></pre><pre class=""><span style="padding-right: 0.1px;"><span>​</span></span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  <span class="cm-variable-2">Fold</span> <span class="cm-variable">tallyF</span> <span class="cm-variable">summarizeF</span> <span class="cm-variable">&lt;*&gt;</span> <span class="cm-variable-2">Fold</span> <span class="cm-variable">tallyX</span> <span class="cm-variable">summarizeX</span> <span class="cm-keyword">=</span> <span class="cm-variable-2">Fold</span> <span class="cm-variable">tally</span> <span class="cm-variable">summarize</span></span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp;  <span class="cm-keyword">where</span></span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  <span class="cm-variable">tally</span> <span class="cm-variable">i</span> <span class="cm-keyword">=</span> (<span class="cm-variable">tallyF</span> <span class="cm-variable">i</span>, <span class="cm-variable">tallyX</span> <span class="cm-variable">i</span>)</span></pre><pre class=""><span style="padding-right: 0.1px;"><span>​</span></span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  <span class="cm-variable">summarize</span> (<span class="cm-variable">mF</span>, <span class="cm-variable">mX</span>) <span class="cm-keyword">=</span> <span class="cm-variable">summarizeF</span> <span class="cm-variable">mF</span> (<span class="cm-variable">summarizeX</span> <span class="cm-variable">mX</span>)</span></pre></div></div></div></div></div><div style="position: absolute; height: 30px; width: 1px; top: 0px;"></div><div class="CodeMirror-gutters" style="display: none; height: 242px;"></div></div></div></pre><p></p><h1><a name='header-c618' class='md-header-anchor '></a>Строгість</h1><p>Ми хочемо, аби внутрішній <code>Monoid</code> був строгим  <code>Pair</code>:</p><pre class="md-fences md-end-block" lang="haskell"> <div class="CodeMirror cm-s-inner CodeMirror-wrap"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 4px;"></div><div class="CodeMirror-hscrollbar" style="left: 0px;"><div style="height: 100%; min-height: 1px; width: 0px;"></div></div><div class="CodeMirror-vscrollbar"><div style="min-width: 1px; height: 0px;"></div></div><div class="CodeMirror-scrollbar-filler"></div><div class="CodeMirror-gutter-filler"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; min-height: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines"><div style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><pre class=""><span style="padding-right: 0.1px;"><span class="cm-keyword">data</span> <span class="cm-variable-2">Pair</span> <span class="cm-variable">a</span> <span class="cm-variable">b</span> <span class="cm-keyword">=</span> <span class="cm-variable-2">P</span> <span class="cm-variable">!a</span> <span class="cm-variable">!b</span></span></pre></div><pre class=""><span style="padding-right: 0.1px;"><span>​</span></span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-keyword">instance</span> (<span class="cm-variable-2">Monoid</span> <span class="cm-variable">a</span>, <span class="cm-variable-2">Monoid</span> <span class="cm-variable">b</span>) <span class="cm-keyword">=&gt;</span> <span class="cm-variable-2">Monoid</span> (<span class="cm-variable-2">Pair</span> <span class="cm-variable">a</span> <span class="cm-variable">b</span>) <span class="cm-keyword">where</span></span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  <span class="cm-variable">mempty</span> <span class="cm-keyword">=</span> <span class="cm-variable-2">P</span> <span class="cm-variable">mempty</span> <span class="cm-variable">mempty</span></span></pre><pre class=""><span style="padding-right: 0.1px;"><span>​</span></span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  <span class="cm-variable">mappend</span> (<span class="cm-variable-2">P</span> <span class="cm-variable">aL</span> <span class="cm-variable">bL</span>) (<span class="cm-variable-2">P</span> <span class="cm-variable">aR</span> <span class="cm-variable">bR</span>) <span class="cm-keyword">=</span> <span class="cm-variable-2">P</span> (<span class="cm-variable">mappend</span> <span class="cm-variable">aL</span> <span class="cm-variable">aR</span>) (<span class="cm-variable">mappend</span> <span class="cm-variable">bL</span> <span class="cm-variable">bR</span>)</span></pre><pre class=""><span style="padding-right: 0.1px;"><span>​</span></span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-keyword">data</span> <span class="cm-variable-2">Fold</span> <span class="cm-variable">i</span> <span class="cm-variable">o</span> <span class="cm-keyword">=</span> <span class="cm-variable">forall</span> <span class="cm-variable">m</span> <span class="cm-builtin">.</span> <span class="cm-variable-2">Monoid</span> <span class="cm-variable">m</span> <span class="cm-keyword">=&gt;</span> <span class="cm-variable-2">Fold</span> (<span class="cm-variable">i</span> <span class="cm-keyword">-&gt;</span> <span class="cm-variable">m</span>) (<span class="cm-variable">m</span> <span class="cm-keyword">-&gt;</span> <span class="cm-variable">o</span>)</span></pre><pre class=""><span style="padding-right: 0.1px;"><span>​</span></span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-keyword">instance</span> <span class="cm-builtin">Functor</span> (<span class="cm-variable-2">Fold</span> <span class="cm-variable">i</span>) <span class="cm-keyword">where</span></span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  <span class="cm-builtin">fmap</span> <span class="cm-variable">k</span> (<span class="cm-variable-2">Fold</span> <span class="cm-variable">tally</span> <span class="cm-variable">summarize</span>) <span class="cm-keyword">=</span> <span class="cm-variable-2">Fold</span> <span class="cm-variable">tally</span> (<span class="cm-variable">k</span> <span class="cm-builtin">.</span> <span class="cm-variable">summarize</span>)</span></pre><pre class=""><span style="padding-right: 0.1px;"><span>​</span></span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-keyword">instance</span> <span class="cm-variable-2">Applicative</span> (<span class="cm-variable-2">Fold</span> <span class="cm-variable">i</span>) <span class="cm-keyword">where</span></span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  <span class="cm-variable">pure</span> <span class="cm-variable">o</span> <span class="cm-keyword">=</span> <span class="cm-variable-2">Fold</span> (<span class="cm-keyword">\_</span> <span class="cm-keyword">-&gt;</span> ()) (<span class="cm-keyword">\_</span> <span class="cm-keyword">-&gt;</span> <span class="cm-variable">o</span>)</span></pre><pre class=""><span style="padding-right: 0.1px;"><span>​</span></span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  <span class="cm-variable-2">Fold</span> <span class="cm-variable">tallyF</span> <span class="cm-variable">summarizeF</span> <span class="cm-variable">&lt;*&gt;</span> <span class="cm-variable-2">Fold</span> <span class="cm-variable">tallyX</span> <span class="cm-variable">summarizeX</span> <span class="cm-keyword">=</span> <span class="cm-variable-2">Fold</span> <span class="cm-variable">tally</span> <span class="cm-variable">summarize</span></span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp;  <span class="cm-keyword">where</span></span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  <span class="cm-variable">tally</span> <span class="cm-variable">i</span> <span class="cm-keyword">=</span> <span class="cm-variable-2">P</span> (<span class="cm-variable">tallyF</span> <span class="cm-variable">i</span>) (<span class="cm-variable">tallyX</span> <span class="cm-variable">i</span>)</span></pre><pre class=""><span style="padding-right: 0.1px;"><span>​</span></span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  <span class="cm-variable">summarize</span> (<span class="cm-variable-2">P</span> <span class="cm-variable">mF</span> <span class="cm-variable">mX</span>) <span class="cm-keyword">=</span> <span class="cm-variable">summarizeF</span> <span class="cm-variable">mF</span> (<span class="cm-variable">summarizeX</span> <span class="cm-variable">mX</span>)</span></pre></div></div></div></div></div><div style="position: absolute; height: 30px; width: 1px; top: 0px;"></div><div class="CodeMirror-gutters" style="display: none; height: 440px;"></div></div></div></pre><p>Це дозволить використовувати <code>seq</code> замість <code>deepseq</code></p><p></p><h1><a name='header-c626' class='md-header-anchor '></a>Pairing values</h1><p>Тепер ми можемо написати:</p><pre class="md-fences md-end-block" lang="haskell"> <div class="CodeMirror cm-s-inner CodeMirror-wrap"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 4px;"></div><div class="CodeMirror-hscrollbar" style="left: 0px;"><div style="height: 100%; min-height: 1px; width: 0px;"></div></div><div class="CodeMirror-vscrollbar"><div style="min-width: 1px; height: 0px;"></div></div><div class="CodeMirror-scrollbar-filler"></div><div class="CodeMirror-gutter-filler"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; min-height: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines"><div style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><pre class=""><span style="padding-right: 0.1px;"><span class="cm-variable">combine</span> <span class="cm-keyword">::</span> <span class="cm-variable-2">Fold</span> <span class="cm-variable">i</span> <span class="cm-variable">a</span> <span class="cm-keyword">-&gt;</span> <span class="cm-variable-2">Fold</span> <span class="cm-variable">i</span> <span class="cm-variable">b</span> <span class="cm-keyword">-&gt;</span> <span class="cm-variable-2">Fold</span> <span class="cm-variable">i</span> (<span class="cm-variable">a</span>, <span class="cm-variable">b</span>)</span></pre></div><pre class=""><span style="padding-right: 0.1px;"><span class="cm-variable">combine</span> <span class="cm-keyword">=</span> <span class="cm-variable">liftA2</span> (,)</span></pre></div></div></div></div></div><div style="position: absolute; height: 30px; width: 1px; top: 0px;"></div><div class="CodeMirror-gutters" style="display: none; height: 44px;"></div></div></div></pre><p>... що має більш узагальнений тип:</p><pre class="md-fences md-end-block" lang="haskell"> <div class="CodeMirror cm-s-inner CodeMirror-wrap"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 4px;"></div><div class="CodeMirror-hscrollbar" style="left: 0px;"><div style="height: 100%; min-height: 1px; width: 0px;"></div></div><div class="CodeMirror-vscrollbar"><div style="min-width: 1px; height: 0px;"></div></div><div class="CodeMirror-scrollbar-filler"></div><div class="CodeMirror-gutter-filler"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; min-height: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines"><div style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><pre class=""><span style="padding-right: 0.1px;"><span class="cm-variable">combine</span> <span class="cm-keyword">::</span> <span class="cm-variable-2">Applicative</span> <span class="cm-variable">f</span> <span class="cm-keyword">=&gt;</span> <span class="cm-variable">f</span> <span class="cm-variable">a</span> <span class="cm-keyword">-&gt;</span> <span class="cm-variable">f</span> <span class="cm-variable">b</span> <span class="cm-keyword">-&gt;</span> <span class="cm-variable">f</span> (<span class="cm-variable">a</span>, <span class="cm-variable">b</span>)</span></pre></div></div></div></div></div></div><div style="position: absolute; height: 30px; width: 1px; top: 0px;"></div><div class="CodeMirror-gutters" style="display: none; height: 22px;"></div></div></div></pre><p>Альтернативно, можемо використовувати <code>Applicative</code> напряму:</p><pre class="md-fences md-end-block" lang="haskell"> <div class="CodeMirror cm-s-inner CodeMirror-wrap"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 4px;"></div><div class="CodeMirror-hscrollbar" style="left: 0px;"><div style="height: 100%; min-height: 1px; width: 0px;"></div></div><div class="CodeMirror-vscrollbar"><div style="min-width: 1px; height: 0px;"></div></div><div class="CodeMirror-scrollbar-filler"></div><div class="CodeMirror-gutter-filler"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; min-height: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines"><div style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><pre class=""><span style="padding-right: 0.1px;"><span class="cm-variable">&gt;&gt;&gt;</span> <span class="cm-variable">fold</span> ((,) <span class="cm-variable">&lt;$&gt;</span> <span class="cm-builtin">sum</span> <span class="cm-variable">&lt;*&gt;</span> <span class="cm-builtin">product</span>) [<span class="cm-number">1.</span><span class="cm-builtin">.</span><span class="cm-number">10</span>]</span></pre></div><pre class=""><span style="padding-right: 0.1px;">(<span class="cm-number">55</span>,<span class="cm-number">3628800</span>)</span></pre></div></div></div></div></div><div style="position: absolute; height: 30px; width: 1px; top: 0px;"></div><div class="CodeMirror-gutters" style="display: none; height: 44px;"></div></div></div></pre><p></p><h1><a name='header-c638' class='md-header-anchor '></a>Анти-паттерн</h1><p>Порівняйте дві функції:</p><pre class="md-fences md-end-block" lang="haskell"> <div class="CodeMirror cm-s-inner CodeMirror-wrap"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 4px;"></div><div class="CodeMirror-hscrollbar" style="left: 0px;"><div style="height: 100%; min-height: 1px; width: 0px;"></div></div><div class="CodeMirror-vscrollbar"><div style="min-width: 1px; height: 0px;"></div></div><div class="CodeMirror-scrollbar-filler"></div><div class="CodeMirror-gutter-filler"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; min-height: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines"><div style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><pre class=""><span style="padding-right: 0.1px;"><span class="cm-variable">bad</span> <span class="cm-keyword">::</span> [<span class="cm-builtin">Double</span>] <span class="cm-keyword">-&gt;</span> (<span class="cm-builtin">Double</span>, <span class="cm-builtin">Double</span>)</span></pre></div><pre class=""><span style="padding-right: 0.1px;"><span class="cm-variable">bad</span> <span class="cm-variable">xs</span> <span class="cm-keyword">=</span> (<span class="cm-qualifier">Prelude.</span><span class="cm-builtin">sum</span> <span class="cm-variable">xs</span>, <span class="cm-qualifier">Prelude.</span><span class="cm-builtin">product</span> <span class="cm-variable">xs</span>)</span></pre><pre class=""><span style="padding-right: 0.1px;"><span>​</span></span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-variable">good</span> <span class="cm-keyword">::</span> [<span class="cm-builtin">Double</span>] <span class="cm-keyword">-&gt;</span> (<span class="cm-builtin">Double</span>, <span class="cm-builtin">Double</span>)</span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-variable">good</span> <span class="cm-variable">xs</span> <span class="cm-keyword">=</span> <span class="cm-variable">fold</span> ((,) <span class="cm-variable">&lt;$&gt;</span> <span class="cm-builtin">sum</span> <span class="cm-variable">&lt;*&gt;</span> <span class="cm-builtin">product</span>) <span class="cm-variable">xs</span></span></pre></div></div></div></div></div><div style="position: absolute; height: 30px; width: 1px; top: 0px;"></div><div class="CodeMirror-gutters" style="display: none; height: 110px;"></div></div></div></pre><p>Яка проблема в першої з них?</p><p></p><h1><a name='header-c646' class='md-header-anchor '></a>Застосовуємо <code>Applicative</code>и</h1><p>Можемо використовувати <code>Applicative</code>-інстанси не тільки для пар:</p><pre class="md-fences md-end-block" lang="haskell"> <div class="CodeMirror cm-s-inner CodeMirror-wrap"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 4px;"></div><div class="CodeMirror-hscrollbar" style="left: 0px;"><div style="height: 100%; min-height: 1px; width: 0px;"></div></div><div class="CodeMirror-vscrollbar"><div style="min-width: 1px; height: 0px;"></div></div><div class="CodeMirror-scrollbar-filler"></div><div class="CodeMirror-gutter-filler"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; min-height: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines"><div style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><pre class=""><span style="padding-right: 0.1px;"><span class="cm-builtin">sum</span> <span class="cm-keyword">::</span> <span class="cm-builtin">Num</span> <span class="cm-variable">n</span> <span class="cm-keyword">=&gt;</span> <span class="cm-variable-2">Fold</span> <span class="cm-variable">n</span> <span class="cm-variable">n</span></span></pre></div><pre class=""><span style="padding-right: 0.1px;"><span class="cm-builtin">sum</span> <span class="cm-keyword">=</span> <span class="cm-variable-2">Fold</span> <span class="cm-variable-2">Sum</span> <span class="cm-variable">getSum</span></span></pre><pre class=""><span style="padding-right: 0.1px;"><span>​</span></span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-builtin">length</span> <span class="cm-keyword">::</span> <span class="cm-builtin">Num</span> <span class="cm-variable">n</span> <span class="cm-keyword">=&gt;</span> <span class="cm-variable-2">Fold</span> <span class="cm-variable">i</span> <span class="cm-variable">n</span></span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-builtin">length</span> <span class="cm-keyword">=</span> <span class="cm-variable-2">Fold</span> (<span class="cm-keyword">\_</span> <span class="cm-keyword">-&gt;</span> <span class="cm-variable-2">Sum</span> <span class="cm-number">1</span>) <span class="cm-variable">getSum</span></span></pre><pre class=""><span style="padding-right: 0.1px;"><span>​</span></span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-variable">average</span> <span class="cm-keyword">::</span> <span class="cm-builtin">Fractional</span> <span class="cm-variable">n</span> <span class="cm-keyword">=&gt;</span> <span class="cm-variable-2">Fold</span> <span class="cm-variable">n</span> <span class="cm-variable">n</span></span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-variable">average</span> <span class="cm-keyword">=</span> (<span class="cm-builtin">/</span>) <span class="cm-variable">&lt;$&gt;</span> <span class="cm-builtin">sum</span> <span class="cm-variable">&lt;*&gt;</span> <span class="cm-builtin">length</span></span></pre></div></div></div></div></div><div style="position: absolute; height: 30px; width: 1px; top: 0px;"></div><div class="CodeMirror-gutters" style="display: none; height: 176px;"></div></div></div></pre><p>Генерує код, еквівалентний <code>average</code>, написаному &quot;вручну&quot;:</p><pre class="md-fences md-end-block" lang="haskell"> <div class="CodeMirror cm-s-inner CodeMirror-wrap"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 4px;"></div><div class="CodeMirror-hscrollbar" style="left: 0px;"><div style="height: 100%; min-height: 1px; width: 0px;"></div></div><div class="CodeMirror-vscrollbar"><div style="min-width: 1px; height: 0px;"></div></div><div class="CodeMirror-scrollbar-filler"></div><div class="CodeMirror-gutter-filler"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; min-height: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines"><div style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><pre class=""><span style="padding-right: 0.1px;"><span class="cm-variable">main</span> <span class="cm-keyword">::</span> <span class="cm-builtin">IO</span> ()</span></pre></div><pre class=""><span style="padding-right: 0.1px;"><span class="cm-variable">main</span> <span class="cm-keyword">=</span> <span class="cm-builtin">print</span> (<span class="cm-variable">fold</span> <span class="cm-variable">average</span> (<span class="cm-builtin">map</span> <span class="cm-builtin">fromIntegral</span> [(<span class="cm-number">1</span><span class="cm-keyword">::</span><span class="cm-builtin">Int</span>)<span class="cm-keyword">..</span><span class="cm-number">1000000000</span>]))</span></pre></div></div></div></div></div><div style="position: absolute; height: 30px; width: 1px; top: 0px;"></div><div class="CodeMirror-gutters" style="display: none; height: 44px;"></div></div></div></pre><pre class="md-fences md-end-block" lang="bash"> <div class="CodeMirror cm-s-inner CodeMirror-wrap"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 4px;"></div><div class="CodeMirror-hscrollbar" style="left: 0px;"><div style="height: 100%; min-height: 1px; width: 0px;"></div></div><div class="CodeMirror-vscrollbar"><div style="min-width: 1px; height: 0px;"></div></div><div class="CodeMirror-scrollbar-filler"></div><div class="CodeMirror-gutter-filler"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; min-height: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines"><div style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><pre class=""><span style="padding-right: 0.1px;"><span class="cm-def">$ time</span> ./example  <span class="cm-comment"># 1.3 ns / elem</span></span></pre></div><pre class=""><span style="padding-right: 0.1px;"><span class="cm-number">5</span>.00000000067109e8</span></pre><pre class=""><span style="padding-right: 0.1px;"><span>​</span></span></pre><pre class=""><span style="padding-right: 0.1px;">real &nbsp;  0m1.281s</span></pre><pre class=""><span style="padding-right: 0.1px;">user &nbsp;  0m1.266s</span></pre><pre class=""><span style="padding-right: 0.1px;">sys &nbsp; &nbsp; 0m0.006s</span></pre></div></div></div></div></div><div style="position: absolute; height: 30px; width: 1px; top: 0px;"></div><div class="CodeMirror-gutters" style="display: none; height: 132px;"></div></div></div></pre><p></p><h1><a name='header-c656' class='md-header-anchor '></a><code>Num</code></h1><p>Можемо надати інстанси <code>Fold</code> класам <code>Num</code>, <code>Fractional</code> та <code>Floating</code>!</p><pre class="md-fences md-end-block" lang="haskell"> <div class="CodeMirror cm-s-inner CodeMirror-wrap"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 4px;"></div><div class="CodeMirror-hscrollbar" style="left: 0px;"><div style="height: 100%; min-height: 1px; width: 0px;"></div></div><div class="CodeMirror-vscrollbar"><div style="min-width: 1px; height: 0px;"></div></div><div class="CodeMirror-scrollbar-filler"></div><div class="CodeMirror-gutter-filler"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; min-height: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines"><div style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><pre class=""><span style="padding-right: 0.1px;"><span class="cm-keyword">instance</span> <span class="cm-builtin">Num</span> <span class="cm-variable">b</span> <span class="cm-keyword">=&gt;</span> <span class="cm-builtin">Num</span> (<span class="cm-variable-2">Fold</span> <span class="cm-variable">a</span> <span class="cm-variable">b</span>) <span class="cm-keyword">where</span></span></pre></div><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  <span class="cm-builtin">fromInteger</span> <span class="cm-variable">n</span> <span class="cm-keyword">=</span> <span class="cm-variable">pure</span> (<span class="cm-builtin">fromInteger</span> <span class="cm-variable">n</span>)</span></pre><pre class=""><span style="padding-right: 0.1px;"><span>​</span></span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  <span class="cm-builtin">negate</span> <span class="cm-keyword">=</span> <span class="cm-builtin">fmap</span> <span class="cm-builtin">negate</span></span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  <span class="cm-builtin">abs</span> &nbsp;  <span class="cm-keyword">=</span> <span class="cm-builtin">fmap</span> <span class="cm-builtin">abs</span></span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  <span class="cm-builtin">signum</span> <span class="cm-keyword">=</span> <span class="cm-builtin">fmap</span> <span class="cm-builtin">signum</span></span></pre><pre class=""><span style="padding-right: 0.1px;"><span>​</span></span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  (<span class="cm-builtin">+</span>) <span class="cm-keyword">=</span> <span class="cm-variable">liftA2</span> (<span class="cm-builtin">+</span>)</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  (<span class="cm-builtin">*</span>) <span class="cm-keyword">=</span> <span class="cm-variable">liftA2</span> (<span class="cm-builtin">*</span>)</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  (<span class="cm-builtin">-</span>) <span class="cm-keyword">=</span> <span class="cm-variable">liftA2</span> (<span class="cm-builtin">-</span>)</span></pre><pre class=""><span style="padding-right: 0.1px;"><span>​</span></span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-keyword">instance</span> <span class="cm-builtin">Fractional</span> <span class="cm-variable">b</span> <span class="cm-keyword">=&gt;</span> <span class="cm-builtin">Fractional</span> (<span class="cm-variable-2">Fold</span> <span class="cm-variable">a</span> <span class="cm-variable">b</span>) <span class="cm-keyword">where</span></span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  <span class="cm-builtin">fromRational</span> <span class="cm-variable">n</span> <span class="cm-keyword">=</span> <span class="cm-variable">pure</span> (<span class="cm-builtin">fromRational</span> <span class="cm-variable">n</span>)</span></pre><pre class=""><span style="padding-right: 0.1px;"><span>​</span></span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  <span class="cm-builtin">recip</span> <span class="cm-keyword">=</span> <span class="cm-builtin">fmap</span> <span class="cm-builtin">recip</span></span></pre><pre class=""><span style="padding-right: 0.1px;"><span>​</span></span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  (<span class="cm-builtin">/</span>) <span class="cm-keyword">=</span> <span class="cm-variable">liftA2</span> (<span class="cm-builtin">/</span>)</span></pre><pre class=""><span style="padding-right: 0.1px;"><span>​</span></span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-keyword">instance</span> <span class="cm-builtin">Floating</span> <span class="cm-variable">b</span> <span class="cm-keyword">=&gt;</span> <span class="cm-builtin">Floating</span> (<span class="cm-variable-2">Fold</span> <span class="cm-variable">a</span> <span class="cm-variable">b</span>) <span class="cm-keyword">where</span></span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  <span class="cm-builtin">pi</span> <span class="cm-keyword">=</span> <span class="cm-variable">pure</span> <span class="cm-builtin">pi</span></span></pre><pre class=""><span style="padding-right: 0.1px;"><span>​</span></span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  <span class="cm-builtin">exp</span> &nbsp; <span class="cm-keyword">=</span> <span class="cm-builtin">fmap</span> <span class="cm-builtin">exp</span></span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  <span class="cm-builtin">sqrt</span>  <span class="cm-keyword">=</span> <span class="cm-builtin">fmap</span> <span class="cm-builtin">sqrt</span></span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  <span class="cm-builtin">log</span> &nbsp; <span class="cm-keyword">=</span> <span class="cm-builtin">fmap</span> <span class="cm-builtin">log</span></span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  <span class="cm-builtin">sin</span> &nbsp; <span class="cm-keyword">=</span> <span class="cm-builtin">fmap</span> <span class="cm-builtin">sin</span></span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  <span class="cm-builtin">tan</span> &nbsp; <span class="cm-keyword">=</span> <span class="cm-builtin">fmap</span> <span class="cm-builtin">tan</span></span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  <span class="cm-builtin">cos</span> &nbsp; <span class="cm-keyword">=</span> <span class="cm-builtin">fmap</span> <span class="cm-builtin">cos</span></span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  <span class="cm-builtin">asin</span>  <span class="cm-keyword">=</span> <span class="cm-builtin">fmap</span> <span class="cm-builtin">sin</span></span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  <span class="cm-builtin">atan</span>  <span class="cm-keyword">=</span> <span class="cm-builtin">fmap</span> <span class="cm-builtin">atan</span></span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  <span class="cm-builtin">acos</span>  <span class="cm-keyword">=</span> <span class="cm-builtin">fmap</span> <span class="cm-builtin">acos</span></span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  <span class="cm-builtin">sinh</span>  <span class="cm-keyword">=</span> <span class="cm-builtin">fmap</span> <span class="cm-builtin">sinh</span></span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  <span class="cm-builtin">tanh</span>  <span class="cm-keyword">=</span> <span class="cm-builtin">fmap</span> <span class="cm-builtin">tanh</span></span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  <span class="cm-builtin">cosh</span>  <span class="cm-keyword">=</span> <span class="cm-builtin">fmap</span> <span class="cm-builtin">cosh</span></span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  <span class="cm-builtin">asinh</span> <span class="cm-keyword">=</span> <span class="cm-builtin">fmap</span> <span class="cm-builtin">asinh</span></span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  <span class="cm-builtin">atanh</span> <span class="cm-keyword">=</span> <span class="cm-builtin">fmap</span> <span class="cm-builtin">atanh</span></span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  <span class="cm-builtin">acosh</span> <span class="cm-keyword">=</span> <span class="cm-builtin">fmap</span> <span class="cm-builtin">acosh</span></span></pre><pre class=""><span style="padding-right: 0.1px;"><span>​</span></span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  (<span class="cm-builtin">**</span>) &nbsp;  <span class="cm-keyword">=</span> <span class="cm-variable">liftA2</span> (<span class="cm-builtin">**</span>)</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  <span class="cm-builtin">logBase</span> <span class="cm-keyword">=</span> <span class="cm-variable">liftA2</span> <span class="cm-builtin">logBase</span></span></pre></div></div></div></div></div><div style="position: absolute; height: 30px; width: 1px; top: 0px;"></div><div class="CodeMirror-gutters" style="display: none; height: 858px;"></div></div></div></pre><p></p><h1><a name='header-c662' class='md-header-anchor '></a>Числові <code>Fold</code>и</h1><p>Можемо робити круті штуки:</p><pre class="md-fences md-end-block" lang="haskell"> <div class="CodeMirror cm-s-inner CodeMirror-wrap"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 4px;"></div><div class="CodeMirror-hscrollbar" style="left: 0px;"><div style="height: 100%; min-height: 1px; width: 0px;"></div></div><div class="CodeMirror-vscrollbar"><div style="min-width: 1px; height: 0px;"></div></div><div class="CodeMirror-scrollbar-filler"></div><div class="CodeMirror-gutter-filler"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; min-height: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines"><div style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><pre class=""><span style="padding-right: 0.1px;"><span class="cm-variable">&gt;&gt;&gt;</span> <span class="cm-variable">fold</span> (<span class="cm-builtin">length</span> <span class="cm-builtin">-</span> <span class="cm-number">1</span>) [<span class="cm-number">1.</span><span class="cm-builtin">.</span><span class="cm-number">10</span>]</span></pre></div><pre class=""><span style="padding-right: 0.1px;"><span class="cm-number">9</span></span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-variable">&gt;&gt;&gt;</span> <span class="cm-keyword">let</span> <span class="cm-variable">average</span> <span class="cm-keyword">=</span> <span class="cm-builtin">sum</span> <span class="cm-builtin">/</span> <span class="cm-builtin">length</span></span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-variable">&gt;&gt;&gt;</span> <span class="cm-variable">fold</span> <span class="cm-variable">average</span> [<span class="cm-number">1.</span><span class="cm-builtin">.</span><span class="cm-number">10</span>]</span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-number">5.5</span></span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-variable">&gt;&gt;&gt;</span> <span class="cm-variable">fold</span> (<span class="cm-builtin">sin</span> <span class="cm-variable">average</span> <span class="cm-builtin">^</span> <span class="cm-number">2</span> <span class="cm-builtin">+</span> <span class="cm-builtin">cos</span> <span class="cm-variable">average</span>  <span class="cm-builtin">^</span> <span class="cm-number">2</span>) [<span class="cm-number">1.</span><span class="cm-builtin">.</span><span class="cm-number">10</span>]</span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-number">1.0</span></span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-variable">&gt;&gt;&gt;</span> <span class="cm-variable">fold</span> <span class="cm-number">99</span> [<span class="cm-number">1.</span><span class="cm-builtin">.</span><span class="cm-number">10</span>]</span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-number">99</span></span></pre></div></div></div></div></div><div style="position: absolute; height: 30px; width: 1px; top: 0px;"></div><div class="CodeMirror-gutters" style="display: none; height: 198px;"></div></div></div></pre><p></p><h1><a name='header-c668' class='md-header-anchor '></a>Стандартне відхилення</h1><p>Формула стандартного відхилення:</p><div contenteditable="false" class="mathjax-block md-end-block" id="mathjax-c670" cid="c670" mdtype="math_block"><span class="MathJax_Preview"></span><span class="MathJax_SVG_Display" style="text-align: center;"><span class="MathJax_SVG" id="MathJax-Element-2-Frame" tabindex="-1" style="font-size: 100%; display: inline-block;"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="77.353ex" height="8.414ex" viewBox="0 -2313.9 33304.6 3622.7" role="img" focusable="false" style="vertical-align: -3.04ex;"><defs><path stroke-width="1" id="E2-MJMAIN-31" d="M213 578L200 573Q186 568 160 563T102 556H83V602H102Q149 604 189 617T245 641T273 663Q275 666 285 666Q294 666 302 660V361L303 61Q310 54 315 52T339 48T401 46H427V0H416Q395 3 257 3Q121 3 100 0H88V46H114Q136 46 152 46T177 47T193 50T201 52T207 57T213 61V578Z"></path><path stroke-width="1" id="E2-MJMATHI-4E" d="M234 637Q231 637 226 637Q201 637 196 638T191 649Q191 676 202 682Q204 683 299 683Q376 683 387 683T401 677Q612 181 616 168L670 381Q723 592 723 606Q723 633 659 637Q635 637 635 648Q635 650 637 660Q641 676 643 679T653 683Q656 683 684 682T767 680Q817 680 843 681T873 682Q888 682 888 672Q888 650 880 642Q878 637 858 637Q787 633 769 597L620 7Q618 0 599 0Q585 0 582 2Q579 5 453 305L326 604L261 344Q196 88 196 79Q201 46 268 46H278Q284 41 284 38T282 19Q278 6 272 0H259Q228 2 151 2Q123 2 100 2T63 2T46 1Q31 1 31 10Q31 14 34 26T39 40Q41 46 62 46Q130 49 150 85Q154 91 221 362L289 634Q287 635 234 637Z"></path><path stroke-width="1" id="E2-MJSZ2-2211" d="M60 948Q63 950 665 950H1267L1325 815Q1384 677 1388 669H1348L1341 683Q1320 724 1285 761Q1235 809 1174 838T1033 881T882 898T699 902H574H543H251L259 891Q722 258 724 252Q725 250 724 246Q721 243 460 -56L196 -356Q196 -357 407 -357Q459 -357 548 -357T676 -358Q812 -358 896 -353T1063 -332T1204 -283T1307 -196Q1328 -170 1348 -124H1388Q1388 -125 1381 -145T1356 -210T1325 -294L1267 -449L666 -450Q64 -450 61 -448Q55 -446 55 -439Q55 -437 57 -433L590 177Q590 178 557 222T452 366T322 544L56 909L55 924Q55 945 60 948Z"></path><path stroke-width="1" id="E2-MJMATHI-69" d="M184 600Q184 624 203 642T247 661Q265 661 277 649T290 619Q290 596 270 577T226 557Q211 557 198 567T184 600ZM21 287Q21 295 30 318T54 369T98 420T158 442Q197 442 223 419T250 357Q250 340 236 301T196 196T154 83Q149 61 149 51Q149 26 166 26Q175 26 185 29T208 43T235 78T260 137Q263 149 265 151T282 153Q302 153 302 143Q302 135 293 112T268 61T223 11T161 -11Q129 -11 102 10T74 74Q74 91 79 106T122 220Q160 321 166 341T173 380Q173 404 156 404H154Q124 404 99 371T61 287Q60 286 59 284T58 281T56 279T53 278T49 278T41 278H27Q21 284 21 287Z"></path><path stroke-width="1" id="E2-MJMAIN-3D" d="M56 347Q56 360 70 367H707Q722 359 722 347Q722 336 708 328L390 327H72Q56 332 56 347ZM56 153Q56 168 72 173H708Q722 163 722 153Q722 140 707 133H70Q56 140 56 153Z"></path><path stroke-width="1" id="E2-MJMAIN-28" d="M94 250Q94 319 104 381T127 488T164 576T202 643T244 695T277 729T302 750H315H319Q333 750 333 741Q333 738 316 720T275 667T226 581T184 443T167 250T184 58T225 -81T274 -167T316 -220T333 -241Q333 -250 318 -250H315H302L274 -226Q180 -141 137 -14T94 250Z"></path><path stroke-width="1" id="E2-MJMATHI-78" d="M52 289Q59 331 106 386T222 442Q257 442 286 424T329 379Q371 442 430 442Q467 442 494 420T522 361Q522 332 508 314T481 292T458 288Q439 288 427 299T415 328Q415 374 465 391Q454 404 425 404Q412 404 406 402Q368 386 350 336Q290 115 290 78Q290 50 306 38T341 26Q378 26 414 59T463 140Q466 150 469 151T485 153H489Q504 153 504 145Q504 144 502 134Q486 77 440 33T333 -11Q263 -11 227 52Q186 -10 133 -10H127Q78 -10 57 16T35 71Q35 103 54 123T99 143Q142 143 142 101Q142 81 130 66T107 46T94 41L91 40Q91 39 97 36T113 29T132 26Q168 26 194 71Q203 87 217 139T245 247T261 313Q266 340 266 352Q266 380 251 392T217 404Q177 404 142 372T93 290Q91 281 88 280T72 278H58Q52 284 52 289Z"></path><path stroke-width="1" id="E2-MJMAIN-2212" d="M84 237T84 250T98 270H679Q694 262 694 250T679 230H98Q84 237 84 250Z"></path><path stroke-width="1" id="E2-MJMAIN-AF" d="M69 544V590H430V544H69Z"></path><path stroke-width="1" id="E2-MJMAIN-29" d="M60 749L64 750Q69 750 74 750H86L114 726Q208 641 251 514T294 250Q294 182 284 119T261 12T224 -76T186 -143T145 -194T113 -227T90 -246Q87 -249 86 -250H74Q66 -250 63 -250T58 -247T55 -238Q56 -237 66 -225Q221 -64 221 250T66 725Q56 737 55 738Q55 746 60 749Z"></path><path stroke-width="1" id="E2-MJMAIN-32" d="M109 429Q82 429 66 447T50 491Q50 562 103 614T235 666Q326 666 387 610T449 465Q449 422 429 383T381 315T301 241Q265 210 201 149L142 93L218 92Q375 92 385 97Q392 99 409 186V189H449V186Q448 183 436 95T421 3V0H50V19V31Q50 38 56 46T86 81Q115 113 136 137Q145 147 170 174T204 211T233 244T261 278T284 308T305 340T320 369T333 401T340 431T343 464Q343 527 309 573T212 619Q179 619 154 602T119 569T109 550Q109 549 114 549Q132 549 151 535T170 489Q170 464 154 447T109 429Z"></path><path stroke-width="1" id="E2-MJSZ4-E001" d="M702 589Q706 601 718 605H1061Q1076 597 1076 585Q1076 572 1061 565H742V0Q734 -14 724 -14H722H720Q708 -14 702 0V589Z"></path><path stroke-width="1" id="E2-MJSZ4-23B7" d="M742 -871Q740 -873 737 -876T733 -880T730 -882T724 -884T714 -885H702L222 569L180 484Q138 399 137 399Q131 404 124 412L111 425L265 736L702 -586V168L703 922Q713 935 722 935Q734 935 742 920V-871Z"></path><path stroke-width="1" id="E2-MJSZ4-E000" d="M722 -14H720Q708 -14 702 0V306L703 612Q713 625 722 625Q734 625 742 610V0Q734 -14 724 -14H722Z"></path><path stroke-width="1" id="E2-MJSZ4-28" d="M758 -1237T758 -1240T752 -1249H736Q718 -1249 717 -1248Q711 -1245 672 -1199Q237 -706 237 251T672 1700Q697 1730 716 1749Q718 1750 735 1750H752Q758 1744 758 1741Q758 1737 740 1713T689 1644T619 1537T540 1380T463 1176Q348 802 348 251Q348 -242 441 -599T744 -1218Q758 -1237 758 -1240Z"></path><path stroke-width="1" id="E2-MJSZ4-29" d="M33 1741Q33 1750 51 1750H60H65Q73 1750 81 1743T119 1700Q554 1207 554 251Q554 -707 119 -1199Q76 -1250 66 -1250Q65 -1250 62 -1250T56 -1249Q55 -1249 53 -1249T49 -1250Q33 -1250 33 -1239Q33 -1236 50 -1214T98 -1150T163 -1052T238 -910T311 -727Q443 -335 443 251Q443 402 436 532T405 831T339 1142T224 1438T50 1716Q33 1737 33 1741Z"></path></defs><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><g transform="translate(0,1962)"><use xlink:href="#E2-MJSZ4-E001" x="0" y="-606"></use><g transform="translate(0,-1368.9703475289352) scale(1,1.2747130152219412)"><use xlink:href="#E2-MJSZ4-E000"></use></g><use xlink:href="#E2-MJSZ4-23B7" x="0" y="-2275"></use></g><rect stroke="none" width="6854" height="60" x="1056" y="1902"></rect><g transform="translate(1056,0)"><g transform="translate(120,0)"><rect stroke="none" width="1008" height="60" x="0" y="220"></rect><use xlink:href="#E2-MJMAIN-31" x="254" y="676"></use><use xlink:href="#E2-MJMATHI-4E" x="60" y="-686"></use></g><g transform="translate(1415,0)"><use xlink:href="#E2-MJSZ2-2211" x="0" y="0"></use><g transform="translate(147,-1090)"><use transform="scale(0.707)" xlink:href="#E2-MJMATHI-69" x="0" y="0"></use><use transform="scale(0.707)" xlink:href="#E2-MJMAIN-3D" x="345" y="0"></use><use transform="scale(0.707)" xlink:href="#E2-MJMAIN-31" x="1124" y="0"></use></g><use transform="scale(0.707)" xlink:href="#E2-MJMATHI-4E" x="577" y="1627"></use></g><use xlink:href="#E2-MJMAIN-28" x="2859" y="0"></use><g transform="translate(3249,0)"><use xlink:href="#E2-MJMATHI-78" x="0" y="0"></use><use transform="scale(0.707)" xlink:href="#E2-MJMATHI-69" x="809" y="-213"></use></g><use xlink:href="#E2-MJMAIN-2212" x="4388" y="0"></use><g transform="translate(5388,0)"><use xlink:href="#E2-MJMATHI-78" x="24" y="0"></use><g transform="translate(0,259)"><use transform="scale(0.707)" xlink:href="#E2-MJMAIN-AF" x="-70" y="0"></use><g transform="translate(243.33524654895245,0) scale(0.2427625054254761,1)"><use transform="scale(0.707)" xlink:href="#E2-MJMAIN-AF"></use></g><use transform="scale(0.707)" xlink:href="#E2-MJMAIN-AF" x="379" y="0"></use></g></g><g transform="translate(6010,0)"><use xlink:href="#E2-MJMAIN-29" x="0" y="0"></use><use transform="scale(0.707)" xlink:href="#E2-MJMAIN-32" x="550" y="583"></use></g></g><use xlink:href="#E2-MJMAIN-3D" x="8188" y="0"></use><g transform="translate(9244,0)"><g transform="translate(0,1978)"><use xlink:href="#E2-MJSZ4-E001" x="0" y="-606"></use><g transform="translate(0,-1436.8903291731667) scale(1,1.3832113884555381)"><use xlink:href="#E2-MJSZ4-E000"></use></g><use xlink:href="#E2-MJSZ4-23B7" x="0" y="-2344"></use></g><rect stroke="none" width="7769" height="60" x="1056" y="1918"></rect><g transform="translate(1056,0)"><g transform="translate(120,0)"><rect stroke="none" width="1008" height="60" x="0" y="220"></rect><use xlink:href="#E2-MJMAIN-31" x="254" y="676"></use><use xlink:href="#E2-MJMATHI-4E" x="60" y="-686"></use></g><g transform="translate(1248,0)"><use xlink:href="#E2-MJSZ4-28"></use><g transform="translate(792,0)"><use xlink:href="#E2-MJSZ2-2211" x="0" y="0"></use><g transform="translate(147,-1090)"><use transform="scale(0.707)" xlink:href="#E2-MJMATHI-69" x="0" y="0"></use><use transform="scale(0.707)" xlink:href="#E2-MJMAIN-3D" x="345" y="0"></use><use transform="scale(0.707)" xlink:href="#E2-MJMAIN-31" x="1124" y="0"></use></g><use transform="scale(0.707)" xlink:href="#E2-MJMATHI-4E" x="577" y="1627"></use></g><g transform="translate(2403,0)"><use xlink:href="#E2-MJMATHI-78" x="0" y="0"></use><use transform="scale(0.707)" xlink:href="#E2-MJMAIN-32" x="809" y="488"></use><use transform="scale(0.707)" xlink:href="#E2-MJMATHI-69" x="809" y="-430"></use></g><use xlink:href="#E2-MJSZ4-29" x="3430" y="0"></use></g><use xlink:href="#E2-MJMAIN-2212" x="5693" y="0"></use><g transform="translate(6694,0)"><use xlink:href="#E2-MJMATHI-78" x="24" y="0"></use><g transform="translate(0,259)"><use transform="scale(0.707)" xlink:href="#E2-MJMAIN-AF" x="-70" y="0"></use><g transform="translate(243.33524654895245,0) scale(0.2427625054254761,1)"><use transform="scale(0.707)" xlink:href="#E2-MJMAIN-AF"></use></g><use transform="scale(0.707)" xlink:href="#E2-MJMAIN-AF" x="379" y="0"></use></g><use transform="scale(0.707)" xlink:href="#E2-MJMAIN-32" x="879" y="712"></use></g></g></g><use xlink:href="#E2-MJMAIN-3D" x="18349" y="0"></use><g transform="translate(19405,0)"><g transform="translate(0,2177)"><use xlink:href="#E2-MJSZ4-E001" x="0" y="-606"></use><g transform="translate(0,-1630.8630583091085) scale(1,1.6930719781295662)"><use xlink:href="#E2-MJSZ4-E000"></use></g><use xlink:href="#E2-MJSZ4-23B7" x="0" y="-2543"></use></g><rect stroke="none" width="12842" height="60" x="1056" y="2117"></rect><g transform="translate(1056,0)"><use xlink:href="#E2-MJSZ4-28"></use><g transform="translate(792,0)"><g transform="translate(120,0)"><rect stroke="none" width="1008" height="60" x="0" y="220"></rect><use xlink:href="#E2-MJMAIN-31" x="254" y="676"></use><use xlink:href="#E2-MJMATHI-4E" x="60" y="-686"></use></g></g><g transform="translate(2207,0)"><use xlink:href="#E2-MJSZ2-2211" x="0" y="0"></use><g transform="translate(147,-1090)"><use transform="scale(0.707)" xlink:href="#E2-MJMATHI-69" x="0" y="0"></use><use transform="scale(0.707)" xlink:href="#E2-MJMAIN-3D" x="345" y="0"></use><use transform="scale(0.707)" xlink:href="#E2-MJMAIN-31" x="1124" y="0"></use></g><use transform="scale(0.707)" xlink:href="#E2-MJMATHI-4E" x="577" y="1627"></use></g><g transform="translate(3818,0)"><use xlink:href="#E2-MJMATHI-78" x="0" y="0"></use><use transform="scale(0.707)" xlink:href="#E2-MJMAIN-32" x="809" y="488"></use><use transform="scale(0.707)" xlink:href="#E2-MJMATHI-69" x="809" y="-430"></use></g><use xlink:href="#E2-MJSZ4-29" x="4845" y="0"></use><use xlink:href="#E2-MJMAIN-2212" x="5859" y="0"></use><g transform="translate(6860,0)"><use xlink:href="#E2-MJSZ4-28"></use><g transform="translate(792,0)"><g transform="translate(120,0)"><rect stroke="none" width="1008" height="60" x="0" y="220"></rect><use xlink:href="#E2-MJMAIN-31" x="254" y="676"></use><use xlink:href="#E2-MJMATHI-4E" x="60" y="-686"></use></g></g><g transform="translate(2207,0)"><use xlink:href="#E2-MJSZ2-2211" x="0" y="0"></use><g transform="translate(147,-1090)"><use transform="scale(0.707)" xlink:href="#E2-MJMATHI-69" x="0" y="0"></use><use transform="scale(0.707)" xlink:href="#E2-MJMAIN-3D" x="345" y="0"></use><use transform="scale(0.707)" xlink:href="#E2-MJMAIN-31" x="1124" y="0"></use></g><use transform="scale(0.707)" xlink:href="#E2-MJMATHI-4E" x="577" y="1627"></use></g><g transform="translate(3818,0)"><use xlink:href="#E2-MJMATHI-78" x="0" y="0"></use><use transform="scale(0.707)" xlink:href="#E2-MJMATHI-69" x="809" y="-213"></use></g><use xlink:href="#E2-MJSZ4-29" x="4735" y="0"></use><use transform="scale(0.707)" xlink:href="#E2-MJMAIN-32" x="7817" y="2090"></use></g></g></g></g></svg></span></span><script type="math/tex; mode=display" id="MathJax-Element-2">
\sqrt{\frac{1}{N} \sum_{i=1}^N (x_i - \overline x)^2} = \sqrt{\frac{1}{N} \left(\sum_{i=1}^N x_i^2\right) - \overline{x}^2} = \sqrt{\left(\frac{1}{N}\sum_{i=1}^N x_i^2\right) - \left(\frac{1}{N}\sum_{i=1}^N x_i\right)^2}
</script></div><p>Еквівалент через <code>Fold</code> читається майже так само просто, як остання формула:</p><pre class="md-fences md-end-block" lang="haskell"> <div class="CodeMirror cm-s-inner CodeMirror-wrap"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 4px;"></div><div class="CodeMirror-hscrollbar" style="left: 0px;"><div style="height: 100%; min-height: 1px; width: 0px;"></div></div><div class="CodeMirror-vscrollbar"><div style="min-width: 1px; height: 0px;"></div></div><div class="CodeMirror-scrollbar-filler"></div><div class="CodeMirror-gutter-filler"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; min-height: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines"><div style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><pre class=""><span style="padding-right: 0.1px;"><span class="cm-variable">standardDeviation</span> <span class="cm-keyword">::</span> <span class="cm-builtin">Floating</span> <span class="cm-variable">n</span> <span class="cm-keyword">=&gt;</span> <span class="cm-variable-2">Fold</span> <span class="cm-variable">n</span> <span class="cm-variable">n</span></span></pre></div><pre class=""><span style="padding-right: 0.1px;"><span class="cm-variable">standardDeviation</span> <span class="cm-keyword">=</span> <span class="cm-builtin">sqrt</span> ((<span class="cm-variable">sumOfSquares</span> <span class="cm-builtin">/</span> <span class="cm-builtin">length</span>) <span class="cm-builtin">-</span> (<span class="cm-builtin">sum</span> <span class="cm-builtin">/</span> <span class="cm-builtin">length</span>) <span class="cm-builtin">^</span> <span class="cm-number">2</span>)</span></pre><pre class=""><span style="padding-right: 0.1px;">  <span class="cm-keyword">where</span></span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  <span class="cm-variable">sumOfSquares</span> <span class="cm-keyword">=</span> <span class="cm-variable-2">Fold</span> (<span class="cm-variable-2">Sum</span> <span class="cm-builtin">.</span> (<span class="cm-builtin">^</span><span class="cm-number">2</span>)) <span class="cm-variable">getSum</span></span></pre></div></div></div></div></div><div style="position: absolute; height: 30px; width: 1px; top: 0px;"></div><div class="CodeMirror-gutters" style="display: none; height: 88px;"></div></div></div></pre><pre class="md-fences md-end-block" lang="haskell"> <div class="CodeMirror cm-s-inner CodeMirror-wrap"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 4px;"></div><div class="CodeMirror-hscrollbar" style="left: 0px;"><div style="height: 100%; min-height: 1px; width: 0px;"></div></div><div class="CodeMirror-vscrollbar"><div style="min-width: 1px; height: 0px;"></div></div><div class="CodeMirror-scrollbar-filler"></div><div class="CodeMirror-gutter-filler"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; min-height: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines"><div style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><pre class=""><span style="padding-right: 0.1px;"><span class="cm-variable">&gt;&gt;&gt;</span> <span class="cm-variable">fold</span> <span class="cm-variable">standardDeviation</span> [<span class="cm-number">1.</span><span class="cm-builtin">.</span><span class="cm-number">100</span>]</span></pre></div><pre class=""><span style="padding-right: 0.1px;"><span class="cm-number">28.86607004772212</span></span></pre></div></div></div></div></div><div style="position: absolute; height: 30px; width: 1px; top: 0px;"></div><div class="CodeMirror-gutters" style="display: none; height: 44px;"></div></div></div></pre><p></p><h1><a name='header-c678' class='md-header-anchor '></a>Фолдимо <code>ListT</code></h1><p><code>ListT</code> із пакету <code>list-transformers</code> визначено так:</p><pre class="md-fences md-end-block" lang="haskell"> <div class="CodeMirror cm-s-inner CodeMirror-wrap"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 4px;"></div><div class="CodeMirror-hscrollbar" style="left: 0px;"><div style="height: 100%; min-height: 1px; width: 0px;"></div></div><div class="CodeMirror-vscrollbar"><div style="min-width: 1px; height: 0px;"></div></div><div class="CodeMirror-scrollbar-filler"></div><div class="CodeMirror-gutter-filler"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; min-height: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines"><div style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><pre class=""><span style="padding-right: 0.1px;"><span class="cm-keyword">newtype</span> <span class="cm-variable-2">ListT</span> <span class="cm-variable">m</span> <span class="cm-variable">a</span> <span class="cm-keyword">=</span> <span class="cm-variable-2">ListT</span> { <span class="cm-variable">next</span> <span class="cm-keyword">::</span> <span class="cm-variable">m</span> (<span class="cm-variable-2">Step</span> <span class="cm-variable">m</span> <span class="cm-variable">a</span>) }</span></pre></div><pre class=""><span style="padding-right: 0.1px;"><span>​</span></span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-keyword">data</span> <span class="cm-variable-2">Step</span> <span class="cm-variable">m</span> <span class="cm-variable">a</span> <span class="cm-keyword">=</span> <span class="cm-variable-2">Cons</span> <span class="cm-variable">a</span> (<span class="cm-variable-2">ListT</span> <span class="cm-variable">m</span> <span class="cm-variable">a</span>) <span class="cm-variable">|</span> <span class="cm-variable-2">Nil</span></span></pre></div></div></div></div></div><div style="position: absolute; height: 30px; width: 1px; top: 0px;"></div><div class="CodeMirror-gutters" style="display: none; height: 66px;"></div></div></div></pre><p>Можемо його згорнути!</p><pre class="md-fences md-end-block" lang="haskell"> <div class="CodeMirror cm-s-inner CodeMirror-wrap"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 4px;"></div><div class="CodeMirror-hscrollbar" style="left: 0px;"><div style="height: 100%; min-height: 1px; width: 0px;"></div></div><div class="CodeMirror-vscrollbar"><div style="min-width: 1px; height: 0px;"></div></div><div class="CodeMirror-scrollbar-filler"></div><div class="CodeMirror-gutter-filler"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; min-height: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines"><div style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><pre class=""><span style="padding-right: 0.1px;"><span class="cm-meta">{-# LANGUAGE BangPatterns #-}</span></span></pre></div><pre class=""><span style="padding-right: 0.1px;"><span>​</span></span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-keyword">import</span> <span class="cm-qualifier">List.</span><span class="cm-variable-2">Transformer</span> (<span class="cm-variable-2">ListT</span>(<span class="cm-keyword">..</span>), <span class="cm-variable-2">Step</span>(<span class="cm-keyword">..</span>))</span></pre><pre class=""><span style="padding-right: 0.1px;"><span>​</span></span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-keyword">import</span> <span class="cm-variable">qualified</span> <span class="cm-qualifier">System.</span><span class="cm-builtin">IO</span></span></pre><pre class=""><span style="padding-right: 0.1px;"><span>​</span></span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-variable">foldListT</span> <span class="cm-keyword">::</span> <span class="cm-builtin">Monad</span> <span class="cm-variable">m</span> <span class="cm-keyword">=&gt;</span> <span class="cm-variable-2">Fold</span> <span class="cm-variable">i</span> <span class="cm-variable">o</span> <span class="cm-keyword">-&gt;</span> <span class="cm-variable-2">ListT</span> <span class="cm-variable">m</span> <span class="cm-variable">i</span> <span class="cm-keyword">-&gt;</span> <span class="cm-variable">m</span> <span class="cm-variable">o</span></span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-variable">foldListT</span> (<span class="cm-variable-2">Fold</span> <span class="cm-variable">tally</span> <span class="cm-variable">summarize</span>) <span class="cm-keyword">=</span> <span class="cm-variable">go</span> <span class="cm-variable">mempty</span></span></pre><pre class=""><span style="padding-right: 0.1px;">  <span class="cm-keyword">where</span></span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  <span class="cm-variable">go</span> <span class="cm-variable">!m</span> <span class="cm-variable">l</span> <span class="cm-keyword">=</span> <span class="cm-keyword">do</span></span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  <span class="cm-variable">s</span> <span class="cm-keyword">&lt;-</span> <span class="cm-variable">next</span> <span class="cm-variable">l</span></span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  <span class="cm-keyword">case</span> <span class="cm-variable">s</span> <span class="cm-keyword">of</span></span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  <span class="cm-variable-2">Nil</span> &nbsp; &nbsp; &nbsp; <span class="cm-keyword">-&gt;</span> <span class="cm-builtin">return</span> (<span class="cm-variable">summarize</span> <span class="cm-variable">m</span>)</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  <span class="cm-variable-2">Cons</span> <span class="cm-variable">x</span> <span class="cm-variable">l'</span> <span class="cm-keyword">-&gt;</span> <span class="cm-variable">go</span> (<span class="cm-variable">mappend</span> <span class="cm-variable">m</span> (<span class="cm-variable">tally</span> <span class="cm-variable">x</span>)) <span class="cm-variable">l'</span></span></pre></div></div></div></div></div><div style="position: absolute; height: 30px; width: 1px; top: 0px;"></div><div class="CodeMirror-gutters" style="display: none; height: 308px;"></div></div></div></pre><p></p><h1><a name='header-c687' class='md-header-anchor '></a>Приклад</h1><p>Можемо таким чином згорнути &quot;effectful streams&quot;:</p><pre class="md-fences md-end-block" lang="haskell"> <div class="CodeMirror cm-s-inner CodeMirror-wrap"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 4px;"></div><div class="CodeMirror-hscrollbar" style="left: 0px;"><div style="height: 100%; min-height: 1px; width: 0px;"></div></div><div class="CodeMirror-vscrollbar"><div style="min-width: 1px; height: 0px;"></div></div><div class="CodeMirror-scrollbar-filler"></div><div class="CodeMirror-gutter-filler"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; min-height: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines"><div style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><pre class=""><span style="padding-right: 0.1px;"><span class="cm-variable">stdin</span> <span class="cm-keyword">::</span> <span class="cm-variable-2">ListT</span> <span class="cm-builtin">IO</span> <span class="cm-builtin">String</span></span></pre></div><pre class=""><span style="padding-right: 0.1px;"><span class="cm-variable">stdin</span> <span class="cm-keyword">=</span> <span class="cm-variable-2">ListT</span> (<span class="cm-keyword">do</span></span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  <span class="cm-variable">eof</span> <span class="cm-keyword">&lt;-</span> <span class="cm-qualifier">System.IO.</span><span class="cm-variable">isEOF</span></span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  <span class="cm-keyword">if</span> <span class="cm-variable">eof</span></span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  <span class="cm-keyword">then</span> <span class="cm-builtin">return</span> <span class="cm-variable-2">Nil</span></span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  <span class="cm-keyword">else</span> <span class="cm-keyword">do</span></span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  <span class="cm-variable">line</span> <span class="cm-keyword">&lt;-</span> <span class="cm-builtin">getLine</span></span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  <span class="cm-builtin">return</span> (<span class="cm-variable-2">Cons</span> <span class="cm-variable">line</span> <span class="cm-variable">stdin</span>) )</span></pre><pre class=""><span style="padding-right: 0.1px;"><span>​</span></span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-variable">main</span> <span class="cm-keyword">::</span> <span class="cm-builtin">IO</span> ()</span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-variable">main</span> <span class="cm-keyword">=</span> <span class="cm-keyword">do</span></span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  <span class="cm-variable">n</span> <span class="cm-keyword">&lt;-</span> <span class="cm-variable">foldListT</span> <span class="cm-builtin">length</span> <span class="cm-variable">stdin</span></span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  <span class="cm-builtin">print</span> <span class="cm-variable">n</span></span></pre></div></div></div></div></div><div style="position: absolute; height: 30px; width: 1px; top: 0px;"></div><div class="CodeMirror-gutters" style="display: none; height: 286px;"></div></div></div></pre><pre class="md-fences md-end-block" lang="haskell"> <div class="CodeMirror cm-s-inner CodeMirror-wrap"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 4px;"></div><div class="CodeMirror-hscrollbar" style="left: 0px;"><div style="height: 100%; min-height: 1px; width: 0px;"></div></div><div class="CodeMirror-vscrollbar"><div style="min-width: 1px; height: 0px;"></div></div><div class="CodeMirror-scrollbar-filler"></div><div class="CodeMirror-gutter-filler"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; min-height: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines"><div style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><pre class=""><span style="padding-right: 0.1px;"><span class="cm-builtin">$</span> <span class="cm-variable">yes</span> <span class="cm-variable">|</span> <span class="cm-builtin">head</span> <span class="cm-builtin">-</span><span class="cm-number">10000000</span> <span class="cm-variable">|</span> <span class="cm-variable">./example</span></span></pre></div><pre class=""><span style="padding-right: 0.1px;"><span class="cm-number">10000000</span></span></pre></div></div></div></div></div><div style="position: absolute; height: 30px; width: 1px; top: 0px;"></div><div class="CodeMirror-gutters" style="display: none; height: 44px;"></div></div></div></pre><p></p><h1><a name='header-c694' class='md-header-anchor '></a>Згортаємо потокові бібліотеки</h1><p>Можемо таким самим чином згорнути:</p><ul><li><code>conduit</code></li><li><code>io-streams</code></li><li><code>list-t</code></li><li><code>logict</code></li><li><code>machines</code></li><li><code>pipes</code></li><li><code>turtle</code></li></ul><p>Кожен <code>Fold</code> може бути перевикористаним в будь-якій із цих систем</p><p></p><h1><a name='header-c723' class='md-header-anchor '></a>Лінзи</h1><pre class="md-fences md-end-block" lang="haskell"> <div class="CodeMirror cm-s-inner CodeMirror-wrap"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 4px;"></div><div class="CodeMirror-hscrollbar" style="left: 0px;"><div style="height: 100%; min-height: 1px; width: 0px;"></div></div><div class="CodeMirror-vscrollbar"><div style="min-width: 1px; height: 0px;"></div></div><div class="CodeMirror-scrollbar-filler"></div><div class="CodeMirror-gutter-filler"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; min-height: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines"><div style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><pre class=""><span style="padding-right: 0.1px;"><span class="cm-meta">{-# LANGUAGE RankNTypes #-}</span></span></pre></div><pre class=""><span style="padding-right: 0.1px;"><span>​</span></span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-keyword">import</span> <span class="cm-qualifier">Control.</span><span class="cm-variable-2">Lens</span> (<span class="cm-variable-2">Getting</span>, <span class="cm-variable">foldMapOf</span>)</span></pre><pre class=""><span style="padding-right: 0.1px;"><span>​</span></span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-variable">focus</span> <span class="cm-keyword">::</span> (<span class="cm-variable">forall</span> <span class="cm-variable">m</span> <span class="cm-builtin">.</span> <span class="cm-variable-2">Monoid</span> <span class="cm-variable">m</span> <span class="cm-keyword">=&gt;</span> <span class="cm-variable-2">Getting</span> <span class="cm-variable">m</span> <span class="cm-variable">b</span> <span class="cm-variable">a</span>) <span class="cm-keyword">-&gt;</span> <span class="cm-variable-2">Fold</span> <span class="cm-variable">a</span> <span class="cm-variable">o</span> <span class="cm-keyword">-&gt;</span> <span class="cm-variable-2">Fold</span> <span class="cm-variable">b</span> <span class="cm-variable">o</span></span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-variable">focus</span> <span class="cm-variable">lens</span> (<span class="cm-variable-2">Fold</span> <span class="cm-variable">tally</span> <span class="cm-variable">summarize</span>) <span class="cm-keyword">=</span> <span class="cm-variable-2">Fold</span> <span class="cm-variable">tally'</span> <span class="cm-variable">summarize</span></span></pre><pre class=""><span style="padding-right: 0.1px;">  <span class="cm-keyword">where</span></span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  <span class="cm-variable">tally'</span> <span class="cm-keyword">=</span> <span class="cm-variable">foldMapOf</span> <span class="cm-variable">lens</span> <span class="cm-variable">tally</span></span></pre></div></div></div></div></div><div style="position: absolute; height: 30px; width: 1px; top: 0px;"></div><div class="CodeMirror-gutters" style="display: none; height: 176px;"></div></div></div></pre><pre class="md-fences md-end-block" lang="haskell"> <div class="CodeMirror cm-s-inner CodeMirror-wrap"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 4px;"></div><div class="CodeMirror-hscrollbar" style="left: 0px;"><div style="height: 100%; min-height: 1px; width: 0px;"></div></div><div class="CodeMirror-vscrollbar"><div style="min-width: 1px; height: 0px;"></div></div><div class="CodeMirror-scrollbar-filler"></div><div class="CodeMirror-gutter-filler"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; min-height: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines"><div style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><pre class=""><span style="padding-right: 0.1px;"><span class="cm-variable">focus</span> <span class="cm-variable">_1</span> <span class="cm-keyword">::</span> <span class="cm-variable-2">Fold</span> <span class="cm-variable">i</span> <span class="cm-variable">o</span> <span class="cm-keyword">-&gt;</span> <span class="cm-variable-2">Fold</span> (<span class="cm-variable">i</span>, <span class="cm-variable">x</span>) <span class="cm-variable">o</span></span></pre></div><pre class=""><span style="padding-right: 0.1px;"><span>​</span></span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-variable">focus</span> <span class="cm-variable">_Just</span> <span class="cm-keyword">::</span> <span class="cm-variable-2">Fold</span> <span class="cm-variable">i</span> <span class="cm-variable">o</span> <span class="cm-keyword">-&gt;</span> <span class="cm-variable-2">Fold</span> (<span class="cm-builtin">Maybe</span> <span class="cm-variable">i</span>) <span class="cm-variable">o</span></span></pre></div></div></div></div></div><div style="position: absolute; height: 30px; width: 1px; top: 0px;"></div><div class="CodeMirror-gutters" style="display: none; height: 66px;"></div></div></div></pre><p></p><h1><a name='header-c728' class='md-header-anchor '></a>Приклад</h1><pre class="md-fences md-end-block" lang="haskell"> <div class="CodeMirror cm-s-inner CodeMirror-wrap"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 4px;"></div><div class="CodeMirror-hscrollbar" style="left: 0px;"><div style="height: 100%; min-height: 1px; width: 0px;"></div></div><div class="CodeMirror-vscrollbar"><div style="min-width: 1px; height: 0px;"></div></div><div class="CodeMirror-scrollbar-filler"></div><div class="CodeMirror-gutter-filler"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; min-height: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines"><div style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><pre class=""><span style="padding-right: 0.1px;"><span class="cm-variable">items1</span> <span class="cm-keyword">::</span> [<span class="cm-builtin">Either</span> <span class="cm-builtin">Int</span> <span class="cm-builtin">String</span>]</span></pre></div><pre class=""><span style="padding-right: 0.1px;"><span class="cm-variable">items1</span> <span class="cm-keyword">=</span> [<span class="cm-builtin">Left</span> <span class="cm-number">1</span>, <span class="cm-builtin">Right</span> <span class="cm-string">"Hey"</span>, <span class="cm-builtin">Right</span> <span class="cm-string">"Foo"</span>, <span class="cm-builtin">Left</span> <span class="cm-number">4</span>, <span class="cm-builtin">Left</span> <span class="cm-number">10</span>]</span></pre></div></div></div></div></div><div style="position: absolute; height: 30px; width: 1px; top: 0px;"></div><div class="CodeMirror-gutters" style="display: none; height: 44px;"></div></div></div></pre><pre class="md-fences md-end-block" lang="haskell"> <div class="CodeMirror cm-s-inner CodeMirror-wrap"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 4px;"></div><div class="CodeMirror-hscrollbar" style="left: 0px;"><div style="height: 100%; min-height: 1px; width: 0px;"></div></div><div class="CodeMirror-vscrollbar"><div style="min-width: 1px; height: 0px;"></div></div><div class="CodeMirror-scrollbar-filler"></div><div class="CodeMirror-gutter-filler"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; min-height: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines"><div style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><pre class=""><span style="padding-right: 0.1px;"><span class="cm-variable">&gt;&gt;&gt;</span> <span class="cm-variable">fold</span> (<span class="cm-variable">focus</span> <span class="cm-variable">_Left</span> <span class="cm-builtin">sum</span>) <span class="cm-variable">items1</span></span></pre></div><pre class=""><span style="padding-right: 0.1px;"><span class="cm-number">15</span></span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-variable">&gt;&gt;&gt;</span> <span class="cm-variable">fold</span> (<span class="cm-variable">focus</span> <span class="cm-variable">_Right</span> <span class="cm-builtin">length</span>) <span class="cm-variable">items1</span></span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-number">2</span></span></pre></div></div></div></div></div><div style="position: absolute; height: 30px; width: 1px; top: 0px;"></div><div class="CodeMirror-gutters" style="display: none; height: 88px;"></div></div></div></pre><pre class="md-fences md-end-block" lang="haskell"> <div class="CodeMirror cm-s-inner CodeMirror-wrap"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 4px;"></div><div class="CodeMirror-hscrollbar" style="left: 0px;"><div style="height: 100%; min-height: 1px; width: 0px;"></div></div><div class="CodeMirror-vscrollbar"><div style="min-width: 1px; height: 0px;"></div></div><div class="CodeMirror-scrollbar-filler"></div><div class="CodeMirror-gutter-filler"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; min-height: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines"><div style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><pre class=""><span style="padding-right: 0.1px;"><span class="cm-variable">items2</span> <span class="cm-keyword">::</span> [<span class="cm-builtin">Maybe</span> (<span class="cm-builtin">Int</span>, <span class="cm-builtin">String</span>)]</span></pre></div><pre class=""><span style="padding-right: 0.1px;"><span class="cm-variable">items2</span> <span class="cm-keyword">=</span> [<span class="cm-builtin">Nothing</span>, <span class="cm-builtin">Just</span> (<span class="cm-number">1</span>, <span class="cm-string">"Foo"</span>), <span class="cm-builtin">Just</span> (<span class="cm-number">2</span>, <span class="cm-string">"Bar"</span>), <span class="cm-builtin">Nothing</span>, <span class="cm-builtin">Just</span> (<span class="cm-number">5</span>, <span class="cm-string">"Baz"</span>)]</span></pre></div></div></div></div></div><div style="position: absolute; height: 30px; width: 1px; top: 0px;"></div><div class="CodeMirror-gutters" style="display: none; height: 44px;"></div></div></div></pre><pre class="md-fences md-end-block" lang="haskell"> <div class="CodeMirror cm-s-inner CodeMirror-wrap"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 4px;"></div><div class="CodeMirror-hscrollbar" style="left: 0px;"><div style="height: 100%; min-height: 1px; width: 0px;"></div></div><div class="CodeMirror-vscrollbar"><div style="min-width: 1px; height: 0px;"></div></div><div class="CodeMirror-scrollbar-filler"></div><div class="CodeMirror-gutter-filler"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; min-height: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines"><div style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><pre class=""><span style="padding-right: 0.1px;"><span class="cm-variable">&gt;&gt;&gt;</span> <span class="cm-variable">fold</span> (<span class="cm-variable">focus</span> (<span class="cm-variable">_Just</span> <span class="cm-builtin">.</span> <span class="cm-variable">_1</span>) <span class="cm-builtin">product</span>) <span class="cm-variable">items2</span></span></pre></div><pre class=""><span style="padding-right: 0.1px;"><span class="cm-number">10</span></span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-variable">&gt;&gt;&gt;</span> <span class="cm-variable">fold</span> (<span class="cm-variable">focus</span> <span class="cm-variable">_Nothing</span> <span class="cm-builtin">length</span>) <span class="cm-variable">items2</span></span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-number">2</span></span></pre></div></div></div></div></div><div style="position: absolute; height: 30px; width: 1px; top: 0px;"></div><div class="CodeMirror-gutters" style="display: none; height: 88px;"></div></div></div></pre><p></p><h1><a name='header-c735' class='md-header-anchor '></a>На (нашій) практиці</h1><ul><li>Великі структури даних івентів</li><li>Декілька джерел</li><li>Великі структури даних звітів</li><li>Більшість результатів — &quot;в часі&quot;</li><li>Багато обв’язки для збереження та завантаження</li></ul><h1><a name='header-c753' class='md-header-anchor '></a>Івенти</h1><pre class="md-fences md-end-block" lang="haskell"> <div class="CodeMirror cm-s-inner CodeMirror-wrap"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 4px;"></div><div class="CodeMirror-hscrollbar" style="left: 0px;"><div style="height: 100%; min-height: 1px; width: 0px;"></div></div><div class="CodeMirror-vscrollbar"><div style="min-width: 1px; height: 0px;"></div></div><div class="CodeMirror-scrollbar-filler"></div><div class="CodeMirror-gutter-filler"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; min-height: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines"><div style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><pre class=""><span style="padding-right: 0.1px;"><span class="cm-keyword">data</span> <span class="cm-variable-2">DsAdBid</span> <span class="cm-variable">a</span> <span class="cm-keyword">=</span> <span class="cm-variable-2">DsAdBid</span></span></pre></div><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  { <span class="cm-variable">_abImpressionId</span> <span class="cm-keyword">::</span> <span class="cm-variable-2">ImpressionId</span></span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  , <span class="cm-variable">_abDelay</span> &nbsp; &nbsp; &nbsp;  <span class="cm-keyword">::</span> <span class="cm-builtin">Maybe</span> <span class="cm-variable-2">PageLoadDelay</span></span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  , <span class="cm-variable">_abDsAccountId</span>  <span class="cm-keyword">::</span> <span class="cm-variable-2">DsAccountId</span></span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  , <span class="cm-variable">_abAdregionId</span> &nbsp; <span class="cm-keyword">::</span> <span class="cm-variable-2">AdregionId</span></span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  , <span class="cm-variable">_abBid</span> &nbsp; &nbsp; &nbsp; &nbsp;  <span class="cm-keyword">::</span> <span class="cm-variable-2">Bid</span></span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  , <span class="cm-variable">_abCreativeCore</span> <span class="cm-keyword">::</span> <span class="cm-builtin">Maybe</span> <span class="cm-qualifier">Cr.</span><span class="cm-variable-2">CreativeCore</span></span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  }</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  <span class="cm-keyword">deriving</span> (<span class="cm-builtin">Show</span>, <span class="cm-builtin">Eq</span>, <span class="cm-variable-2">Generic</span>)</span></pre><pre class=""><span style="padding-right: 0.1px;"><span>​</span></span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-keyword">data</span> <span class="cm-variable-2">CreativeCore</span></span></pre><pre class=""><span style="padding-right: 0.1px;">  <span class="cm-keyword">=</span> <span class="cm-variable-2">CreativeCore</span></span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp;  { <span class="cm-variable">_coreTitle</span> &nbsp; &nbsp; &nbsp; <span class="cm-keyword">::</span> <span class="cm-builtin">Maybe</span> <span class="cm-variable-2">Title</span></span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp;  , <span class="cm-variable">_coreDescription</span> <span class="cm-keyword">::</span> <span class="cm-builtin">Maybe</span> <span class="cm-variable-2">Description</span></span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp;  , <span class="cm-variable">_coreSponsor</span> &nbsp; &nbsp; <span class="cm-keyword">::</span> <span class="cm-builtin">Maybe</span> <span class="cm-variable-2">Sponsor</span></span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp;  , <span class="cm-variable">_coreImgURL</span> &nbsp; &nbsp;  <span class="cm-keyword">::</span> <span class="cm-builtin">Maybe</span> (<span class="cm-variable-2">Valid</span> <span class="cm-variable-2">RawURL</span>)</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp;  }</span></pre><pre class=""><span style="padding-right: 0.1px;">  <span class="cm-keyword">deriving</span> (<span class="cm-builtin">Eq</span>, <span class="cm-variable-2">Generic</span>, <span class="cm-builtin">Show</span>)</span></pre></div></div></div></div></div><div style="position: absolute; height: 30px; width: 1px; top: 0px;"></div><div class="CodeMirror-gutters" style="display: none; height: 396px;"></div></div></div></pre><p></p><h1><a name='header-c757' class='md-header-anchor '></a>Folds.hs</h1><pre class="md-fences md-end-block" lang="haskell"> <div class="CodeMirror cm-s-inner CodeMirror-wrap"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 4px;"></div><div class="CodeMirror-hscrollbar" style="left: 0px;"><div style="height: 100%; min-height: 1px; width: 0px;"></div></div><div class="CodeMirror-vscrollbar"><div style="min-width: 1px; height: 0px;"></div></div><div class="CodeMirror-scrollbar-filler"></div><div class="CodeMirror-gutter-filler"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; min-height: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines"><div style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><pre class=""><span style="padding-right: 0.1px;"><span class="cm-comment">-- | Count events</span></span></pre></div><pre class=""><span style="padding-right: 0.1px;"><span class="cm-variable">countFold</span> <span class="cm-keyword">::</span> (<span class="cm-variable-2">Hashable</span> <span class="cm-variable">k</span>, <span class="cm-builtin">Eq</span> <span class="cm-variable">k</span>)</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;  <span class="cm-keyword">=&gt;</span> (<span class="cm-variable">ev</span> <span class="cm-keyword">-&gt;</span> <span class="cm-builtin">Maybe</span> <span class="cm-variable">k</span>)</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;  <span class="cm-keyword">-&gt;</span> <span class="cm-qualifier">L.</span><span class="cm-variable-2">Fold</span> <span class="cm-variable">ev</span> (<span class="cm-variable-2">MonoidalHashMap</span> <span class="cm-variable">k</span> (<span class="cm-variable-2">Sum</span> <span class="cm-builtin">Integer</span>))</span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-variable">countFold</span> <span class="cm-variable">keyF</span> <span class="cm-keyword">=</span> <span class="cm-qualifier">L.</span><span class="cm-variable-2">Fold</span> <span class="cm-variable">s</span> <span class="cm-variable">mempty</span> <span class="cm-builtin">id</span> <span class="cm-variable">incr</span></span></pre><pre class=""><span style="padding-right: 0.1px;">  <span class="cm-keyword">where</span></span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  <span class="cm-variable">incr</span> <span class="cm-variable">m</span> <span class="cm-variable">ev</span> <span class="cm-keyword">=</span> <span class="cm-variable">m</span> (<span class="cm-keyword">\</span><span class="cm-variable">k</span> <span class="cm-keyword">-&gt;</span> <span class="cm-qualifier">M.</span><span class="cm-variable">modify</span> (<span class="cm-builtin">+</span><span class="cm-number">1</span>) <span class="cm-variable">k</span> <span class="cm-variable">m</span>) (<span class="cm-variable">keyF</span> <span class="cm-variable">ev</span>)</span></pre></div></div></div></div></div><div style="position: absolute; height: 30px; width: 1px; top: 0px;"></div><div class="CodeMirror-gutters" style="display: none; height: 154px;"></div></div></div></pre><p></p><h1><a name='header-c761' class='md-header-anchor '></a>Простий випадок</h1><pre class="md-fences md-end-block" lang="haskell"> <div class="CodeMirror cm-s-inner CodeMirror-wrap"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 4px;"></div><div class="CodeMirror-hscrollbar" style="left: 0px;"><div style="height: 100%; min-height: 1px; width: 0px;"></div></div><div class="CodeMirror-vscrollbar"><div style="min-width: 1px; height: 0px;"></div></div><div class="CodeMirror-scrollbar-filler"></div><div class="CodeMirror-gutter-filler"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; min-height: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines"><div style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><pre class=""><span style="padding-right: 0.1px;"><span class="cm-comment">-- | SELECT GROUPKEY(round_one_hour(timestamp)),</span></span></pre></div><pre class=""><span style="padding-right: 0.1px;"><span class="cm-comment">-- &nbsp; &nbsp; &nbsp; &nbsp;  count()</span></span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-comment">-- &nbsp; FROM ds_ad_load_events</span></span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-variable">processCountLoadsPerHour</span> <span class="cm-keyword">::</span> <span class="cm-variable-2">Mode</span> <span class="cm-keyword">-&gt;</span> <span class="cm-builtin">IO</span> ()</span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-variable">processCountLoadsPerHour</span> <span class="cm-variable">mode</span> <span class="cm-keyword">=</span> <span class="cm-variable">void</span> <span class="cm-builtin">.</span> <span class="cm-variable">runConsumerInMode</span> <span class="cm-variable">mode</span> <span class="cm-builtin">$</span> <span class="cm-keyword">do</span></span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  <span class="cm-keyword">let</span> <span class="cm-variable">kf</span> <span class="cm-variable">ev</span> <span class="cm-keyword">=</span> <span class="cm-builtin">Just</span> (<span class="cm-variable">rewindToHour</span> (<span class="cm-variable">ev</span> <span class="cm-variable">^.</span> <span class="cm-variable">timestamp</span>))</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  <span class="cm-keyword">let</span> (<span class="cm-variable-2">EvProducer</span> <span class="cm-variable">prod</span>) <span class="cm-keyword">=</span> <span class="cm-variable">evProducerW</span> <span class="cm-variable">start</span> <span class="cm-variable">end</span></span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  <span class="cm-variable">res</span> <span class="cm-keyword">&lt;-</span> <span class="cm-variable">purelyFold</span> (<span class="cm-variable">countFold</span> <span class="cm-variable">kf</span>) (<span class="cm-variable">prod</span> <span class="cm-keyword">::</span> <span class="cm-variable-2">EventProducer</span> (<span class="cm-variable-2">Event</span> <span class="cm-variable-2">DsAdLoad</span>))</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  <span class="cm-variable">liftIO</span> (<span class="cm-builtin">print</span> <span class="cm-variable">res</span>)</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  <span class="cm-comment">-- :: MonoidalHashMap KeyDsAdregion (Sum Integer)</span></span></pre></div></div></div></div></div><div style="position: absolute; height: 30px; width: 1px; top: 0px;"></div><div class="CodeMirror-gutters" style="display: none; height: 220px;"></div></div></div></pre><p></p><h1><a name='header-c765' class='md-header-anchor '></a>Складніше</h1><ul><li>помітьте, як ми передаємо мапу в пам’яті замість джойнів</li></ul><pre class="md-fences md-end-block" lang="haskell"> <div class="CodeMirror cm-s-inner CodeMirror-wrap"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 4px;"></div><div class="CodeMirror-hscrollbar" style="left: 0px;"><div style="height: 100%; min-height: 1px; width: 0px;"></div></div><div class="CodeMirror-vscrollbar"><div style="min-width: 1px; height: 0px;"></div></div><div class="CodeMirror-scrollbar-filler"></div><div class="CodeMirror-gutter-filler"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; min-height: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines"><div style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><pre class=""><span style="padding-right: 0.1px;"><span class="cm-comment">-- | SELECT GROUPKEY(ds_id, adregion_id, round5min(timestamp)),</span></span></pre></div><pre class=""><span style="padding-right: 0.1px;"><span class="cm-comment">-- &nbsp; &nbsp; &nbsp; &nbsp;  count(ds_ad_load_events)</span></span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-comment">-- &nbsp; &nbsp; &nbsp; &nbsp;  earnings(ds_ad_load_events)</span></span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-comment">-- &nbsp; &nbsp; &nbsp; &nbsp;  count(ds_click_events)</span></span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-comment">-- &nbsp; FROM ds_ad_load_events, ds_click_events</span></span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-variable">processCountLoadsAndClicksAndEarningsConcurrent</span> <span class="cm-keyword">::</span> <span class="cm-variable-2">Mode</span> <span class="cm-keyword">-&gt;</span> <span class="cm-builtin">IO</span> ()</span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-variable">processCountLoadsAndClicksAndEarningsConcurrent</span> <span class="cm-variable">mode</span> <span class="cm-keyword">=</span> <span class="cm-variable">void</span> <span class="cm-builtin">.</span> <span class="cm-variable">runConsumerInMode</span> <span class="cm-variable">mode</span> <span class="cm-builtin">$</span> <span class="cm-keyword">do</span></span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  (<span class="cm-variable-2">KeyFunction</span> <span class="cm-variable">kf</span>) <span class="cm-keyword">&lt;-</span> <span class="cm-variable">getKeyFunctionDsAdregion</span></span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  <span class="cm-keyword">let</span> (<span class="cm-variable-2">EvProducer</span> <span class="cm-variable">prod</span>) <span class="cm-keyword">=</span> <span class="cm-variable">evProducerW</span> <span class="cm-variable">start</span> <span class="cm-variable">end</span></span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  ((<span class="cm-variable">lc</span>,<span class="cm-variable">le</span>),<span class="cm-variable">cc</span>) <span class="cm-keyword">&lt;-</span> <span class="cm-variable">concurrently2</span></span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  (<span class="cm-variable">purelyFold</span> ((,) <span class="cm-variable">&lt;$&gt;</span> <span class="cm-variable">countFold</span> <span class="cm-variable">kf</span> <span class="cm-variable">&lt;*&gt;</span> <span class="cm-variable">earningsFold</span> <span class="cm-variable">kf</span>)</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  (<span class="cm-variable">prod</span> <span class="cm-keyword">::</span> <span class="cm-variable-2">EventProducer</span> (<span class="cm-variable-2">Event</span> <span class="cm-variable-2">DsAdLoad</span>)))</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  (<span class="cm-variable">purelyFold</span> (<span class="cm-variable">countFold</span> <span class="cm-variable">kf</span>)</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  (<span class="cm-variable">prod</span> <span class="cm-keyword">::</span> <span class="cm-variable-2">EventProducer</span> (<span class="cm-variable-2">Event</span> <span class="cm-variable-2">DsClick</span>)))</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  <span class="cm-variable">liftIO</span> (<span class="cm-builtin">print</span> (<span class="cm-variable">mhmZip3</span> <span class="cm-variable">lc</span> <span class="cm-variable">le</span> <span class="cm-variable">cc</span>))</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  <span class="cm-comment">-- :: MonoidalHashMap KeyDsAdregion (Sum Integer, Sum MoneyAmount,</span></span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  <span class="cm-comment">-- &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; Sum Integer)</span></span></pre><pre class=""><span style="padding-right: 0.1px;"><span>​</span></span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-keyword">type</span> <span class="cm-variable-2">KeyAdregionDs</span> <span class="cm-keyword">=</span> (<span class="cm-variable-2">AdregionId</span>, <span class="cm-variable-2">DsProviderId</span>, <span class="cm-variable-2">UTCTime</span>)</span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-variable">getKeyFunctionDsAdregion</span> <span class="cm-keyword">::</span> <span class="cm-variable-2">Consumer</span> (<span class="cm-variable-2">KeyFunction</span> <span class="cm-variable-2">KeyAdregionDs</span>)</span></pre><pre class=""><span style="padding-right: 0.1px;"><span>​</span></span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-variable">keyFunctionAdregionDs</span> <span class="cm-keyword">::</span> <span class="cm-variable-2">KeyConstraints</span> <span class="cm-variable-2">KeyAdregionDs</span> <span class="cm-variable">ev</span></span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  <span class="cm-keyword">=&gt;</span> <span class="cm-variable-2">HashMap</span> <span class="cm-variable-2">DsAccountId</span> <span class="cm-variable-2">DsProviderId</span> </span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  <span class="cm-keyword">-&gt;</span> (<span class="cm-variable">ev</span> <span class="cm-keyword">-&gt;</span> <span class="cm-builtin">Maybe</span> <span class="cm-variable-2">KeyAdregionDs</span>)</span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-variable">keyFunctionAdregionDs</span> <span class="cm-variable">dsMap</span> <span class="cm-variable">event</span> <span class="cm-keyword">=</span> <span class="cm-keyword">do</span></span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  <span class="cm-keyword">let</span> <span class="cm-variable">accountID</span> <span class="cm-keyword">=</span> <span class="cm-variable">event</span> <span class="cm-variable">^.</span> <span class="cm-variable">dsAccountId</span></span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  <span class="cm-variable">dsID</span> &nbsp; &nbsp; &nbsp; &nbsp; <span class="cm-keyword">&lt;-</span> <span class="cm-qualifier">H.</span><span class="cm-builtin">lookup</span> <span class="cm-variable">accountID</span> <span class="cm-variable">dsMap</span></span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  <span class="cm-keyword">let</span> <span class="cm-variable">region</span> &nbsp;  <span class="cm-keyword">=</span> <span class="cm-variable">event</span> <span class="cm-variable">^.</span> <span class="cm-variable">adregionId</span></span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  <span class="cm-keyword">let</span> <span class="cm-variable">timekey</span> &nbsp; <span class="cm-keyword">=</span> <span class="cm-variable">rewindTo5Min</span> (<span class="cm-variable">event</span> <span class="cm-variable">^.</span> <span class="cm-variable">timestamp</span>)</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  <span class="cm-builtin">return</span> (<span class="cm-variable">region</span>, <span class="cm-variable">dsID</span>, <span class="cm-variable">timekey</span>)</span></pre></div></div></div></div></div><div style="position: absolute; height: 30px; width: 1px; top: 0px;"></div><div class="CodeMirror-gutters" style="display: none; height: 660px;"></div></div></div></pre><p></p><h1><a name='header-c773' class='md-header-anchor '></a>Складніші репорти</h1><pre class="md-fences md-end-block" lang="haskell"> <div class="CodeMirror cm-s-inner CodeMirror-wrap"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 4px;"></div><div class="CodeMirror-hscrollbar" style="left: 0px;"><div style="height: 100%; min-height: 1px; width: 0px;"></div></div><div class="CodeMirror-vscrollbar"><div style="min-width: 1px; height: 0px;"></div></div><div class="CodeMirror-scrollbar-filler"></div><div class="CodeMirror-gutter-filler"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; min-height: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines"><div style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><pre class=""><span style="padding-right: 0.1px;"><span class="cm-keyword">data</span> <span class="cm-variable-2">Report</span> <span class="cm-variable">label</span> <span class="cm-keyword">=</span></span></pre></div><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; <span class="cm-variable-2">Report</span> { <span class="cm-variable">scope</span> &nbsp; &nbsp;  <span class="cm-keyword">::</span> <span class="cm-variable">label</span></span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  , <span class="cm-variable">timeseries</span> <span class="cm-keyword">::</span> <span class="cm-variable-2">MonoidalHashMap</span> <span class="cm-variable-2">UTCTime</span> <span class="cm-variable-2">ReportPayload</span></span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  } <span class="cm-keyword">deriving</span> (<span class="cm-builtin">Show</span>, <span class="cm-builtin">Eq</span>)</span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-keyword">data</span> <span class="cm-variable-2">ReportPayload</span></span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  <span class="cm-keyword">=</span> <span class="cm-variable-2">ReportPayload</span> { <span class="cm-variable">loads</span> &nbsp; &nbsp; &nbsp; &nbsp;  <span class="cm-keyword">::</span> <span class="cm-variable">!</span>(<span class="cm-variable-2">Sum</span> <span class="cm-builtin">Integer</span>)</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  , <span class="cm-variable">impressions</span> &nbsp;  <span class="cm-keyword">::</span> <span class="cm-variable">!</span>(<span class="cm-variable-2">Sum</span> <span class="cm-builtin">Integer</span>)</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  , <span class="cm-variable">clicks</span> &nbsp; &nbsp; &nbsp; &nbsp; <span class="cm-keyword">::</span> <span class="cm-variable">!</span>(<span class="cm-variable-2">Sum</span> <span class="cm-builtin">Integer</span>)</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  , <span class="cm-variable">ctr</span> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  <span class="cm-keyword">::</span> <span class="cm-variable">!</span>(<span class="cm-variable-2">Avg</span> <span class="cm-builtin">Double</span>)</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  , <span class="cm-variable">earnings</span> &nbsp; &nbsp; &nbsp; <span class="cm-keyword">::</span> <span class="cm-variable">!</span>(<span class="cm-variable-2">Sum</span> <span class="cm-variable-2">MoneyAmount</span>)</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  , <span class="cm-variable">avgEarnings</span> &nbsp;  <span class="cm-keyword">::</span> <span class="cm-variable">!</span>(<span class="cm-variable-2">Avg</span> <span class="cm-variable-2">MoneyAmount</span>)</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  , <span class="cm-variable">avgEarningsCpc</span> <span class="cm-keyword">::</span> <span class="cm-variable">!</span>(<span class="cm-variable-2">Avg</span> <span class="cm-variable-2">MoneyAmount</span>)}</span></pre><pre class=""><span style="padding-right: 0.1px;">  <span class="cm-keyword">deriving</span> (<span class="cm-builtin">Show</span>, <span class="cm-builtin">Eq</span>, <span class="cm-variable-2">Generic</span>)</span></pre></div></div></div></div></div><div style="position: absolute; height: 30px; width: 1px; top: 0px;"></div><div class="CodeMirror-gutters" style="display: none; height: 286px;"></div></div></div></pre><p></p><h1><a name='header-c777' class='md-header-anchor '></a><code>Fold</code>и для складніших репортів</h1><pre class="md-fences md-end-block" lang="haskell"> <div class="CodeMirror cm-s-inner CodeMirror-wrap"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 4px;"></div><div class="CodeMirror-hscrollbar" style="left: 0px;"><div style="height: 100%; min-height: 1px; width: 0px;"></div></div><div class="CodeMirror-vscrollbar"><div style="min-width: 1px; height: 0px;"></div></div><div class="CodeMirror-scrollbar-filler"></div><div class="CodeMirror-gutter-filler"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; min-height: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines"><div style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><pre class=""><span style="padding-right: 0.1px;"><span class="cm-variable">processStats</span> <span class="cm-keyword">=</span> <span class="cm-keyword">do</span></span></pre></div><pre class=""><span style="padding-right: 0.1px;">  <span class="cm-variable">aggs</span> <span class="cm-keyword">&lt;-</span> <span class="cm-variable">aggregateEventStreams</span> <span class="cm-variable">dsMap</span> (<span class="cm-variable">evProducer</span> &nbsp; <span class="cm-variable">startTime</span> <span class="cm-variable">endTime</span></span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="cm-keyword">::</span> <span class="cm-variable-2">EventProducer</span> (<span class="cm-variable-2">Event</span> <span class="cm-variable-2">DsAdLoad</span>))</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  (<span class="cm-variable">evProducer</span> &nbsp; <span class="cm-variable">startTime</span> <span class="cm-variable">endTime</span></span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="cm-keyword">::</span> <span class="cm-variable-2">EventProducer</span> (<span class="cm-variable-2">Event</span> <span class="cm-variable-2">DsImpression</span>))</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  (<span class="cm-variable">evProducer</span> &nbsp; <span class="cm-variable">startTime</span> <span class="cm-variable">endTime</span></span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="cm-keyword">::</span> <span class="cm-variable-2">EventProducer</span> (<span class="cm-variable-2">Event</span> <span class="cm-variable-2">DsClick</span>))</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  (<span class="cm-variable">evProducer</span> &nbsp; <span class="cm-variable">startTime</span> <span class="cm-variable">endTime</span></span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="cm-keyword">::</span> <span class="cm-variable-2">EventProducer</span> (<span class="cm-variable-2">Event</span> <span class="cm-variable-2">DsAvailabilityCheck</span>))</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  (<span class="cm-variable">evProducer</span> &nbsp; <span class="cm-variable">startTime</span> <span class="cm-variable">endTime</span></span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="cm-keyword">::</span> <span class="cm-variable-2">EventProducer</span> (<span class="cm-variable-2">Event</span> <span class="cm-variable-2">DsAdAvail</span>))</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  (<span class="cm-variable">evProducer</span> &nbsp; <span class="cm-variable">startTime</span> <span class="cm-variable">endTime</span></span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="cm-keyword">::</span> <span class="cm-variable-2">EventProducer</span> (<span class="cm-variable-2">Event</span> <span class="cm-variable-2">DsAdUnavail</span>))</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  (<span class="cm-variable">evProducer</span> &nbsp; <span class="cm-variable">startTime</span> <span class="cm-variable">endTime</span></span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="cm-keyword">::</span> <span class="cm-variable-2">EventProducer</span> (<span class="cm-variable-2">Event</span> <span class="cm-variable-2">DsAdError</span>))</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  (<span class="cm-variable">evProducer</span> &nbsp; <span class="cm-variable">startTime</span> <span class="cm-variable">endTime</span></span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="cm-keyword">::</span> <span class="cm-variable-2">EventProducer</span> (<span class="cm-variable-2">Event</span> <span class="cm-variable-2">DsCookieSync</span>))</span></pre><pre class=""><span style="padding-right: 0.1px;">  <span class="cm-keyword">where</span></span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  <span class="cm-variable">...</span></span></pre></div></div></div></div></div><div style="position: absolute; height: 30px; width: 1px; top: 0px;"></div><div class="CodeMirror-gutters" style="display: none; height: 418px;"></div></div></div></pre><p></p><h1><a name='header-c781' class='md-header-anchor '></a>... продовження ...</h1><pre class="md-fences md-end-block" lang="haskell"> <div class="CodeMirror cm-s-inner CodeMirror-wrap"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 4px;"></div><div class="CodeMirror-hscrollbar" style="left: 0px;"><div style="height: 100%; min-height: 1px; width: 0px;"></div></div><div class="CodeMirror-vscrollbar"><div style="min-width: 1px; height: 0px;"></div></div><div class="CodeMirror-scrollbar-filler"></div><div class="CodeMirror-gutter-filler"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; min-height: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines"><div style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  <span class="cm-variable">impFold</span> <span class="cm-keyword">::</span> <span class="cm-variable-2">PayloadFold</span> (<span class="cm-variable-2">Event</span> <span class="cm-variable-2">DsImpression</span>)</span></pre></div><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  <span class="cm-variable">impFold</span> <span class="cm-keyword">=</span> <span class="cm-variable">mkBaseFold</span> <span class="cm-variable">impressionsL</span> <span class="cm-variable">countFold</span> <span class="cm-variable">&lt;&gt;</span></span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  <span class="cm-variable">mkBaseFold</span> <span class="cm-variable">ctrL</span> <span class="cm-variable">ctrFold</span></span></pre><pre class=""><span style="padding-right: 0.1px;"><span>​</span></span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  <span class="cm-variable">clickFold</span> <span class="cm-keyword">::</span> <span class="cm-variable-2">PayloadFold</span> (<span class="cm-variable-2">Event</span> <span class="cm-variable-2">DsClick</span>)</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  <span class="cm-variable">clickFold</span> <span class="cm-keyword">=</span> <span class="cm-variable">mkBaseFold</span> <span class="cm-variable">clicksL</span> <span class="cm-variable">countFold</span> <span class="cm-variable">&lt;&gt;</span></span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  <span class="cm-variable">mkBaseFold</span> <span class="cm-variable">ctrL</span> <span class="cm-variable">ctrFold</span></span></pre></div></div></div></div></div><div style="position: absolute; height: 30px; width: 1px; top: 0px;"></div><div class="CodeMirror-gutters" style="display: none; height: 154px;"></div></div></div></pre><p></p><h1><a name='header-c785' class='md-header-anchor '></a>Візуалізація</h1><ul><li>GHCJS + Reflex</li></ul><p><img src='dashboard.png' alt='dashboard' /></p><p></p><h1><a name='header-c794' class='md-header-anchor '></a>Чого не вистачає</h1><ul><li>Швидкість (data locality, нерівномірність бакетів)</li><li>Компактне збереження результатів (абстракція розділення по інтервалах та збереження)</li><li>REPL або блокнотик</li><li>GUI для репроцессингу</li><li>Real-time in-memory analytics</li></ul><h1><a name='header-c811' class='md-header-anchor '></a>Thanks!</h1></div>
</body>
</html>